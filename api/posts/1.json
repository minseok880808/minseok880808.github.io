{"total":14,"pageSize":10,"pageCount":2,"data":[{"title":"Python 개발을 위한 IntelliJ 설정","slug":"LambdaPythonIntelliJ","date":"2020-05-11T05:26:08.000Z","updated":"2020-05-11T07:32:16.664Z","comments":true,"pin":null,"path":"api/articles/LambdaPythonIntelliJ.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81527423-2ba70e00-9395-11ea-919a-eb4abd661e5d.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ, Django</li>\n<li>Python</li>\n<li>AWS Console, SAM(Serverless Application Model), RDS(MySQL)</li>\n</ul>\n<h2 id=\"개요\"><a href=\"#개요\" class=\"headerlink\" title=\"개요\"></a>개요</h2><ul>\n<li>파이썬 개발을 진행하고자 하면, 설정이 50%다. </li>\n<li>설정이 꼬여버리면 어떻게든 개발이 진행되지 않으므로, 설정에 유의하자. (돈이 상관없다면 Cloud9을 사용하는 것도 좋다.)</li>\n</ul>\n<h2 id=\"설정\"><a href=\"#설정\" class=\"headerlink\" title=\"설정\"></a>설정</h2><h3 id=\"IntelliJ-설치\"><a href=\"#IntelliJ-설치\" class=\"headerlink\" title=\"IntelliJ 설치\"></a>IntelliJ 설치</h3><ul>\n<li>원하는 버전을 설치해도 상관없겠지만, 1년씩 정기구독하면서 업데이트를 지원받는 IntelliJ IDEA Ultimate 를 사용하려 하였다.</li>\n<li>물론 Visual Studio도 지원을 해준다. 난 개인적으로 IDE는 IntelliJ 를 사용하고자 하였고, 이를 여기에 기록으로 남긴다.<br><a href=\"https://user-images.githubusercontent.com/62123161/81527423-2ba70e00-9395-11ea-919a-eb4abd661e5d.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81527423-2ba70e00-9395-11ea-919a-eb4abd661e5d.png\" alt=\"LambdaPythonIntelliJ_01\"></a><br>IntelliJ에서는 아래와 같은 링크에서 보고 따라하기만 하면된다. Plugin 설치임.<br>(<a href=\"https://whitefrost-developer.tistory.com/7\" target=\"_blank\" rel=\"noopener\">https://whitefrost-developer.tistory.com/7</a>)</li>\n</ul>\n<h3 id=\"Python-설치\"><a href=\"#Python-설치\" class=\"headerlink\" title=\"Python 설치\"></a>Python 설치</h3><ul>\n<li>작성일자까지 확인해본 바로는 현재 Python은 3.8.2버전이 마지막 버전이다. </li>\n<li>설치방법은 아래 참고하자.<ol>\n<li><a href=\"http://www.python.org에서\" target=\"_blank\" rel=\"noopener\">www.python.org에서</a> 다운로드 메뉴 - Python 3.5이상 선택해서 다운로드</li>\n<li>설치 과정에서 Add Python 3.5 to Path 반드시 체크</li>\n<li>설치 확인 윈도우키 + R을 눌러서 나오는 창에 powershell이라고 치고, 확인을 눌러서 powershell실행<br><a href=\"https://user-images.githubusercontent.com/62123161/81527422-2b0e7780-9395-11ea-9f50-d801c3d11225.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81527422-2b0e7780-9395-11ea-9f50-d801c3d11225.png\" alt=\"LambdaPythonIntelliJ_02\"></a></li>\n</ol>\n</li>\n</ul>\n<h3 id=\"SAM-설치\"><a href=\"#SAM-설치\" class=\"headerlink\" title=\"SAM 설치\"></a>SAM 설치</h3><p><a href=\"https://github.com/awslabs/aws-sam-cli/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/awslabs/aws-sam-cli/releases</a></p>\n<h3 id=\"RDS-및-Dynamo-설정\"><a href=\"#RDS-및-Dynamo-설정\" class=\"headerlink\" title=\"RDS 및 Dynamo 설정\"></a>RDS 및 Dynamo 설정</h3><p>MySQL 설정 : <a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/CHAP_MySQL.html\" target=\"_blank\" rel=\"noopener\">https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/UserGuide/CHAP_MySQL.html</a><br>DynamoDB 설정 : <a href=\"https://aws.amazon.com/ko/dynamodb/getting-started/\" target=\"_blank\" rel=\"noopener\">https://aws.amazon.com/ko/dynamodb/getting-started/</a></p>\n<h4 id=\"MySQL-기타설정-Optional\"><a href=\"#MySQL-기타설정-Optional\" class=\"headerlink\" title=\"MySQL 기타설정(Optional)\"></a>MySQL 기타설정(Optional)</h4><ul>\n<li>우선 기본적으로 ap-northeast-2(Seoul)에 설정하면, 당연히 SysDate()나 Now() 함수를 호출하여 현재 한국의 시간을 받아올 수 있을 줄 알았다.</li>\n<li>말도 안되겠지만, 시간을 조회하면 UTC+0이 들어온다. (그리니치 천문대 : 영국)</li>\n<li>그래서 아래와 같은 세팅을 해주어야 한다.<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Timezone 체크 쿼리(SQL)</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT @@global.time_zone, @@session.time_zone;  --현재 시스템과 세션에 설정된 타임존 보기</span><br><span class=\"line\">SET time_zone = <span class=\"string\">'Asia/Seoul'</span>; --현재 시스템의 타임존 바꿔버리기.</span><br></pre></td></tr></table></figure></div>\n위 내용은 가장 간단해서 쓴거고.. 다른방법도 있다.(어차피 RDS환경에서 다른방법은 답이없을듯.)<br>쓸거면 여기 링크 참고(<a href=\"https://jwkim96.tistory.com/23\" target=\"_blank\" rel=\"noopener\">https://jwkim96.tistory.com/23</a>)</li>\n</ul>\n<h3 id=\"Django-설치-Optional\"><a href=\"#Django-설치-Optional\" class=\"headerlink\" title=\"Django 설치(Optional)\"></a>Django 설치(Optional)</h3><p>공식 Document : <a href=\"https://docs.djangoproject.com/en/3.0/topics/install/\" target=\"_blank\" rel=\"noopener\">https://docs.djangoproject.com/en/3.0/topics/install/</a><br>문서보고 설치하면 된다.</p>\n<h2 id=\"개발\"><a href=\"#개발\" class=\"headerlink\" title=\"개발\"></a>개발</h2><p>모든 설정은 끝났다. 이제 개발만 하면되겟지만, 디버깅 모드에 관해서만 남기고 글을 마무리한다.<br>위 내용 중에 IntelliJ 설정이 완료가 되었다면 아래와 같은 화면을 볼 수 있을 것이다.</p>\n<h3 id=\"IntelliJ-프로젝트-생성\"><a href=\"#IntelliJ-프로젝트-생성\" class=\"headerlink\" title=\"IntelliJ 프로젝트 생성\"></a>IntelliJ 프로젝트 생성</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81527416-2a75e100-9395-11ea-815d-fabac97f59f4.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81527416-2a75e100-9395-11ea-815d-fabac97f59f4.png\" alt=\"LambdaPythonIntelliJ_03\"></a></p>\n<ol>\n<li>Django를 선택해준다.<ul>\n<li>SQL Support 선택하지 않은 이유 : 보통 우리는 대부분의 서비스를 DB와 같이 쓴다. 하지만, 당장 pymysql만을 사용하겠다라고 하면 체크할 필요는 없을 것으로 판단이 되며,</li>\n<li>필요한 항목이 있을 경우 그때그때 import 해서 쓰면 된다는 생각이 들었기에 따로 체크하지 않는다.(물론 체크해서 사용해도 상관없다. 그냥 프로그램이 조금더 무거워질수도 있겠지..큰차이는 없다)</li>\n</ul>\n</li>\n<li>Next 클릭</li>\n<li>기존의 Flash Project Template가 없을것이다. 그냥 Next.</li>\n<li>프로젝트의 이름과 경로등이 정확히 들어갔는지 확인하고 Finish.</li>\n</ol>\n<h3 id=\"IntelliJ-프로젝트-디버깅\"><a href=\"#IntelliJ-프로젝트-디버깅\" class=\"headerlink\" title=\"IntelliJ 프로젝트 디버깅\"></a>IntelliJ 프로젝트 디버깅</h3><p><img src=\"https://user-images.githubusercontent.com/62123161/81527426-2c3fa480-9395-11ea-990d-e56f2c82150d.png\" alt=\"LambdaPythonIntelliJ_04\"></p>\n<ul>\n<li>이전 과정을 거치고 나면 위와 같은 화면을 마주하게 될 것이다.</li>\n<li>manage.py가 기본 Default main소스라고 보면 된다.</li>\n</ul>\n<p><img src=\"https://user-images.githubusercontent.com/62123161/81527425-2c3fa480-9395-11ea-9063-c2786f3f9c3b.png\" alt=\"LambdaPythonIntelliJ_05\"></p>\n<ul>\n<li>디버깅이 잘 적용되는걸 볼 수 있다.</li>\n<li>저 os관련된 라이브러리는 크게 필요없으니 지워도된다. 알아서 정리해서 써보시길..</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJ, DjangoPythonAWS Console, SAM(Serverless Application Model), RDS(MySQL)개요파이썬 개발을 진행하고자 하면, 설정이 50%다. 설정이 꼬여버리면 어떻게든","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"python","slug":"python","count":2,"path":"api/tags/python.json"},{"name":"IntelliJ","slug":"IntelliJ","count":1,"path":"api/tags/IntelliJ.json"}]},{"title":"Cloud9","slug":"Cloud9","date":"2020-05-07T06:12:11.000Z","updated":"2020-05-11T06:33:50.209Z","comments":true,"pin":null,"path":"api/articles/Cloud9.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81260722-8da20380-9075-11ea-9a81-3b4751bc2760.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Python</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"설정\"><a href=\"#설정\" class=\"headerlink\" title=\"설정\"></a>설정</h2><h3 id=\"1-DashBoard\"><a href=\"#1-DashBoard\" class=\"headerlink\" title=\"1) DashBoard\"></a>1) DashBoard</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81260722-8da20380-9075-11ea-9a81-3b4751bc2760.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260722-8da20380-9075-11ea-9a81-3b4751bc2760.png\" alt=\"cloud9_01\"></a></p>\n<h3 id=\"2-Create-Environment-로-환경을-설정하자\"><a href=\"#2-Create-Environment-로-환경을-설정하자\" class=\"headerlink\" title=\"2) Create Environment 로 환경을 설정하자.\"></a>2) Create Environment 로 환경을 설정하자.</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81260721-8c70d680-9075-11ea-87dc-338df283100a.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260721-8c70d680-9075-11ea-87dc-338df283100a.png\" alt=\"cloud9_02\"></a><br><a href=\"https://user-images.githubusercontent.com/62123161/81260718-8aa71300-9075-11ea-9459-af1171bcec28.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260718-8aa71300-9075-11ea-9459-af1171bcec28.png\" alt=\"cloud9_03\"></a></p>\n<ul>\n<li>중요 : 인스턴스 용량이나 플랫폼환경은 마음대로 하면된다.<br>  But, Network Setting은 반드시 VPC를 통한 외부로 나갈 수 있도록 해주자.(날씨는 밖에서 데이터를 긁어와야 하기 때문에…)</li>\n<li>내부에서 private하게 돌릴거라면 Default VPC로 셋팅해도 아무 문제 없다.<br><a href=\"https://user-images.githubusercontent.com/62123161/81260708-87138c00-9075-11ea-8e58-201f496d3ad6.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260708-87138c00-9075-11ea-8e58-201f496d3ad6.png\" alt=\"cloud9_04\"></a></li>\n<li>자신없으면 기본셋팅으로 하자.</li>\n<li>셋팅 끝.</li>\n</ul>\n<h2 id=\"개발\"><a href=\"#개발\" class=\"headerlink\" title=\"개발\"></a>개발</h2><h3 id=\"1-로컬람다-생성\"><a href=\"#1-로컬람다-생성\" class=\"headerlink\" title=\"1) 로컬람다 생성\"></a>1) 로컬람다 생성</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81260705-84189b80-9075-11ea-8c13-869b2bce2ea4.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260705-84189b80-9075-11ea-8c13-869b2bce2ea4.png\" alt=\"cloud9_05\"></a></p>\n<ul>\n<li>로컬람다를 선택해서 개발을 진행해야 초기 환경이 자동으로 잘 잡힌다.</li>\n</ul>\n<h3 id=\"2-Import-할-라이브러리-추가\"><a href=\"#2-Import-할-라이브러리-추가\" class=\"headerlink\" title=\"2) Import 할 라이브러리 추가\"></a>2) Import 할 라이브러리 추가</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81260738-91358a80-9075-11ea-9a6b-d3340b584040.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260738-91358a80-9075-11ea-9a6b-d3340b584040.png\" alt=\"cloud9_06\"></a></p>\n<ul>\n<li><p>결과화면에서 보면 알겠지만 나는 우선 Boto3, pymysql, requests를 사용할 예정이다. </p>\n</li>\n<li><p>나머지 json이나 datetime등은 기본적으로 제공해주는 것으로 보인다.(내가 라이브러리 import하지 않았거든..)</p>\n<ul>\n<li>pymysql<ul>\n<li>python -m pip install –target=./ pymysql</li>\n</ul>\n</li>\n<li>requests<ul>\n<li>python -m pip install –target=./ requests</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>아, 참고로 위 1,2번 명령어는 소스내 바로 상위 폴더를 오른쪽버튼 클릭하여 “Open Terminal Here(Alt+L)” 을 누른뒤 입력한다. </p>\n</li>\n<li><p>알아서 깔아주니 그냥 입력하고 두어라.</p>\n</li>\n<li><p>다 되고나면 위 그림의 왼쪽 Explorer 창처럼 수많은 라이브러리가 등장하게 된다. (물론 소스까지 넣었고, 빌드해서 돌렸으니까 추가된것도 있고..)</p>\n</li>\n</ul>\n<h2 id=\"배포\"><a href=\"#배포\" class=\"headerlink\" title=\"배포\"></a>배포</h2><p><a href=\"https://user-images.githubusercontent.com/62123161/81260733-909cf400-9075-11ea-87cf-742f1549c702.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81260733-909cf400-9075-11ea-87cf-742f1549c702.png\" alt=\"cloud9_07\"></a></p>\n<ul>\n<li>간단하게 돌려봤고, 올려도 되겠다 싶은 생각이 들때 위 사진처럼 Local Function을 Remote Function으로 배포해준다. (여담이지만, 이미 local Function으로 만들때 자동으로 Remote가 생성이 된다. 아무래도 Sync에 많은 신경을 쓴듯한 느낌이 듬.)</li>\n</ul>\n<h2 id=\"소스\"><a href=\"#소스\" class=\"headerlink\" title=\"소스\"></a>소스</h2><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Weather</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import boto3</span><br><span class=\"line\">import json</span><br><span class=\"line\">import pymysql</span><br><span class=\"line\">import requests</span><br><span class=\"line\">from datetime import datetime, timedelta</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># MySQL 접속정보</span></span><br><span class=\"line\">REGION = <span class=\"string\">'REGION'</span></span><br><span class=\"line\"></span><br><span class=\"line\">rds_host = <span class=\"string\">\"RDS_ENDPOINT\"</span></span><br><span class=\"line\">name = <span class=\"string\">\"ID\"</span></span><br><span class=\"line\">password = <span class=\"string\">\"PW\"</span></span><br><span class=\"line\">db_name = <span class=\"string\">\"DB_NAME\"</span></span><br><span class=\"line\">conn = pymysql.connect(rds_host, user=name, passwd=password, db=db_name, connect_timeout=5, charset=<span class=\"string\">'utf8'</span>,</span><br><span class=\"line\">                       cursorclass=pymysql.cursors.DictCursor)</span><br><span class=\"line\">                        </span><br><span class=\"line\"> </span><br><span class=\"line\">def lambda_handler(event, context):</span><br><span class=\"line\">    try:</span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">TODO:</span>  1. MySQL에서 Region관련정보 받아오기</span></span><br><span class=\"line\">        result = [] <span class=\"comment\">#list</span></span><br><span class=\"line\">        dic = &#123;&#125;    <span class=\"comment\">#dictionary</span></span><br><span class=\"line\">        mysqlList = [] <span class=\"comment\">#list</span></span><br><span class=\"line\">        with conn.cursor(pymysql.cursors.DictCursor) as cur:</span><br><span class=\"line\">            cur.execute(<span class=\"string\">\"\"</span><span class=\"string\">\"select * from NEW_WEATHER_REGION_CD\"</span><span class=\"string\">\"\"</span>)</span><br><span class=\"line\">            conn.commit()</span><br><span class=\"line\">     </span><br><span class=\"line\">            <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> cur.fetchall():</span><br><span class=\"line\">                result.append(row)</span><br><span class=\"line\">     </span><br><span class=\"line\">            <span class=\"keyword\">for</span> jsons <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">                loaded_json = json.loads(json.dumps(jsons, indent=4, sort_keys=True, default=str, ensure_ascii=False))</span><br><span class=\"line\">                <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> loaded_json:</span><br><span class=\"line\">                    dic[x]=loaded_json[x]</span><br><span class=\"line\">                grid_x = dic.get(<span class=\"string\">'GRID_X'</span>)</span><br><span class=\"line\">                grid_y = dic.get(<span class=\"string\">'GRID_Y'</span>)</span><br><span class=\"line\">     </span><br><span class=\"line\">                <span class=\"comment\"># <span class=\"doctag\">TODO:</span> 2. URL셋팅후 데이터 받기(초단기 예보)</span></span><br><span class=\"line\">                URL = <span class=\"string\">'http://apis.data.go.kr/1360000/VilageFcstInfoService/getUltraSrtFcst?serviceKey=%2FMRb4fl9gpVLWGb8ErX6H6mZb9gDqRtC7UT88AMSI1tP3FV989QpqhTpglpDlIwMowfV9Fhkei5gibFb%2B7L5pA%3D%3D&amp;'</span></span><br><span class=\"line\">                params = &#123;</span><br><span class=\"line\">                    <span class=\"string\">'numOfRows'</span>: <span class=\"string\">'1000'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'pageNo'</span>:<span class=\"string\">'1'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'dataType'</span>:<span class=\"string\">'JSON'</span>,</span><br><span class=\"line\">                    <span class=\"string\">'base_date'</span>:datetime.today().strftime(<span class=\"string\">\"%Y%m%d\"</span>),</span><br><span class=\"line\">                    <span class=\"string\">'base_time'</span>:(datetime.today() + timedelta(hours=-1)).strftime(<span class=\"string\">\"%H00\"</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                res = requests.get(URL, params=params)</span><br><span class=\"line\">                URL = res.url</span><br><span class=\"line\">                <span class=\"comment\"># x, y 좌표 설정</span></span><br><span class=\"line\">                regionParam = &#123;</span><br><span class=\"line\">                    <span class=\"string\">'nx'</span>:grid_x, <span class=\"string\">'ny'</span>:grid_y</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                res = requests.get(URL, params=regionParam) <span class=\"comment\"># 실제 데이터 받기.</span></span><br><span class=\"line\">     </span><br><span class=\"line\">                <span class=\"comment\"># <span class=\"doctag\">TODO:</span> 3 데이터가 정상적으로 들어와있는지 확인하기(우선은 Header의 정보 중 ResultCode로 판단)</span></span><br><span class=\"line\">                resultCode = <span class=\"string\">\"\"</span></span><br><span class=\"line\">                resultMsg = <span class=\"string\">\"\"</span></span><br><span class=\"line\">                dict = json.loads(json.dumps(res.text, indent=4, sort_keys=True, default=str, ensure_ascii=False))</span><br><span class=\"line\">                dict = json.loads(dict)</span><br><span class=\"line\">                <span class=\"keyword\">for</span> resultJson <span class=\"keyword\">in</span> dict[<span class=\"string\">'response'</span>][<span class=\"string\">'header'</span>]:</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(resultJson == <span class=\"string\">\"resultCode\"</span>):</span><br><span class=\"line\">                        resultCode = dict[<span class=\"string\">'response'</span>][<span class=\"string\">'header'</span>][<span class=\"string\">'resultCode'</span>]</span><br><span class=\"line\">                    <span class=\"keyword\">elif</span>(resultJson == <span class=\"string\">\"resultMsg\"</span>):</span><br><span class=\"line\">                        resultMsg = dict[<span class=\"string\">'response'</span>][<span class=\"string\">'header'</span>][<span class=\"string\">'resultMsg'</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                <span class=\"keyword\">if</span>(resultCode != <span class=\"string\">\"00\"</span>): <span class=\"comment\"># 00이 정상이고, 나머지가 에러다... 로그로 남기면 뭐가 좋지않을까 해서 남겨본다.</span></span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">\"ERROR_CD : \"</span> + resultCode + <span class=\"string\">\"   /   \"</span> + <span class=\"string\">\"ERROR_MSG : \"</span> + resultMsg)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    dictionary = json.loads(json.dumps(res.text, sort_keys=True, default=str, ensure_ascii=False))</span><br><span class=\"line\">                    <span class=\"comment\"># 왜 dictionary가 2번이나 호출됫냐면... python특성인지 모르겠으나 형변환이 없으므로 강제 형변환을 위해 사용했음.</span></span><br><span class=\"line\">                    dictionary = json.loads(dictionary)</span><br><span class=\"line\">                    <span class=\"comment\"># 날씨item별 순차 읽기</span></span><br><span class=\"line\">                    weatherDic = &#123;&#125;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> weather <span class=\"keyword\">in</span> dictionary[<span class=\"string\">'response'</span>][<span class=\"string\">'body'</span>][<span class=\"string\">'items'</span>][<span class=\"string\">'item'</span>]:</span><br><span class=\"line\">                        <span class=\"comment\"># 넣고자 하는 시간 체크(현재시간이어야 한다)</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span>(weather[<span class=\"string\">'fcstTime'</span>] == (datetime.today().strftime(<span class=\"string\">\"%H00\"</span>))):</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"LGT\"</span>): <span class=\"comment\"># 낙뢰</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"PTY\"</span>): <span class=\"comment\"># 강수형태</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"RN1\"</span>): <span class=\"comment\"># 1시간 강수량</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"SKY\"</span>): <span class=\"comment\"># 하늘상태</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"T1H\"</span>):<span class=\"comment\"># 기온</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"REH\"</span>): <span class=\"comment\"># 습도</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"UUU\"</span>): <span class=\"comment\"># 동서바람성분</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"VVV\"</span>): <span class=\"comment\"># 남북바람성분</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"VEC\"</span>): <span class=\"comment\"># 풍향</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                            <span class=\"keyword\">elif</span> (weather[<span class=\"string\">'category'</span>] == <span class=\"string\">\"WSD\"</span>): <span class=\"comment\"># 풍속</span></span><br><span class=\"line\">                                weatherDic[weather[<span class=\"string\">'category'</span>]]=weather[<span class=\"string\">\"fcstValue\"</span>]</span><br><span class=\"line\">     </span><br><span class=\"line\">                    <span class=\"comment\"># <span class=\"doctag\">TODO:</span> 4. weatherDic에 저장되어 있는 값을 MySQL 에 저장하기 위해 List에 저장</span></span><br><span class=\"line\">                    string = dic.get(<span class=\"string\">'REGION_CD'</span>), dic.get(<span class=\"string\">'STATE_NAME'</span>), dic.get(<span class=\"string\">'CITY_NAME'</span>), weatherDic.get(<span class=\"string\">'SKY'</span>), weatherDic.get(<span class=\"string\">'T1H'</span>), weatherDic.get(<span class=\"string\">'REH'</span>), weatherDic.get(<span class=\"string\">'RN1'</span>), weatherDic.get(<span class=\"string\">'PTY'</span>), weatherDic.get(<span class=\"string\">'VEC'</span>), weatherDic.get(<span class=\"string\">'WSD'</span>)</span><br><span class=\"line\">                    mysqlList.append(string)</span><br><span class=\"line\">     </span><br><span class=\"line\">            cur.close()</span><br><span class=\"line\">     </span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">TODO:</span> 5. 기존에 저장된 MySQL의 날씨값 삭제.</span></span><br><span class=\"line\">        with conn.cursor(pymysql.cursors.DictCursor) as cur:</span><br><span class=\"line\">            query = <span class=\"string\">\"TRUNCATE NEW_WEATHER_STATUS;\"</span></span><br><span class=\"line\">            cur.execute(query)</span><br><span class=\"line\">            conn.commit()</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"-------------\"</span>)</span><br><span class=\"line\">     </span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">TODO:</span> 6. 저장된 최종 List를 MySQL에 저장.</span></span><br><span class=\"line\">        with conn.cursor(pymysql.cursors.DictCursor) as cur:</span><br><span class=\"line\">            <span class=\"comment\"># 아무리 DB의 시스템시간을 바꾸어도 UTC+0인 시간만 오기에 어쩔 수 없이 \"DATE_ADD(NOW(), INTERVAL 9 HOUR)\" 를 넣었음.</span></span><br><span class=\"line\">            <span class=\"comment\"># 좋은 방법이 아니므로 다른 방법을 찾아야 하지 않을까? 지금 일단은 돌아감...</span></span><br><span class=\"line\">            query = <span class=\"string\">\"INSERT INTO NEW_WEATHER_STATUS (REGION_CD, STATE_NAME, CITY_NAME, ICON, TEMP, HUMI, RAINFALL, SNOWFALL, WINDDIR, WINDSPEED, REGISTER_AT) VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,DATE_ADD(NOW(), INTERVAL 9 HOUR));\"</span></span><br><span class=\"line\">            cur.executemany(query, mysqlList)</span><br><span class=\"line\">            conn.commit()</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"-------------\"</span>)</span><br><span class=\"line\">     </span><br><span class=\"line\">    except ImportError as exc:</span><br><span class=\"line\">        raise ImportError(</span><br><span class=\"line\">            <span class=\"string\">\"Couldn't import Django. Are you sure it's installed and \"</span></span><br><span class=\"line\">            <span class=\"string\">\"available on your PYTHONPATH environment variable? Did you \"</span></span><br><span class=\"line\">            <span class=\"string\">\"forget to activate a virtual environment?\"</span></span><br><span class=\"line\">        ) from exc</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>소스는 주석도 넣어놨고, 굳이 이정도까지 설명해야 하나 싶을정도여서, 따로 설명하지 않겠다.</li>\n</ul>\n<h2 id=\"결과화면\"><a href=\"#결과화면\" class=\"headerlink\" title=\"결과화면\"></a>결과화면</h2><p><a href=\"https://user-images.githubusercontent.com/62123161/81513300-6f345480-9362-11ea-96fb-fad4d3532da1.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81513300-6f345480-9362-11ea-96fb-fad4d3532da1.png\" alt=\"cloud9_08\"></a><br><a href=\"https://user-images.githubusercontent.com/62123161/81513298-6d6a9100-9362-11ea-880e-c24f94df6ecb.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81513298-6d6a9100-9362-11ea-880e-c24f94df6ecb.png\" alt=\"cloud9_09\"></a></p>\n","text":"개발환경 구축※ 기본 개발환경IntelliJPythonAWS Console설정1) DashBoard [Figure] ","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"Cloud9","slug":"Cloud9","count":1,"path":"api/tags/Cloud9.json"},{"name":"Web","slug":"Web","count":1,"path":"api/tags/Web.json"},{"name":"Debugger","slug":"Debugger","count":1,"path":"api/tags/Debugger.json"}]},{"title":"Lambda","slug":"Lambda","date":"2020-05-07T02:49:14.000Z","updated":"2020-05-11T04:12:56.385Z","comments":true,"pin":null,"path":"api/articles/Lambda.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81253068-88878900-9062-11ea-87b3-9a3713b6bd1d.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java 8, 11</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"Lambda-설명\"><a href=\"#Lambda-설명\" class=\"headerlink\" title=\"Lambda 설명\"></a>Lambda 설명</h2><h3 id=\"1-람다는-메모리에-따라-돌아가는-환경이-달라진다\"><a href=\"#1-람다는-메모리에-따라-돌아가는-환경이-달라진다\" class=\"headerlink\" title=\"1. 람다는 메모리에 따라 돌아가는 환경이 달라진다.\"></a>1. 람다는 메모리에 따라 돌아가는 환경이 달라진다.</h3><ul>\n<li>m5-Large, t2-small 등.. OS환경은 모두 Linux 환경이지만, Node와 Python 등은 Linux2에서 동작하고, 대부분의 언어는 Linux환경에서 돌아간다.)<h3 id=\"2-a람다-b람다-a람다-콜도-가능하다\"><a href=\"#2-a람다-b람다-a람다-콜도-가능하다\" class=\"headerlink\" title=\"2. a람다-b람다-a람다 콜도 가능하다.\"></a>2. a람다-b람다-a람다 콜도 가능하다.</h3><h3 id=\"3-람다는-동기식-비동기식의-선택이-가능하다\"><a href=\"#3-람다는-동기식-비동기식의-선택이-가능하다\" class=\"headerlink\" title=\"3. 람다는 동기식, 비동기식의 선택이 가능하다.\"></a>3. 람다는 동기식, 비동기식의 선택이 가능하다.</h3></li>\n<li>경동에서 사용하는 람다들은 모두 동기식이다. 비동기식은 몇가지 안된다.</li>\n</ul>\n<h3 id=\"4-Node-js-Python\"><a href=\"#4-Node-js-Python\" class=\"headerlink\" title=\"4. Node.js, Python\"></a>4. Node.js, Python</h3><ul>\n<li>AWS Lambda 콘솔, Cloud9, IDE 플러그인이 포함된 Visual Studio/PyCharm으로 작성가능.</li>\n<li>Cloud9은 웹 자체에서 디버깅(BreakPoint 가능)이 가능하며, 동시에 여러명이서 수정이 된다.</li>\n<li>실시간으로 페이지가 갱신되므로 다른사람과 같이 작업하면, 다른사람이 작업한 내용의 수정내용을 볼 수 있다. </li>\n</ul>\n<h3 id=\"5-한도\"><a href=\"#5-한도\" class=\"headerlink\" title=\"5. 한도\"></a>5. 한도</h3><ul>\n<li><p>총 람다 동시실행 갯수: 1000개 / 75GB 가 한도이며, VPC당 인터페이스 250개까지 지원한다.</p>\n</li>\n<li><p>현재 동시실행 갯수를 운영서버계정은 2500개까지 열어두었다. </p>\n</li>\n<li><p>사실 리밋은 언제든지 Support팀에 요청하면 풀 수 있다. 리밋을 상향한다고 하여도 추가비용이 발생하지는 않는다.</p>\n</li>\n<li><p>기본적으로 1000개인 Limit을 5000개까지는 올리고 싶다. 용량 75GB는 상향의 필요성을 못느낀다.(개인생각)</p>\n</li>\n<li><p>각 람다 별 제한사항<br><a href=\"https://user-images.githubusercontent.com/62123161/81253068-88878900-9062-11ea-87b3-9a3713b6bd1d.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81253068-88878900-9062-11ea-87b3-9a3713b6bd1d.png\" alt=\"lambda_01\"></a></p>\n</li>\n</ul>\n<h3 id=\"6-Trigger-출발점-과-Destination-목적점-을-직접-지정해줄-수도-있다\"><a href=\"#6-Trigger-출발점-과-Destination-목적점-을-직접-지정해줄-수도-있다\" class=\"headerlink\" title=\"6. Trigger(출발점)과 Destination(목적점)을 직접 지정해줄 수도 있다.\"></a>6. Trigger(출발점)과 Destination(목적점)을 직접 지정해줄 수도 있다.</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81251406-29277a00-905e-11ea-8afd-d501dfb1cbd0.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81251406-29277a00-905e-11ea-8afd-d501dfb1cbd0.png\" alt=\"lambda_02\"></a></p>\n<ul>\n<li>Trigger / Destination List<br><a href=\"https://user-images.githubusercontent.com/62123161/81251405-288ee380-905e-11ea-9ed2-d6cdc2f61c0d.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81251405-288ee380-905e-11ea-9ed2-d6cdc2f61c0d.png\" alt=\"lambda_03\"></a><br><a href=\"https://user-images.githubusercontent.com/62123161/81251404-288ee380-905e-11ea-80fa-3d4775ad102d.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81251404-288ee380-905e-11ea-80fa-3d4775ad102d.png\" alt=\"lambda_04\"></a></li>\n</ul>\n<h3 id=\"7-람다를-내부에서-실행시켜-외부의-값을-가져오려고-할때는-아래와-같은-순서를-따르면-된다\"><a href=\"#7-람다를-내부에서-실행시켜-외부의-값을-가져오려고-할때는-아래와-같은-순서를-따르면-된다\" class=\"headerlink\" title=\"7. 람다를 내부에서 실행시켜 외부의 값을 가져오려고 할때는 아래와 같은 순서를 따르면 된다.\"></a>7. 람다를 내부에서 실행시켜 외부의 값을 가져오려고 할때는 아래와 같은 순서를 따르면 된다.</h3><ul>\n<li>온수매트의 Kweather정보는 상관없으나, TAC의 AirKorea는 반드시 이 설정을 해주어야 한다.</li>\n<li>Lambda 함수를 Private Subnet에 위치시키고,(콘솔화면 기준 : VPC - RouteTable - Lambda 함수가 설정된 VPC - Subnet의 RouteTable 설정)</li>\n<li>RouteTable 정책을 Lambda Subnet을 0.0.0.0/0 인터넷망을 나갈때 NAT Gateway를 통하도록 설정(VPC - NAT Gatewat 에서 IP 를 확인하시고, 해당 Elastic IP(고정 IP)를 Whitelist 로 넣어줌) <a href=\"https://www.slideshare.net/addnull/aws-lambdas-with-a-static-outgoing-ip\" target=\"_blank\" rel=\"noopener\">https://www.slideshare.net/addnull/aws-lambdas-with-a-static-outgoing-ip</a></li>\n</ul>\n<h3 id=\"8-모니터링\"><a href=\"#8-모니터링\" class=\"headerlink\" title=\"8. 모니터링\"></a>8. 모니터링</h3><ul>\n<li>아래 그림처럼 수행 구간별로 구분해서 분석이 가능함. (참고용… 중요하지 않음)<img width=\"420\" alt=\"lambda_05\" src=\"https://user-images.githubusercontent.com/62123161/81251472-56742800-905e-11ea-9142-0687f7ccb0de.png\">\n\n</li>\n</ul>\n<h3 id=\"9-SDK\"><a href=\"#9-SDK\" class=\"headerlink\" title=\"9. SDK\"></a>9. SDK</h3><ul>\n<li>Java에 적용된 SDK들은 이미 Node.js나 Python에 적용 되어 있다.</li>\n<li>우리가 쓰고자 하는 기능은 당연히 이미 SDK로 나와있다. 예) Dynamo 제어, S3 Bucket 제어, RDS 제어, Kinesis 제어 등등….  </li>\n<li>위 a번의 근거는, 람다를 스크립트언어로 사용하는 곳이 많기에 우선적으로 라이브러리를 지원해주기 때문.</li>\n<li>상대적으로 람다를 Java로 쓰는 곳은 그다지 많이 없다.(구동에 시간이 많이 들기에 빠른반응을 해줘야하는 서비스의 경우 Java를 안쓴다고 전해들었다.)</li>\n</ul>\n<h3 id=\"10-Lambda-RDS\"><a href=\"#10-Lambda-RDS\" class=\"headerlink\" title=\"10. Lambda - RDS\"></a>10. Lambda - RDS</h3><p>Python AWS 공식 자습서 예제 : <a href=\"https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/services-rds-tutorial.html\" target=\"_blank\" rel=\"noopener\">https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/services-rds-tutorial.html</a><br>일반 블로그 Node.js 예제 : <a href=\"https://grip.news/archives/1411\" target=\"_blank\" rel=\"noopener\">https://grip.news/archives/1411</a><br>Node.js AWS 공식 설명서 예제 : <a href=\"https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-nodejs.html\" target=\"_blank\" rel=\"noopener\">https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-nodejs.html</a></p>\n<h2 id=\"결론\"><a href=\"#결론\" class=\"headerlink\" title=\"결론\"></a>결론</h2><p>위와 같은 람다의 특성으로 미루어 볼 때, 체크해야될 리스트는 아래와 같다.</p>\n<ol>\n<li>람다→람다를 호출하는 과정이 있을 수 있을지 설계단에서 한번 보아야 한다.</li>\n</ol>\n<ul>\n<li>스마트톡에는 람다→ 람다를 호출하는 과정이 없이, 기능별로만 쪼개놓은 상황이고, 기능이 겹친다고 하더라도 다 따로 만들어주었다.</li>\n</ul>\n<ol start=\"2\">\n<li>여러사람이 개발을 진행해야 한다면, Script언어를 같이 개발할 수 있는 Cloud9검토가 필요하다.(디버깅이 가능하고, 동시개발이 가능한점이 큰 이점. 히스토리도 AWS가 갖고있다.)</li>\n<li>한도는 최대한으로 늘려놓는 것이 좋을 것 같다. 1000→ 5000개정도. 또한, 각 람다별 메모리도 일단은 1024 이상으로 올려 사용하다가 사용량을 비교하여 낮추는 방향도 고려필요.</li>\n<li>VPC위에 lambda를 올려 실행시키는 방법을 미리 고민해두어야 함.</li>\n<li>SDK는 모두 제공하므로 걱정안해도 됨.</li>\n</ol>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava 8, 11AWS ConsoleLambda 설명1. 람다는 메모리에 따라 돌아가는 환경이 달라진다.m5-Large, t2-small 등.. OS환경은 모두 Linux 환경이지만, Node와 Python","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"Lambda","slug":"Lambda","count":1,"path":"api/tags/Lambda.json"},{"name":"java","slug":"java","count":1,"path":"api/tags/java.json"}]},{"title":"Lambda Python ColdStart Test","slug":"LambdaPythonColdStart","date":"2020-05-06T23:38:19.000Z","updated":"2020-05-11T05:40:02.120Z","comments":true,"pin":null,"path":"api/articles/LambdaPythonColdStart.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Python</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"Lambda-Python-설명\"><a href=\"#Lambda-Python-설명\" class=\"headerlink\" title=\"Lambda Python 설명\"></a>Lambda Python 설명</h2><ul>\n<li>팀장님께서 조사하신 내용을 토대로 Java가 콜드스타트에서 많은 시간을 소모한다는 점에 착안하여 Python으로 시도해보기로 함.</li>\n<li>Node로도 Python과 큰 차이없는 성능을 보여주었던 만큼 기대하고 테스트를 진행함.</li>\n</ul>\n<h2 id=\"설정\"><a href=\"#설정\" class=\"headerlink\" title=\"설정\"></a>설정</h2><ol>\n<li>pymysql 라이브러리를 Python 코드에 넣어야 함.</li>\n<li>가능하면 Layer에 넎어주는 편이 좋다.</li>\n</ol>\n<h3 id=\"개발\"><a href=\"#개발\" class=\"headerlink\" title=\"개발\"></a>개발</h3><h4 id=\"1-Lambda-접속\"><a href=\"#1-Lambda-접속\" class=\"headerlink\" title=\"1) Lambda 접속\"></a>1) Lambda 접속</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png\" alt=\"lambdapython_01\"></a></p>\n<h4 id=\"2-Create-Function-클릭-및-IAM권한까지-해서-함수생성\"><a href=\"#2-Create-Function-클릭-및-IAM권한까지-해서-함수생성\" class=\"headerlink\" title=\"2) Create Function 클릭 및 IAM권한까지 해서 함수생성\"></a>2) Create Function 클릭 및 IAM권한까지 해서 함수생성</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248121-a949e180-9056-11ea-8148-4a19eb45aa0e.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248121-a949e180-9056-11ea-8148-4a19eb45aa0e.png\" alt=\"lambdapython_02\"></a></p>\n<h4 id=\"3-Layer이라는-곳이-있음\"><a href=\"#3-Layer이라는-곳이-있음\" class=\"headerlink\" title=\"3) Layer이라는 곳이 있음.\"></a>3) Layer이라는 곳이 있음.</h4><ul>\n<li>자주쓰는 라이브러리들을 여기에 등록해서 땡겨쓰는건데, 필요하면 이 부분은 따로 설명하는 부분을 만들어야 할 듯.</li>\n<li>기본개념은 람다 밑에 계층을 만들어서 계층 내의 라이브러리를 저장해서 필요할때마다 import 해서 쓰는 개념.</li>\n<li>(참고로 아직 제대로 써보는 방법도 못찾아봤음)<br><a href=\"https://user-images.githubusercontent.com/62123161/81248120-a7801e00-9056-11ea-8709-a15ce1cbda8b.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248120-a7801e00-9056-11ea-8709-a15ce1cbda8b.png\" alt=\"lambdapython_03\"></a></li>\n</ul>\n<h4 id=\"4-Code-entry-type을-Upload-zip-file로-변경하고-밑의-Upload를-선택하여-위에-다운받은-파일을-넣는다\"><a href=\"#4-Code-entry-type을-Upload-zip-file로-변경하고-밑의-Upload를-선택하여-위에-다운받은-파일을-넣는다\" class=\"headerlink\" title=\"4) Code entry type을 Upload zip file로 변경하고 밑의 Upload를 선택하여 위에 다운받은 파일을 넣는다.\"></a>4) Code entry type을 Upload zip file로 변경하고 밑의 Upload를 선택하여 위에 다운받은 파일을 넣는다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248125-ab13a500-9056-11ea-8c95-ae25e76cf132.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248125-ab13a500-9056-11ea-8c95-ae25e76cf132.png\" alt=\"lambdapython_04\"></a></p>\n<ul>\n<li>(중요!!) 넣고 반드시 우측상단 Save노란색 버튼을 눌러줘야 한다. 안누르면 그냥 아무것도 안한상태가 됨.</li>\n</ul>\n<h4 id=\"5-저장-후-Code-entry-type을-Edit-code-inline으로-만들면-아래와-같은-화면이-나오고-코드를-직접-수정할-수-있다\"><a href=\"#5-저장-후-Code-entry-type을-Edit-code-inline으로-만들면-아래와-같은-화면이-나오고-코드를-직접-수정할-수-있다\" class=\"headerlink\" title=\"5) 저장 후 Code entry type을 Edit code inline으로 만들면 아래와 같은 화면이 나오고, 코드를 직접 수정할 수 있다.\"></a>5) 저장 후 Code entry type을 Edit code inline으로 만들면 아래와 같은 화면이 나오고, 코드를 직접 수정할 수 있다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248124-aa7b0e80-9056-11ea-9d30-8a7fef821dea.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248124-aa7b0e80-9056-11ea-9d30-8a7fef821dea.png\" alt=\"lambdapython_05\"></a></p>\n<ul>\n<li>(중요!!) Handler에 main.main 으로 넣고 세이브한다.</li>\n</ul>\n<h4 id=\"6-우측상단의-테스트케이스를-만들어서-테스트를-돌리면된다\"><a href=\"#6-우측상단의-테스트케이스를-만들어서-테스트를-돌리면된다\" class=\"headerlink\" title=\"6) 우측상단의 테스트케이스를 만들어서 테스트를 돌리면된다.\"></a>6) 우측상단의 테스트케이스를 만들어서 테스트를 돌리면된다.</h4><h3 id=\"끝\"><a href=\"#끝\" class=\"headerlink\" title=\"-끝-\"></a>-끝-</h3><h3 id=\"소스\"><a href=\"#소스\" class=\"headerlink\" title=\"소스\"></a>소스</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Full Source</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># A lambda function to interact with AWS RDS MySQL</span></span><br><span class=\"line\">import json</span><br><span class=\"line\">import pymysql</span><br><span class=\"line\">import sys</span><br><span class=\"line\"> </span><br><span class=\"line\">REGION = <span class=\"string\">'ap-northeast-2'</span></span><br><span class=\"line\"> </span><br><span class=\"line\">rds_host  = <span class=\"string\">\"RDS_ENDPOINT\"</span></span><br><span class=\"line\">name = <span class=\"string\">\"ID\"</span></span><br><span class=\"line\">password = <span class=\"string\">\"PW\"</span></span><br><span class=\"line\">db_name = <span class=\"string\">\"DATABASE_NAME\"</span></span><br><span class=\"line\"> </span><br><span class=\"line\">def save_events(event):</span><br><span class=\"line\">    <span class=\"string\">\"\"</span><span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">    This function fetches content from mysql RDS instance</span></span><br><span class=\"line\"><span class=\"string\">    \"</span><span class=\"string\">\"\"</span></span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    conn = pymysql.connect(rds_host, user=name, passwd=password, db=db_name, connect_timeout=5)</span><br><span class=\"line\">    with conn.cursor() as cur:</span><br><span class=\"line\">        <span class=\"comment\"># cur.execute(\"\"\"insert into test (id, name) values( %s, '%s')\"\"\" % (event['id'], event['name']))</span></span><br><span class=\"line\">        cur.execute(<span class=\"string\">\"\"</span><span class=\"string\">\"select * from [TABLE_NAME]\"</span><span class=\"string\">\"\"</span>)</span><br><span class=\"line\">        conn.commit()</span><br><span class=\"line\">        cur.close()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> cur:</span><br><span class=\"line\">            result.append(list(row))</span><br><span class=\"line\">        <span class=\"comment\"># print \"Data from RDS...\"</span></span><br><span class=\"line\">        <span class=\"built_in\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">'statusCode'</span>: 200,</span><br><span class=\"line\">        <span class=\"string\">'body'</span>: json.dumps(result)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">        <span class=\"comment\"># print result</span></span><br><span class=\"line\"> </span><br><span class=\"line\">def main(event, context):</span><br><span class=\"line\">    save_events(event)</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"테스트-결과\"><a href=\"#테스트-결과\" class=\"headerlink\" title=\"테스트 결과\"></a>테스트 결과</h3><h4 id=\"1-자바의-Cold-Start-이후-지속호출\"><a href=\"#1-자바의-Cold-Start-이후-지속호출\" class=\"headerlink\" title=\"1) 자바의 Cold Start 이후 지속호출\"></a>1) 자바의 Cold Start 이후 지속호출</h4><p>REPORT RequestId: e48ab981-212a-41c9-96e2-ed07b3f50d8d Duration: 2624.96 ms Billed Duration: 2700 ms Memory Size: 2048 MB Max Memory Used: 157 MB Init Duration: 314.42 ms<br>REPORT RequestId: 25754b1d-1eb5-4e47-b281-8f7f25f86b0e Duration: 2.34 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: 8e4b7664-f8bd-43bb-a93a-1ce762ff9e08 Duration: 8.53 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: c75c69c3-c25d-4ca1-a89f-b47568db2b32 Duration: 2.35 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: a8579b00-6799-4805-b20e-2bda8233f3bf Duration: 2.51 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB</p>\n<h4 id=\"2-Python의-Cold-Start-이후-지속호출\"><a href=\"#2-Python의-Cold-Start-이후-지속호출\" class=\"headerlink\" title=\"2) Python의 Cold Start 이후 지속호출\"></a>2) Python의 Cold Start 이후 지속호출</h4><p>REPORT RequestId: d9e08910-f520-46f1-998d-dc464ab906d4 Duration: 89.94 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 178.14 ms<br>REPORT RequestId: 3b38dbe2-50ef-4fa0-914f-fbe8f537fdda Duration: 56.36 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 53 MB<br>REPORT RequestId: f9943532-58b0-422e-b040-0e71a7f38837 Duration: 57.04 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB<br>REPORT RequestId: b53b4659-db4a-44c6-aca4-aacca7897648 Duration: 90.57 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 163.13 ms<br>REPORT RequestId: ef27297d-b738-44eb-b75f-a180ff58abc1 Duration: 187.70 ms Billed Duration: 200 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 164.85 ms</p>\n<h3 id=\"리포팅\"><a href=\"#리포팅\" class=\"headerlink\" title=\"리포팅\"></a>리포팅</h3><ol>\n<li>파이선 특징</li>\n</ol>\n<ul>\n<li>라이브러리를 모두 직접 등록해줘야 하는 단점…&lt;Maven, Gradle이 그립다.&gt;</li>\n<li>파일을 직접 넣어줘야하고, 지원되는 라이브러리가 생각보다 별로없다.</li>\n<li>디버깅이 어렵다.(이건 툴 문제)</li>\n</ul>\n<ol start=\"2\">\n<li>람다의 특성</li>\n</ol>\n<ul>\n<li>참고로 람다는 복사&lt;똑같은 람다 이름만바꿔서 생성&gt;가 안된다. 할거라면 새로 만들어야 한다. AWS정책임.</li>\n<li>Layer이라는 개념을 스크립트언어에서는 반드시 써줘야 하는데, 내생각보다 좀 좋은 기능으로 보인다.</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJPythonAWS ConsoleLambda Python 설명팀장님께서 조사하신 내용을 토대로 Java가 콜드스타트에서 많은 시간을 소모한다는 점에 착안하여 Python으로 시도해보기로 함.Node로도 Pyth","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"cold start","slug":"cold-start","count":1,"path":"api/tags/cold-start.json"},{"name":"hot start","slug":"hot-start","count":1,"path":"api/tags/hot-start.json"},{"name":"python","slug":"python","count":2,"path":"api/tags/python.json"}]},{"title":"SNS","slug":"SNS","date":"2020-05-06T05:26:34.000Z","updated":"2020-05-12T03:07:10.082Z","comments":true,"pin":null,"path":"api/articles/SNS.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81143669-536d2f00-8fad-11ea-8ade-3a21d5987656.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"SNS-설명\"><a href=\"#SNS-설명\" class=\"headerlink\" title=\"SNS 설명\"></a>SNS 설명</h2><ul>\n<li>사용자에게 Noti 보내주는게 주요 임무.</li>\n<li>기본 기능으로는 Push(FCM, GCM), 이메일, SMS, 등 … 다용도로 보낼 수 있다.</li>\n</ul>\n<h3 id=\"1-SNS-Topic\"><a href=\"#1-SNS-Topic\" class=\"headerlink\" title=\"1) SNS Topic\"></a>1) SNS Topic</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81143669-536d2f00-8fad-11ea-8ade-3a21d5987656.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81143669-536d2f00-8fad-11ea-8ade-3a21d5987656.png\" alt=\"sns_02\"></a></p>\n<ul>\n<li>Topic이라는 그룹개념을 생성하고, 메세지를 받을 Subscription들을 등록하면 된다. 원하는 Protocol을 설정하면 그대로 받을 수 있다.</li>\n<li>참고사항 : 서울 리전(ap-northeast-2)는 문자서비스(SMS)를 사용할 수 없다. 도쿄리전이나, Virginia 리전을 이용하면 좋다. </li>\n<li>그리고, 기본 Limit은 말도안되지만 1달러이다. 한도를 증액 요청해야 한다.</li>\n</ul>\n<h3 id=\"2-SNS-Subscription\"><a href=\"#2-SNS-Subscription\" class=\"headerlink\" title=\"2) SNS Subscription\"></a>2) SNS Subscription</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81143663-51a36b80-8fad-11ea-922e-568047d624c5.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81143663-51a36b80-8fad-11ea-922e-568047d624c5.png\" alt=\"sns_01\"></a></p>\n<ul>\n<li>Subscription은 말그대로 구독자다. </li>\n<li>HTTP(80), HTTPS(443), Email, SQS, Lambda 등 각종 AWS서비스와 3rd party 애플리케이션에 보낼 수 있다.</li>\n</ul>\n<h3 id=\"3-SNS-Publish-Message\"><a href=\"#3-SNS-Publish-Message\" class=\"headerlink\" title=\"3) SNS Publish Message\"></a>3) SNS Publish Message</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81143668-52d49880-8fad-11ea-99b6-946c8cbec576.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81143668-52d49880-8fad-11ea-99b6-946c8cbec576.png\" alt=\"sns_03\"></a></p>\n<ul>\n<li>Publish는 간단히 제목과 본문으로 보내줘도 된다. 큰 의미가 없다.</li>\n</ul>\n<h3 id=\"4-Subscriptions에-여러-EndPoint를-등록할-수-있고-각-Endpoint들을-그룹으로-묶어줄-수-있다\"><a href=\"#4-Subscriptions에-여러-EndPoint를-등록할-수-있고-각-Endpoint들을-그룹으로-묶어줄-수-있다\" class=\"headerlink\" title=\"4) Subscriptions에 여러 EndPoint를 등록할 수 있고, 각 Endpoint들을 그룹으로 묶어줄 수 있다.\"></a>4) Subscriptions에 여러 EndPoint를 등록할 수 있고, 각 Endpoint들을 그룹으로 묶어줄 수 있다.</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81145089-8533c500-8fb0-11ea-8ed7-96c10b10cc60.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81145089-8533c500-8fb0-11ea-8ed7-96c10b10cc60.png\" alt=\"sns_04\"></a></p>\n<h2 id=\"소스\"><a href=\"#소스\" class=\"headerlink\" title=\"소스\"></a>소스</h2><h3 id=\"1-Credentials\"><a href=\"#1-Credentials\" class=\"headerlink\" title=\"1) Credentials\"></a>1) Credentials</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>인증생성</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static BasicAWSCredentials creds = new BasicAWSCredentials(<span class=\"string\">\"ACCESS_KEY\"</span>,<span class=\"string\">\"SECRET_KEY\"</span>);</span><br><span class=\"line\">    public static AmazonSNSClient client = (AmazonSNSClient)((AmazonSNSClientBuilder)((AmazonSNSClientBuilder)AmazonSNSClient.builder().withCredentials(new AWSStaticCredentialsProvider(creds))).withRegion(aws_region)).build(); //provide credentials here</span><br><span class=\"line\">    public static AmazonSNS snsClient = (AmazonSNS)((AmazonSNSClientBuilder)((AmazonSNSClientBuilder) AmazonSNSClient.builder().withCredentials(new AWSStaticCredentialsProvider(creds))).withRegion(aws_region)).build();</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"2-Create-Topic\"><a href=\"#2-Create-Topic\" class=\"headerlink\" title=\"2) Create Topic\"></a>2) Create Topic</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>토픽 생성</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Create Topic</span><br><span class=\"line\">BasicAWSCredentials creds = new BasicAWSCredentials(aws_access_key_id,aws_secret_access_key);</span><br><span class=\"line\">AmazonSNS snsClient = (AmazonSNS)((AmazonSNSClientBuilder)((AmazonSNSClientBuilder) AmazonSNSClient.builder().withCredentials(new AWSStaticCredentialsProvider(creds))).withRegion(aws_region)).build();</span><br><span class=\"line\">CreateTopicResult createTopicResult = snsClient.createTopic(<span class=\"string\">\"myTopic\"</span>);</span><br><span class=\"line\">String topicArn = createTopicResult.getTopicArn();</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"3-Delete-Topic\"><a href=\"#3-Delete-Topic\" class=\"headerlink\" title=\"3) Delete Topic\"></a>3) Delete Topic</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>토픽삭제</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Delete Topic</span><br><span class=\"line\">BasicAWSCredentials creds = new BasicAWSCredentials(aws_access_key_id,aws_secret_access_key);</span><br><span class=\"line\">AmazonSNS snsClient = (AmazonSNS)((AmazonSNSClientBuilder)((AmazonSNSClientBuilder) AmazonSNSClient.builder().withCredentials(new AWSStaticCredentialsProvider(creds))).withRegion(aws_region)).build();</span><br><span class=\"line\">snsClient.deleteTopic(<span class=\"string\">\"myTopic\"</span>);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"4-Get-Topic-list\"><a href=\"#4-Get-Topic-list\" class=\"headerlink\" title=\"4) Get Topic list\"></a>4) Get Topic list</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>SNS내 토픽리스트 받아오기.</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//////TODO:SNS (List)</span><br><span class=\"line\">            ListTopicsResult listTopicsResult = snsClient.listTopics();</span><br><span class=\"line\">            HashMap&lt;String, String&gt; listTopics = new HashMap&lt;String, String&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(int i = 0; i&lt;listTopicsResult.getTopics().size();i++)&#123;</span><br><span class=\"line\">                String topic_arn = listTopicsResult.getTopics().get(i).toString().replace(<span class=\"string\">\"TopicArn: \"</span>,<span class=\"string\">\"\"</span>).replace(<span class=\"string\">\"&#123;\"</span>,<span class=\"string\">\"\"</span>).replace(<span class=\"string\">\"&#125;\"</span>,<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">                String[] topicSplit = topic_arn.split(<span class=\"string\">\":\"</span>);</span><br><span class=\"line\">                String topic_name = topicSplit[topicSplit.length-1];</span><br><span class=\"line\"></span><br><span class=\"line\">                listTopics.put(topic_name, topic_arn);</span><br><span class=\"line\">            &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"5-Publish-Message-Send\"><a href=\"#5-Publish-Message-Send\" class=\"headerlink\" title=\"5) Publish Message(Send)\"></a>5) Publish Message(Send)</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>TopicArn과 msg로 전달가능</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Publish a message to an Amazon SNS topic.</span><br><span class=\"line\">final String msg = <span class=\"string\">\"If you receive this message, publishing a message to an Amazon SNS topic works.\"</span>;</span><br><span class=\"line\">final PublishRequest publishRequest = new PublishRequest(topicArn, msg);</span><br><span class=\"line\">final PublishResult publishResponse = snsClient.publish(publishRequest);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"6-Etc…\"><a href=\"#6-Etc…\" class=\"headerlink\" title=\"6) Etc….\"></a>6) Etc….</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>(번외)SQS에 보내서 Queue 방식으로 SNS에 전송</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">            //TODO: search from topic list</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(findSNSArn.length() &gt; 0)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (findSQSArn.length() &gt; 0) &#123;</span><br><span class=\"line\">                    //TODO: subscribe!!!</span><br><span class=\"line\">                    Topics.subscribeQueue(snsClient, sqsClient, findSNSArn, findSQSArn);</span><br><span class=\"line\">                    //TODO: save the token to sns</span><br><span class=\"line\">                    String token_ARN = registerWithSNS(smartPhoneKey);</span><br><span class=\"line\">                    //TODO: userSeq, smartPhoneKey, smartPhoneType, token_ARN .....mySQL</span><br><span class=\"line\">                    String[] <span class=\"built_in\">where</span> = &#123;<span class=\"string\">\"USER_SEQ\"</span>, Integer.toString(userSeq)&#125;; //&#123;<span class=\"string\">\"gid\"</span>,<span class=\"string\">\"1\"</span>,<span class=\"string\">\"uid\"</span>,<span class=\"string\">\"2\"</span>,<span class=\"string\">\"CountryCD\"</span>,<span class=\"string\">\"1\"</span>,<span class=\"string\">\"test\"</span>&#125;;</span><br><span class=\"line\">                    ResultSet resultSet = mysqlCRUD_R(<span class=\"built_in\">where</span>, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">                    int row = rowCount(resultSet);</span><br><span class=\"line\">                    //<span class=\"keyword\">if</span>, row exist : update</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(row &gt; 0)&#123;</span><br><span class=\"line\">                        mysqlCRUD_CU(<span class=\"string\">\"Update\"</span>, token_ARN);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    //<span class=\"keyword\">if</span>, row not exist : insert</span><br><span class=\"line\">                    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                        mysqlCRUD_CU(<span class=\"string\">\"Create\"</span>, token_ARN);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//                //메세지전송!!</span><br><span class=\"line\">//                snsClient.publish(new PublishRequest(findSNSArn, <span class=\"string\">\"Hello SNS World\"</span>).withSubject(<span class=\"string\">\"Subject\"</span>));</span><br><span class=\"line\">//</span><br><span class=\"line\">//                List&lt;Message&gt; messages = sqsClient.receiveMessage(new ReceiveMessageRequest(findSQSArn).getMessages();</span><br><span class=\"line\">//                <span class=\"keyword\">if</span> (messages.size() &gt; 0) &#123;</span><br><span class=\"line\">//                    byte[] decodedBytes = Base64.decodeBase64((messages.get(0)).getBody().getBytes());</span><br><span class=\"line\">//                    System.out.println(<span class=\"string\">\"Message: \"</span> +  new String(decodedBytes));</span><br><span class=\"line\">//                &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">return</span> new GatewayResponse(<span class=\"string\">\"[SQS]Topic Arn does not exist.\"</span>, headers, 400);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">return</span> new GatewayResponse(<span class=\"string\">\"[SNS]Topic Arn does not exist.\"</span>, headers, 400);</span><br><span class=\"line\">            &#125;</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>(번외) Util들..</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    //TODO:find value from topic list</span><br><span class=\"line\">    public static String topicSearch(HashMap&lt;String, String&gt; hashMap, String topicName)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(hashMap.size() &gt; 0)&#123;</span><br><span class=\"line\">            String value = hashMap.get(topicName);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(value.length() &lt; 1)&#123;</span><br><span class=\"line\">                <span class=\"built_in\">return</span> <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">return</span> value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class=\"line\">    public String registerWithSNS(String token) &#123;</span><br><span class=\"line\">        String endpointArn = retrieveEndpointArn();</span><br><span class=\"line\"></span><br><span class=\"line\">        boolean updateNeeded = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        boolean createNeeded = (null == endpointArn);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (createNeeded) &#123;</span><br><span class=\"line\">            // No platform endpoint ARN is stored; need to call createEndpoint.</span><br><span class=\"line\">            endpointArn = createEndpoint(token, platformApplication_ARN);</span><br><span class=\"line\">            createNeeded = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Retrieving platform endpoint data...\"</span>);</span><br><span class=\"line\">        // Look up the platform endpoint and make sure the data <span class=\"keyword\">in</span> it is current, even <span class=\"keyword\">if</span></span><br><span class=\"line\">        // it was just created.</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            GetEndpointAttributesRequest geaReq =</span><br><span class=\"line\">                    new GetEndpointAttributesRequest()</span><br><span class=\"line\">                            .withEndpointArn(endpointArn);</span><br><span class=\"line\">            GetEndpointAttributesResult geaRes =</span><br><span class=\"line\">                    client.getEndpointAttributes(geaReq);</span><br><span class=\"line\"></span><br><span class=\"line\">            updateNeeded = !geaRes.getAttributes().get(<span class=\"string\">\"Token\"</span>).equals(token)</span><br><span class=\"line\">                    || !geaRes.getAttributes().get(<span class=\"string\">\"Enabled\"</span>).equalsIgnoreCase(<span class=\"string\">\"true\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; catch (NotFoundException nfe) &#123;</span><br><span class=\"line\">            // We had a stored ARN, but the platform endpoint associated with it</span><br><span class=\"line\">            // disappeared. Recreate it.</span><br><span class=\"line\">            createNeeded = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (createNeeded) &#123;</span><br><span class=\"line\">            createEndpoint(token, platformApplication_ARN);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"updateNeeded = \"</span> + updateNeeded);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (updateNeeded) &#123;</span><br><span class=\"line\">            // The platform endpoint is out of sync with the current data;</span><br><span class=\"line\">            // update the token and <span class=\"built_in\">enable</span> it.</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Updating platform endpoint \"</span> + endpointArn);</span><br><span class=\"line\">            Map attribs = new HashMap();</span><br><span class=\"line\">            attribs.put(<span class=\"string\">\"Token\"</span>, token);</span><br><span class=\"line\">            attribs.put(<span class=\"string\">\"Enabled\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">            SetEndpointAttributesRequest saeReq =</span><br><span class=\"line\">                    new SetEndpointAttributesRequest()</span><br><span class=\"line\">                            .withEndpointArn(endpointArn)</span><br><span class=\"line\">                            .withAttributes(attribs);</span><br><span class=\"line\">            client.setEndpointAttributes(saeReq);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> endpointArn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span> never null</span><br><span class=\"line\">     * */</span><br><span class=\"line\">    private String createEndpoint(String token, String PlatformApplicationARN) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        String endpointArn = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Creating platform endpoint with token \"</span> + token);</span><br><span class=\"line\">            CreatePlatformEndpointRequest cpeReq =</span><br><span class=\"line\">                    new CreatePlatformEndpointRequest()</span><br><span class=\"line\">//                            .withPlatformApplicationArn(applicationArn)</span><br><span class=\"line\">                            .withPlatformApplicationArn(platformApplication_ARN)</span><br><span class=\"line\">                            .withToken(token);</span><br><span class=\"line\">            CreatePlatformEndpointResult cpeRes = client</span><br><span class=\"line\">                    .createPlatformEndpoint(cpeReq);</span><br><span class=\"line\">            endpointArn = cpeRes.getEndpointArn();</span><br><span class=\"line\">        &#125; catch (InvalidParameterException ipe) &#123;</span><br><span class=\"line\">            String message = ipe.getErrorMessage();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Exception message: \"</span> + message);</span><br><span class=\"line\">            Pattern p = Pattern</span><br><span class=\"line\">                    .compile(<span class=\"string\">\".*Endpoint (arn:aws:sns[^ ]+) already exists \"</span> +</span><br><span class=\"line\">                            <span class=\"string\">\"with the same [Tt]oken.*\"</span>);</span><br><span class=\"line\">            Matcher m = p.matcher(message);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (m.matches()) &#123;</span><br><span class=\"line\">                // The platform endpoint already exists <span class=\"keyword\">for</span> this token, but with</span><br><span class=\"line\">                // additional custom data that</span><br><span class=\"line\">                // createEndpoint does not want to overwrite. Just use the</span><br><span class=\"line\">                // existing platform endpoint.</span><br><span class=\"line\">                endpointArn = m.group(1);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                // Rethrow the exception, the input is actually bad.</span><br><span class=\"line\">                throw ipe;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        storeEndpointArn(endpointArn);</span><br><span class=\"line\">        <span class=\"built_in\">return</span> endpointArn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span> the ARN the app was registered under previously, or null <span class=\"keyword\">if</span> no</span><br><span class=\"line\">     *         platform endpoint ARN is stored.</span><br><span class=\"line\">     */</span><br><span class=\"line\">    private String <span class=\"function\"><span class=\"title\">retrieveEndpointArn</span></span>() &#123;</span><br><span class=\"line\">        // Retrieve the platform endpoint ARN from permanent storage,</span><br><span class=\"line\">        // or <span class=\"built_in\">return</span> null <span class=\"keyword\">if</span> null is stored.</span><br><span class=\"line\">        <span class=\"built_in\">return</span> arnStorage;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * Stores the platform endpoint ARN <span class=\"keyword\">in</span> permanent storage <span class=\"keyword\">for</span> lookup next time.</span><br><span class=\"line\">     * */</span><br><span class=\"line\">    private void storeEndpointArn(String endpointArn) &#123;</span><br><span class=\"line\">        // Write the platform endpoint ARN to permanent storage.</span><br><span class=\"line\">        arnStorage = endpointArn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class=\"line\">    public static ResultSet mysqlCRUD_R(String[] <span class=\"built_in\">where</span>, String orderby)&#123;</span><br><span class=\"line\">        Connection conn = null;</span><br><span class=\"line\">        Statement stmt = null;</span><br><span class=\"line\"></span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            Class.forName(JDBC_DRIVER);</span><br><span class=\"line\">            conn = DriverManager.getConnection(mySQLConnection,USERNAME,PASSWORD);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"\\n- MySQL Connection\"</span>);</span><br><span class=\"line\">            stmt = conn.createStatement(</span><br><span class=\"line\">                    ResultSet.TYPE_SCROLL_INSENSITIVE,</span><br><span class=\"line\">                    ResultSet.CONCUR_READ_ONLY);</span><br><span class=\"line\"></span><br><span class=\"line\">            String sql;</span><br><span class=\"line\">            sql = <span class=\"string\">\"SELECT * FROM \"</span>+insertDataTableName;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(where.length &gt; 0) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((where.length % 2) == 0) &#123;//Even Number</span><br><span class=\"line\">                    String str = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">                    str += <span class=\"string\">\" WHERE \"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (int i = 0; i &lt; where.length; i++) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>((where.length/2) == ((i/2)+1))&#123;//final</span><br><span class=\"line\">                            str += <span class=\"built_in\">where</span>[i] + <span class=\"string\">\"='\"</span> + <span class=\"built_in\">where</span>[i + 1] + <span class=\"string\">\"' \"</span>;</span><br><span class=\"line\">                            i++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                            str += <span class=\"built_in\">where</span>[i] + <span class=\"string\">\"='\"</span> + <span class=\"built_in\">where</span>[i + 1] + <span class=\"string\">\"' AND \"</span>;</span><br><span class=\"line\">                            i++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    sql += str;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123; //Odd Number</span><br><span class=\"line\">                    String str = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">                    str += <span class=\"string\">\" WHERE \"</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (int i = 0; i &lt; where.length - 1; i++) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>((where.length/2) == ((i/2)+1))&#123;//final</span><br><span class=\"line\">                            str += <span class=\"built_in\">where</span>[i] + <span class=\"string\">\"='\"</span> + <span class=\"built_in\">where</span>[i + 1] + <span class=\"string\">\"' \"</span>;</span><br><span class=\"line\">                            i++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                            str += <span class=\"built_in\">where</span>[i] + <span class=\"string\">\"='\"</span> + <span class=\"built_in\">where</span>[i + 1] + <span class=\"string\">\"' AND \"</span>;</span><br><span class=\"line\">                            i++;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    sql += str;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(orderby.length()&gt;0)&#123;</span><br><span class=\"line\">                sql += orderby;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            rs = stmt.executeQuery(sql);</span><br><span class=\"line\">            int row = rowCount(rs);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span>(rs.next())&#123;</span><br><span class=\"line\">                String groupName = rs.getString(<span class=\"string\">\"USER_SEQ\"</span>);</span><br><span class=\"line\">                String memberName = rs.getString(<span class=\"string\">\"SMARTPHONE_KEY\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                System.out.print(<span class=\"string\">\"\\n** USER_SEQ : \"</span> + groupName);</span><br><span class=\"line\">                System.out.print(<span class=\"string\">\"\\n    -&gt; SMARTPHONE_KEY: \"</span> + memberName);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            //rs.close();</span><br><span class=\"line\">            //stmt.close();</span><br><span class=\"line\">            //conn.close();</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;catch(SQLException se1)&#123;</span><br><span class=\"line\">            se1.printStackTrace();</span><br><span class=\"line\">        &#125;catch(Exception ex)&#123;</span><br><span class=\"line\">            ex.printStackTrace();</span><br><span class=\"line\">        &#125;finally&#123;</span><br><span class=\"line\">//            try&#123;</span><br><span class=\"line\">//                <span class=\"keyword\">if</span>(stmt!=null)</span><br><span class=\"line\">//                    stmt.close();</span><br><span class=\"line\">//            &#125;catch(SQLException se2)&#123;</span><br><span class=\"line\">//</span><br><span class=\"line\">//            &#125;</span><br><span class=\"line\">//            try&#123;</span><br><span class=\"line\">//                <span class=\"keyword\">if</span>(conn!=null)</span><br><span class=\"line\">//                    conn.close();</span><br><span class=\"line\">//            &#125;catch(SQLException se)&#123;</span><br><span class=\"line\">//                se.printStackTrace();</span><br><span class=\"line\">//            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"\\n\\n- MySQL Connection Close\"</span>);</span><br><span class=\"line\">            <span class=\"built_in\">return</span> rs;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public static int rowCount(ResultSet resultSet)&#123;</span><br><span class=\"line\">        int size = 0;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            resultSet.last();</span><br><span class=\"line\">            size = resultSet.getRow();</span><br><span class=\"line\">            resultSet.beforeFirst();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        catch(Exception ex) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> 0;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> size;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public static ResultSet mysqlCRUD_CU(String devide, String token_ARN)&#123;</span><br><span class=\"line\">        Connection con = null;</span><br><span class=\"line\">        PreparedStatement pstmt = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            String SQL = null;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(devide == <span class=\"string\">\"Create\"</span>)&#123;</span><br><span class=\"line\">                SQL = <span class=\"string\">\"INSERT문\"</span>;</span><br><span class=\"line\">                Class.forName(JDBC_DRIVER);</span><br><span class=\"line\">                con = DriverManager.getConnection(mySQLConnection, USERNAME, PASSWORD);</span><br><span class=\"line\">                java.util.Date utilDate = new java.util.Date ();</span><br><span class=\"line\">                pstmt = con.prepareStatement(SQL);</span><br><span class=\"line\">                pstmt.setInt(N,VALUE);</span><br><span class=\"line\">                pstmt.setString(N, VALUE);</span><br><span class=\"line\">                pstmt.setNull(N, Types.VARCHAR); //java.sql.Types.NULL</span><br><span class=\"line\">                pstmt.setDate(N, java.sql.Date.valueOf(java.time.LocalDate.now()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(devide == <span class=\"string\">\"Update\"</span>)&#123;</span><br><span class=\"line\">                SQL = <span class=\"string\">\"UPDATE문\"</span>;</span><br><span class=\"line\">                Class.forName(JDBC_DRIVER);</span><br><span class=\"line\">                con = DriverManager.getConnection(mySQLConnection, USERNAME, PASSWORD);</span><br><span class=\"line\">                java.util.Date utilDate = new java.util.Date ();</span><br><span class=\"line\">                pstmt = con.prepareStatement(SQL);</span><br><span class=\"line\">                pstmt.setString(N, VALUE);</span><br><span class=\"line\">                pstmt.setInt(N, VALUE);</span><br><span class=\"line\">                pstmt.setNull(N, Types.VARCHAR); //java.sql.Types.NULL</span><br><span class=\"line\">                pstmt.setDate(N, java.sql.Date.valueOf(java.time.LocalDate.now()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">return</span> rs;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            int r = pstmt.executeUpdate();</span><br><span class=\"line\">        &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> rs=null;</span><br><span class=\"line\">        &#125; catch (ClassNotFoundException e1) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> rs=null;</span><br><span class=\"line\">        &#125; finally &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pstmt != null) &#123;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    pstmt.close();</span><br><span class=\"line\">                &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (con != null) &#123;</span><br><span class=\"line\">                try &#123;</span><br><span class=\"line\">                    con.close();</span><br><span class=\"line\">                &#125; catch (SQLException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> rs;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"번외\"><a href=\"#번외\" class=\"headerlink\" title=\"번외\"></a>번외</h3><ul>\n<li>각 유형의 가입자에게 다른 컨텐츠를 보내려면 “각 전송 프로토콜에 대한 사용자 정의 페이로드”를 선택한 다음 각 프로토콜에 대한 지시 사항이있는 JSON 오브젝트를 삽입<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"default\"</span>: <span class=\"string\">\"Sample fallback message\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"email\"</span>: <span class=\"string\">\"Sample message for email endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"sqs\"</span>: <span class=\"string\">\"Sample message for Amazon SQS endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"lambda\"</span>: <span class=\"string\">\"Sample message for AWS Lambda endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"http\"</span>: <span class=\"string\">\"Sample message for HTTP endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"https\"</span>: <span class=\"string\">\"Sample message for HTTPS endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"sms\"</span>: <span class=\"string\">\"Sample message for SMS endpoints\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"APNS\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\": \\\"Sample message for iOS endpoints\\\"&#125; &#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"APNS_SANDBOX\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\":\\\"Sample message for iOS development endpoints\\\"&#125;&#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"APNS_VOIP\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\":\\\"Sample message for Apple VoIP endpoints\\\"&#125;&#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"APNS_VOIP_SANDBOX\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\": \\\"Sample message for Apple VoIP development endpoints\\\"&#125; &#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"MACOS\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\":\\\"Sample message for MacOS endpoints\\\"&#125;&#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"MACOS_SANDBOX\"</span>: <span class=\"string\">\"&#123;\\\"aps\\\":&#123;\\\"alert\\\": \\\"Sample message for MacOS development endpoints\\\"&#125; &#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"GCM\"</span>: <span class=\"string\">\"&#123; \\\"data\\\": &#123; \\\"message\\\": \\\"Sample message for Android endpoints\\\" &#125; &#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"ADM\"</span>: <span class=\"string\">\"&#123; \\\"data\\\": &#123; \\\"message\\\": \\\"Sample message for FireOS endpoints\\\" &#125; &#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"BAIDU\"</span>: <span class=\"string\">\"&#123;\\\"title\\\":\\\"Sample message title\\\",\\\"description\\\":\\\"Sample message for Baidu endpoints\\\"&#125;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"MPNS\"</span>: <span class=\"string\">\"&lt;?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?&gt;&lt;wp:Notification xmlns:wp=\\\"WPNotification\\\"&gt;&lt;wp:Tile&gt;&lt;wp:Count&gt;ENTER COUNT&lt;/wp:Count&gt;&lt;wp:Title&gt;Sample message for Windows Phone 7+ endpoints&lt;/wp:Title&gt;&lt;/wp:Tile&gt;&lt;/wp:Notification&gt;\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"WNS\"</span>: <span class=\"string\">\"&lt;badge version=\\\"1\\\" value=\\\"42\\\"/&gt;\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS ConsoleSNS 설명사용자에게 Noti 보내주는게 주요 임무.기본 기능으로는 Push(FCM, GCM), 이메일, SMS, 등 … 다용도로 보낼 수 있다.1) SNS Topic","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"secretsmanager","slug":"secretsmanager","count":2,"path":"api/tags/secretsmanager.json"},{"name":"Secret","slug":"Secret","count":2,"path":"api/tags/Secret.json"}]},{"title":"Secretmanager","slug":"Secretmanager","date":"2020-05-06T05:09:57.000Z","updated":"2020-05-11T03:36:12.943Z","comments":true,"pin":null,"path":"api/articles/Secretmanager.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81140306-e1441c80-8fa3-11ea-83b9-f4eed46627c9.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"SecretsManager-설명\"><a href=\"#SecretsManager-설명\" class=\"headerlink\" title=\"SecretsManager 설명\"></a>SecretsManager 설명</h2><ul>\n<li><p>이름에서 유추가 가능하지 않은가? 비밀스런 Key를 가지고 있는(관리하는) 서비스라고 보면 쉽다.</p>\n</li>\n<li><p>사실 비밀까지는 아니지만 환경변수를 받아서 사용하는 용도로 쓰고 있다. 자주 변하지 않는 변수로는 아래와 같은….<br>1) RDS 접속정보(주소, ID, PW)<br>2) SNS 그룹, 기능사양인 알림 메세지<br>3) Access Key, Secret Key<br>4) IoT Core 접속이나 Control을 위한 ARN들…<br>5) 외부 FTP 접속정보<br>6) 회원정보 관리를 위한 Cognito 접속정보<br><a href=\"https://user-images.githubusercontent.com/62123161/81140306-e1441c80-8fa3-11ea-83b9-f4eed46627c9.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81140306-e1441c80-8fa3-11ea-83b9-f4eed46627c9.png\" alt=\"secretmanager_01\"></a></p>\n</li>\n<li><p>참고로, Secrets Manager에 값을 넣는 것은 CLI와 콘솔 두개뿐이다. (API 호출로 넣을 수 없다는 소리이다.)</p>\n</li>\n<li><p>코딩으로 할 수 있는건 조회만 가능하다. (더 이상의 설명은 생략한다.)</p>\n</li>\n</ul>\n<h3 id=\"1-Secret-생성\"><a href=\"#1-Secret-생성\" class=\"headerlink\" title=\"1) Secret 생성\"></a>1) Secret 생성</h3><h4 id=\"Secret-Type\"><a href=\"#Secret-Type\" class=\"headerlink\" title=\"Secret Type\"></a>Secret Type</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81145165-b7ddbd80-8fb0-11ea-839a-4fb3f7e37f28.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81145165-b7ddbd80-8fb0-11ea-839a-4fb3f7e37f28.png\" alt=\"secretmanager_02\"></a></p>\n<ul>\n<li>너무 직관적으로 다 써져있기에 크게 설명할게 없다. 우선, 우리 Secrets Manager는 모두 “Other type of Secret”을 사용하고 있음(API 호출 용도)</li>\n<li>다른 type을 선택하면 해당 DB 인스턴스에 접근이 쉽게 가능하다.</li>\n<li>다른 type들은 직접 설정해서 테스트해보기 바란다. (근데 나는 한번하고 안해봤다..)</li>\n</ul>\n<h4 id=\"Key-Value\"><a href=\"#Key-Value\" class=\"headerlink\" title=\"Key / Value\"></a>Key / Value</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81140303-e0ab8600-8fa3-11ea-8c3a-1609cca6120e.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81140303-e0ab8600-8fa3-11ea-8c3a-1609cca6120e.png\" alt=\"secretmanager_03\"></a></p>\n<ul>\n<li>Key &amp; Value를 Json형태로 작성해도 좋고, MessageBox에 작성하여도 좋다. (어째든 받아 쓸때는 Json이다.)</li>\n<li>Encryption Key는 가급적 기본으로…(암호화를 원한다면 직접 해주어도 좋다. 다만, 호출해서 꺼내쓸때 복호화를 해줘야 읽을 수 있다.)</li>\n</ul>\n<h4 id=\"Name-and-Description\"><a href=\"#Name-and-Description\" class=\"headerlink\" title=\"Name and Description\"></a>Name and Description</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81140301-e012ef80-8fa3-11ea-854b-295e78aff2a2.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81140301-e012ef80-8fa3-11ea-854b-295e78aff2a2.png\" alt=\"secretmanager_04\"></a></p>\n<ul>\n<li>설명은 따로 하지않겠다. 이제 이쯤 되면 봐도 알지 않는가?</li>\n</ul>\n<h4 id=\"Configure-rotation\"><a href=\"#Configure-rotation\" class=\"headerlink\" title=\"Configure rotation\"></a>Configure rotation</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81140297-dee1c280-8fa3-11ea-9e65-1830cb3b5dc2.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81140297-dee1c280-8fa3-11ea-9e65-1830cb3b5dc2.png\" alt=\"secretmanager_05\"></a></p>\n<ul>\n<li>회전주기라고 읽지말고… 번역기 돌리면 그렇게 나온다..</li>\n<li>말그대로 Key/Value에 대해 Rotation 돌리면서 특정 값을 변경해주는 것이다. </li>\n<li>Lambda를 만들어서 주기적으로 Value를 변경해주는 기능인데, 주기적으로 변경을 해줘야하는 값(암호 및 키)의 경우 이 기능을 사용하면 좋다.(참고로, 만들어두면 자동으로 돌아준다.)</li>\n</ul>\n<h4 id=\"Sample-Code\"><a href=\"#Sample-Code\" class=\"headerlink\" title=\"Sample Code\"></a>Sample Code</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81140411-31bb7a00-8fa4-11ea-83b7-4c2e57b494cd.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81140411-31bb7a00-8fa4-11ea-83b7-4c2e57b494cd.png\" alt=\"secretmanager_06\"></a></p>\n<ul>\n<li>내가 소스를 설명하거나 찾아야 할 필요 없이, 설명도 해주고 알아서 만들어준다.</li>\n<li>물론, 조회만이니까 어마어마한 양의 소스가 들은 것은 아니다.</li>\n<li>총 6가지의 언어에 대해 지원한다.</li>\n</ul>\n<h3 id=\"2-소스\"><a href=\"#2-소스\" class=\"headerlink\" title=\"2) 소스\"></a>2) 소스</h3><h4 id=\"Gradle\"><a href=\"#Gradle\" class=\"headerlink\" title=\"Gradle\"></a>Gradle</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compileJava &#123;</span><br><span class=\"line\">    sourceCompatibility = 1.8</span><br><span class=\"line\">    targetCompatibility = 1.8</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">compileJava.options.encoding = <span class=\"string\">\"UTF-8\"</span></span><br><span class=\"line\">compileTestJava.options.encoding = <span class=\"string\">\"UTF-8\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    // https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-secretsmanager</span><br><span class=\"line\">    compile group: <span class=\"string\">'com.amazonaws'</span>, name: <span class=\"string\">'aws-java-sdk-secretsmanager'</span>, version: <span class=\"string\">'1.11.683'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"샘플도-있는데-이게-필요한지-모르겠다-그래도-대충이나마-만들었으니-참고하기-바람\"><a href=\"#샘플도-있는데-이게-필요한지-모르겠다-그래도-대충이나마-만들었으니-참고하기-바람\" class=\"headerlink\" title=\"샘플도 있는데 이게 필요한지 모르겠다.(그래도 대충이나마 만들었으니 참고하기 바람.)\"></a>샘플도 있는데 이게 필요한지 모르겠다.(그래도 대충이나마 만들었으니 참고하기 바람.)</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void <span class=\"function\"><span class=\"title\">getSecret</span></span>() &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        String secretName = <span class=\"string\">\"MyTestDatabaseMasterSecret\"</span>;</span><br><span class=\"line\">        String endpoint = <span class=\"string\">\"secretsmanager.ap-northeast-2.amazonaws.com\"</span>;</span><br><span class=\"line\">        String region = <span class=\"string\">\"ap-northeast-2\"</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">        AwsClientBuilder.EndpointConfiguration config = new AwsClientBuilder.EndpointConfiguration(endpoint, region);</span><br><span class=\"line\">        AWSSecretsManagerClientBuilder clientBuilder = AWSSecretsManagerClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setEndpointConfiguration(config);</span><br><span class=\"line\">        AWSSecretsManager client = clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        String secret;</span><br><span class=\"line\">        ByteBuffer binarySecretData;</span><br><span class=\"line\">        GetSecretValueRequest getSecretValueRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                .withSecretId(secretName).withVersionStage(<span class=\"string\">\"AWSCURRENT\"</span>);</span><br><span class=\"line\">        GetSecretValueResult getSecretValueResult = null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            getSecretValueResult = client.getSecretValue(getSecretValueRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">        &#125; catch(ResourceNotFoundException e) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"The requested secret \"</span> + secretName + <span class=\"string\">\" was not found\"</span>);</span><br><span class=\"line\">        &#125; catch (InvalidRequestException e) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"The request was invalid due to: \"</span> + e.getMessage());</span><br><span class=\"line\">        &#125; catch (InvalidParameterException e) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"The request had invalid params: \"</span> + e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        String json = getSecretValueResult.getSecretString();</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            JsonNode eventNode = OBJECT_MAPPER.readTree(json);</span><br><span class=\"line\">            String username = eventNode.path(<span class=\"string\">\"username\"</span>).asText();</span><br><span class=\"line\">            String password = eventNode.path(<span class=\"string\">\"password\"</span>).asText();</span><br><span class=\"line\">            String engine = eventNode.path(<span class=\"string\">\"engine\"</span>).asText();</span><br><span class=\"line\">            String host = eventNode.path(<span class=\"string\">\"host\"</span>).asText();</span><br><span class=\"line\">            String port = eventNode.path(<span class=\"string\">\"port\"</span>).asText();</span><br><span class=\"line\">            String dbname = eventNode.path(<span class=\"string\">\"dbname\"</span>).asText();</span><br><span class=\"line\">            String dbInstanceIdentifier = eventNode.path(<span class=\"string\">\"dbInstanceIdentifier\"</span>).asText();</span><br><span class=\"line\">            String name = eventNode.path(<span class=\"string\">\"name\"</span>).asText();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        catch(Exception e)&#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(getSecretValueResult == null) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        // Depending on whether the secret was a string or binary, one of these fields will be populated</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(getSecretValueResult.getSecretString() != null) &#123;</span><br><span class=\"line\">            secret = getSecretValueResult.getSecretString();</span><br><span class=\"line\">            System.out.println(secret);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            binarySecretData = getSecretValueResult.getSecretBinary();</span><br><span class=\"line\">            System.out.println(binarySecretData.toString());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"클래스화-한-소스\"><a href=\"#클래스화-한-소스\" class=\"headerlink\" title=\"클래스화 한 소스\"></a>클래스화 한 소스</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SecretManagerHelper &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    private static SecretManagerHelper secretManagerHelper;</span><br><span class=\"line\">    private static AWSSecretsManager awsSecretsManager;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static void init() throws IOException &#123;</span><br><span class=\"line\">        secretManagerHelper = new SecretManagerHelper();</span><br><span class=\"line\"> </span><br><span class=\"line\">        awsSecretsManager  = AWSSecretsManagerClientBuilder.standard()</span><br><span class=\"line\">                .withRegion(Config.AWS_SECRET_REGION)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        getSecretValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static SecretManagerHelper getInstance() throws IOException&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(null == secretManagerHelper)&#123;</span><br><span class=\"line\">            secretManagerHelper = new SecretManagerHelper();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(null == awsSecretsManager)&#123;</span><br><span class=\"line\">            init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> secretManagerHelper;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public static AWSSecretsManager getAWSSecretsManager() throws IOException&#123;</span><br><span class=\"line\">        getInstance();</span><br><span class=\"line\">        <span class=\"built_in\">return</span> awsSecretsManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    private static void getSecretValue() throws IOException &#123;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            GetSecretValueRequest getCredentialRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                    .withSecretId(Config.SECRET_IOT_CREDENTIALS);</span><br><span class=\"line\">            GetSecretValueResult getCredentialResult = awsSecretsManager.getSecretValue(getCredentialRequest);</span><br><span class=\"line\">            String credentialString = getCredentialResult.getSecretString();</span><br><span class=\"line\">            Config.IOT_CREDENTIALS_NODE = new ObjectMapper().readTree(credentialString);</span><br><span class=\"line\"> </span><br><span class=\"line\">            GetSecretValueRequest getRdsRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                    .withSecretId(Config.SECRET_IOT_RDS);</span><br><span class=\"line\">            GetSecretValueResult getRdsResult = awsSecretsManager.getSecretValue(getRdsRequest);</span><br><span class=\"line\">            String rdsString = getRdsResult.getSecretString();</span><br><span class=\"line\">            Config.IOT_RDS_NODE = new ObjectMapper().readTree(rdsString);</span><br><span class=\"line\"> </span><br><span class=\"line\">            GetSecretValueRequest getSnsRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                    .withSecretId(Config.SECRET_IOT_SNS);</span><br><span class=\"line\">            GetSecretValueResult getSnsResult = awsSecretsManager.getSecretValue(getSnsRequest);</span><br><span class=\"line\">            String snsString = getSnsResult.getSecretString();</span><br><span class=\"line\">            Config.IOT_SNS_NODE = new ObjectMapper().readTree(snsString);</span><br><span class=\"line\"> </span><br><span class=\"line\">            GetSecretValueRequest getCoreRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                    .withSecretId(Config.SECRET_IOT_CORE);</span><br><span class=\"line\">            GetSecretValueResult getCoreResult = awsSecretsManager.getSecretValue(getCoreRequest);</span><br><span class=\"line\">            String coreString = getCoreResult.getSecretString();</span><br><span class=\"line\">            Config.IOT_CORE_NODE = new ObjectMapper().readTree(coreString);</span><br><span class=\"line\"> </span><br><span class=\"line\">            GetSecretValueRequest getKWeatherRequest = new GetSecretValueRequest()</span><br><span class=\"line\">                    .withSecretId(Config.SECRET_IOT_KWEATHER);</span><br><span class=\"line\">            GetSecretValueResult getKWeatherResult = awsSecretsManager.getSecretValue(getKWeatherRequest);</span><br><span class=\"line\">            String kWeatherString = getKWeatherResult.getSecretString();</span><br><span class=\"line\">            Config.IOT_KWEATHER_NODE = new ObjectMapper().readTree(kWeatherString);</span><br><span class=\"line\"> </span><br><span class=\"line\">//            String username = eventNode.path(<span class=\"string\">\"username\"</span>).asText();</span><br><span class=\"line\">//            String password = eventNode.path(<span class=\"string\">\"password\"</span>).asText();</span><br><span class=\"line\">//            String engine = eventNode.path(<span class=\"string\">\"engine\"</span>).asText();</span><br><span class=\"line\">//            String host = eventNode.path(<span class=\"string\">\"host\"</span>).asText();</span><br><span class=\"line\">//            String port = eventNode.path(<span class=\"string\">\"port\"</span>).asText();</span><br><span class=\"line\">//            String dbname = eventNode.path(<span class=\"string\">\"dbname\"</span>).asText();</span><br><span class=\"line\">//            String dbInstanceIdentifier = eventNode.path(<span class=\"string\">\"dbInstanceIdentifier\"</span>).asText();</span><br><span class=\"line\">//            String name = eventNode.path(<span class=\"string\">\"name\"</span>).asText();</span><br><span class=\"line\"> </span><br><span class=\"line\">        &#125; catch (Exception ex)&#123;</span><br><span class=\"line\">            throw ex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">//        String secret = null, decodedBinarySecret;</span><br><span class=\"line\">//        GetSecretValueRequest getSecretValueRequest = new GetSecretValueRequest()</span><br><span class=\"line\">//                .withSecretId(Config.SECRET_IOT_CREDENTIALS);</span><br><span class=\"line\">//        GetSecretValueResult getSecretValueResult = null;</span><br><span class=\"line\">//</span><br><span class=\"line\">//        try &#123;</span><br><span class=\"line\">//            getSecretValueResult = awsSecretsManager.getSecretValue(getSecretValueRequest);</span><br><span class=\"line\">//        &#125; catch (DecryptionFailureException e) &#123;</span><br><span class=\"line\">//            // SecretsManager can not decrypt the protected secret text using the provided KMS key.</span><br><span class=\"line\">//            // Deal with the exception here, and/or rethrow at your discretion.</span><br><span class=\"line\">//            throw e;</span><br><span class=\"line\">//        &#125; catch (InternalServiceErrorException e) &#123;</span><br><span class=\"line\">//            // An error occurred on the server side.</span><br><span class=\"line\">//            // Deal with the exception here, and/or rethrow at your discretion.</span><br><span class=\"line\">//            throw e;</span><br><span class=\"line\">//        &#125; catch (InvalidParameterException e) &#123;</span><br><span class=\"line\">//            // You provided an invalid value <span class=\"keyword\">for</span> a parameter.</span><br><span class=\"line\">//            // Deal with the exception here, and/or rethrow at your discretion.</span><br><span class=\"line\">//            throw e;</span><br><span class=\"line\">//        &#125; catch (InvalidRequestException e) &#123;</span><br><span class=\"line\">//            // You provided a parameter value that is not valid <span class=\"keyword\">for</span> the current state of the resource.</span><br><span class=\"line\">//            // Deal with the exception here, and/or rethrow at your discretion.</span><br><span class=\"line\">//            throw e;</span><br><span class=\"line\">//        &#125; catch (ResourceNotFoundException e) &#123;</span><br><span class=\"line\">//            // We can not find the resource that you asked <span class=\"keyword\">for</span>.</span><br><span class=\"line\">//            // Deal with the exception here, and/or rethrow at your discretion.</span><br><span class=\"line\">//            throw e;</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//</span><br><span class=\"line\">//        // Decrypts secret using the associated KMS CMK.</span><br><span class=\"line\">//        // Depending on whether the secret is a string or binary, one of these fields will be populated.</span><br><span class=\"line\">//        <span class=\"keyword\">if</span> (getSecretValueResult.getSecretString() != null) &#123;</span><br><span class=\"line\">//            secret = getSecretValueResult.getSecretString();</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">//            decodedBinarySecret = new String(Base64.getDecoder().decode(getSecretValueResult.getSecretBinary()).array());</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        // Your code goes here.</span><br><span class=\"line\">//        try&#123;</span><br><span class=\"line\">//            JsonNode eventNode = new ObjectMapper().readTree(secret);</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        catch(Exception e)&#123;</span><br><span class=\"line\">//            System.out.println(e.getMessage());</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"3-결론\"><a href=\"#3-결론\" class=\"headerlink\" title=\"3) 결론\"></a>3) 결론</h3><ul>\n<li>조회쪽만 코딩하면 된다.</li>\n<li>고정적으로 변하지 않는 값을 저장해두고 쓰기 좋다.(소스를 건드릴 필요가 없으므로…)</li>\n<li>DB Instance를 설정해서 값을 불러오기 좋고, Rotation 기능을 활용하여 암호주기를 설정하고 자동으로 바꿔주기 좋다.</li>\n<li>별 거 아닌 내용이지만, 거의 대부분에서 쓰일정도로 쓰임새가 좋다.</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS ConsoleSecretsManager 설명이름에서 유추가 가능하지 않은가? 비밀스런 Key를 가지고 있는(관리하는) 서비스라고 보면 쉽다.사실 비밀까지는 아니지만 환경변수를 받아","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"secretsmanager","slug":"secretsmanager","count":2,"path":"api/tags/secretsmanager.json"},{"name":"Secret","slug":"Secret","count":2,"path":"api/tags/Secret.json"}]},{"title":"Cloudwatch","slug":"Cloudwatch","date":"2020-05-06T03:23:02.000Z","updated":"2020-05-11T01:11:50.837Z","comments":true,"pin":null,"path":"api/articles/Cloudwatch.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81136824-a1773800-8f97-11ea-92eb-48864ea3c85c.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"CloudWatch-설명\"><a href=\"#CloudWatch-설명\" class=\"headerlink\" title=\"CloudWatch 설명\"></a>CloudWatch 설명</h2><p>관련정보1 : <a href=\"https://aws.amazon.com/ko/blogs/korea/new-amazon-cloudwatch-logs-insights-fast-interactive-log-analytics/\" target=\"_blank\" rel=\"noopener\">AWS 한국블로그 CloudWatch Logs Insights – 빠른 대화형 로그 분석 기능 출시 (서울 리전 포함)</a><br>관련정보2 : <a href=\"http://labs.brandi.co.kr/2019/05/30/kwakjs.html\" target=\"_blank\" rel=\"noopener\">CloudWatch에 대하여 AWS 리소스를 효과적으로 모니터링하기</a>  / 브랜디 랩스(Brandi Labs) 곽정섭 과장<br>관련정보3 : <a href=\"https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/logs/AnalyzingLogData.html\" target=\"_blank\" rel=\"noopener\">CloudWatch Logs Insights로 로그 데이터 분석 (샘플많음)</a></p>\n<p>Cloudwatch는 통합 뷰를 확보하는데 필요한 데이터를 제공합니다. 뿐만 아니라 이벤트 및 리소스를 이용해 경보를 생성할 수도 있습니다.</p>\n<ol>\n<li>Events</li>\n<li>Logs</li>\n<li>Custom Metrics(맞춤형 지표) 생성하기</li>\n<li>Alarm 생성</li>\n<li>Dashboards<br>쉬어가기: Query 언어가 지원하는 여섯 가지 명령 유형</li>\n</ol>\n<h3 id=\"1-Events\"><a href=\"#1-Events\" class=\"headerlink\" title=\"1. Events\"></a>1. Events</h3><ul>\n<li>CloudWatch Events는 정기적인 일정에서 트리거(trigger)되는 규칙을 생성할 수 있습니다.</li>\n</ul>\n<h4 id=\"1-규칙-생성을-클릭합니다\"><a href=\"#1-규칙-생성을-클릭합니다\" class=\"headerlink\" title=\"1) 규칙 생성을 클릭합니다.\"></a>1) 규칙 생성을 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136824-a1773800-8f97-11ea-92eb-48864ea3c85c.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136824-a1773800-8f97-11ea-92eb-48864ea3c85c.png\" alt=\"cloudwatch_01\"></a></p>\n<h4 id=\"2-대상을-호출할-일정을-설정합니다\"><a href=\"#2-대상을-호출할-일정을-설정합니다\" class=\"headerlink\" title=\"2) 대상을 호출할 일정을 설정합니다.\"></a>2) 대상을 호출할 일정을 설정합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136819-9fad7480-8f97-11ea-82b4-cf0ae2055c46.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136819-9fad7480-8f97-11ea-82b4-cf0ae2055c46.png\" alt=\"cloudwatch_02\"></a></p>\n<ul>\n<li>호출 방식에는 이벤트 패턴과 일정 두 가지가 있습니다. 이벤트 패턴은 json 구조로 표현됩니다. AWS 서비스에서 발생하는 패턴과 일치하면 트리거가 동작합니다. 일정은 지정한 시간과 일치하면 트리거가 동작합니다.</li>\n<li>cron 또는 rate 표현식을 사용해 예약된 모든 이벤트는 UTC+09:00 시간대를 사용합니다. 최초 단위는 1분입니다.</li>\n<li>아래는 각각의 필드에 대한 일정 cron식 설명입니다.<br><a href=\"https://user-images.githubusercontent.com/62123161/81136870-ac31cd00-8f97-11ea-869f-34e38e5832dd.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136870-ac31cd00-8f97-11ea-869f-34e38e5832dd.png\" alt=\"cloudwatch_03\"></a></li>\n</ul>\n<p>이번 예제에서는 특정 시간에 트리거되는 일정으로 설정하겠습니다.</p>\n<pre><code>매일 4시에 동작하도록 설정\n19 + 9(UTC) - 24(하루) = 새벽 4시</code></pre><h4 id=\"3-대상-추가를-선택해-호출할-대상을-지정합니다\"><a href=\"#3-대상-추가를-선택해-호출할-대상을-지정합니다\" class=\"headerlink\" title=\"3) 대상 추가를 선택해 호출할 대상을 지정합니다.\"></a>3) 대상 추가를 선택해 호출할 대상을 지정합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136868-ab993680-8f97-11ea-86ca-acc176cea2ee.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136868-ab993680-8f97-11ea-86ca-acc176cea2ee.png\" alt=\"cloudwatch_04\"></a></p>\n<ul>\n<li>Lambda 함수 외에 여러 서비스를 선택할 수 있지만 이번 예제에서는 Lambda 함수를 지정하여 구성하겠습니다.</li>\n</ul>\n<h4 id=\"4-규칙의-이름과-설명을-등록하고-규칙-생성을-클릭합니다\"><a href=\"#4-규칙의-이름과-설명을-등록하고-규칙-생성을-클릭합니다\" class=\"headerlink\" title=\"4) 규칙의 이름과 설명을 등록하고 규칙 생성을 클릭합니다.\"></a>4) 규칙의 이름과 설명을 등록하고 규칙 생성을 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136867-ab993680-8f97-11ea-8521-791899fc62a1.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136867-ab993680-8f97-11ea-8521-791899fc62a1.png\" alt=\"cloudwatch_05\"></a></p>\n<h4 id=\"5-규칙이-생성된-것을-볼-수-있습니다\"><a href=\"#5-규칙이-생성된-것을-볼-수-있습니다\" class=\"headerlink\" title=\"5) 규칙이 생성된 것을 볼 수 있습니다.\"></a>5) 규칙이 생성된 것을 볼 수 있습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136866-ab00a000-8f97-11ea-85dd-bcc0d63b6a6b.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136866-ab00a000-8f97-11ea-85dd-bcc0d63b6a6b.png\" alt=\"cloudwatch_06\"></a></p>\n<h3 id=\"2-Logs\"><a href=\"#2-Logs\" class=\"headerlink\" title=\"2. Logs\"></a>2. Logs</h3><ul>\n<li>CloudWatch Logs는 운영 중인 애플리케이션 리소스를 기록하고 액세스할 수 있으며, 관련된 로그 데이터를 검색할 수도 있습니다.</li>\n</ul>\n<h4 id=\"1-생성된-규칙이-지정된-시간에-동작하면-CloudWatch-Logs에-로그-그룹이-생성된-걸-확인할-수-있습니다\"><a href=\"#1-생성된-규칙이-지정된-시간에-동작하면-CloudWatch-Logs에-로그-그룹이-생성된-걸-확인할-수-있습니다\" class=\"headerlink\" title=\"1) 생성된 규칙이 지정된 시간에 동작하면 CloudWatch Logs에 로그 그룹이 생성된 걸 확인할 수 있습니다.\"></a>1) 생성된 규칙이 지정된 시간에 동작하면 CloudWatch Logs에 로그 그룹이 생성된 걸 확인할 수 있습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136865-ab00a000-8f97-11ea-90ac-b424d7c50232.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136865-ab00a000-8f97-11ea-90ac-b424d7c50232.png\" alt=\"cloudwatch_07\"></a></p>\n<h4 id=\"2-Lambda-함수에서-실행된-로그-메시지를-확인할-수-있으며-필터링도-가능합니다\"><a href=\"#2-Lambda-함수에서-실행된-로그-메시지를-확인할-수-있으며-필터링도-가능합니다\" class=\"headerlink\" title=\"2) Lambda 함수에서 실행된 로그 메시지를 확인할 수 있으며 필터링도 가능합니다.\"></a>2) Lambda 함수에서 실행된 로그 메시지를 확인할 수 있으며 필터링도 가능합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136864-aa680980-8f97-11ea-8eef-41e82e9dc268.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136864-aa680980-8f97-11ea-8eef-41e82e9dc268.png\" alt=\"cloudwatch_08\"></a></p>\n<h4 id=\"3-로그-그룹에-이벤트-만료-시점을-설정해-오래된-데이터는-모두-자동으로-삭제되도록-설정할-수-있습니다\"><a href=\"#3-로그-그룹에-이벤트-만료-시점을-설정해-오래된-데이터는-모두-자동으로-삭제되도록-설정할-수-있습니다\" class=\"headerlink\" title=\"3) 로그 그룹에 이벤트 만료 시점을 설정해 오래된 데이터는 모두 자동으로 삭제되도록 설정할 수 있습니다.\"></a>3) 로그 그룹에 이벤트 만료 시점을 설정해 오래된 데이터는 모두 자동으로 삭제되도록 설정할 수 있습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136863-aa680980-8f97-11ea-8c89-481f9d2a5e96.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136863-aa680980-8f97-11ea-8c89-481f9d2a5e96.png\" alt=\"cloudwatch_09\"></a></p>\n<h3 id=\"3-Custom-Metrics-맞춤형-지표-생성하기\"><a href=\"#3-Custom-Metrics-맞춤형-지표-생성하기\" class=\"headerlink\" title=\"3. Custom Metrics(맞춤형 지표) 생성하기\"></a>3. Custom Metrics(맞춤형 지표) 생성하기</h3><ul>\n<li>모니터링하고자 하는 통계치를 직접 선정하고, CloudWatch로 보내 관리하는 지표를 생성해보겠습니다.</li>\n</ul>\n<h4 id=\"1-Log-Groups에-대한-지표를-생성하겠습니다-해당-Log-Groups에-‘Filters’를-클릭합니다\"><a href=\"#1-Log-Groups에-대한-지표를-생성하겠습니다-해당-Log-Groups에-‘Filters’를-클릭합니다\" class=\"headerlink\" title=\"1) Log Groups에 대한 지표를 생성하겠습니다. 해당 Log Groups에 ‘Filters’를 클릭합니다.\"></a>1) Log Groups에 대한 지표를 생성하겠습니다. 해당 Log Groups에 ‘Filters’를 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136861-a9cf7300-8f97-11ea-962b-2ae12f327932.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136861-a9cf7300-8f97-11ea-962b-2ae12f327932.png\" alt=\"cloudwatch_10\"></a></p>\n<h4 id=\"2-‘Add-Metric-Filter’를-클릭합니다\"><a href=\"#2-‘Add-Metric-Filter’를-클릭합니다\" class=\"headerlink\" title=\"2) ‘Add Metric Filter’를 클릭합니다.\"></a>2) ‘Add Metric Filter’를 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136860-a9cf7300-8f97-11ea-8fcb-f458d334ba84.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136860-a9cf7300-8f97-11ea-8fcb-f458d334ba84.png\" alt=\"cloudwatch_11\"></a></p>\n<h4 id=\"3-로그-지표에-대한-필터-패턴을-정의합니다\"><a href=\"#3-로그-지표에-대한-필터-패턴을-정의합니다\" class=\"headerlink\" title=\"3) 로그 지표에 대한 필터 패턴을 정의합니다.\"></a>3) 로그 지표에 대한 필터 패턴을 정의합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136859-a936dc80-8f97-11ea-98e9-17f750bde971.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136859-a936dc80-8f97-11ea-98e9-17f750bde971.png\" alt=\"cloudwatch_12\"></a></p>\n<p>[Filter Pattern]</p>\n<ul>\n<li>“INFO Success 200” → 세 단어를 모두 포함하는 로그 이벤트 메시지와 일치</li>\n<li>“INFO - Start - End” → ‘INFO’ 포함된 메시지 중에 ‘Start’, ‘End’ 제외된 필터 로그 이벤트 메시지와 일치</li>\n</ul>\n<h4 id=\"4-필터-및-지표-정보를-입력한-후-‘Create-Filter’를-클릭합니다\"><a href=\"#4-필터-및-지표-정보를-입력한-후-‘Create-Filter’를-클릭합니다\" class=\"headerlink\" title=\"4) 필터 및 지표 정보를 입력한 후 ‘Create Filter’를 클릭합니다.\"></a>4) 필터 및 지표 정보를 입력한 후 ‘Create Filter’를 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136858-a936dc80-8f97-11ea-882c-d3ccae0441c8.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136858-a936dc80-8f97-11ea-882c-d3ccae0441c8.png\" alt=\"cloudwatch_13\"></a></p>\n<p>[Metric Details]</p>\n<ul>\n<li>Metric Namespace → CloudWatch 지표에 대한 대상 네임 스페이스</li>\n<li>Metric Name → 모니터링된 로그 정보가 게시되는 CloudWatch 지표의 이름</li>\n<li>Metric Value → 일치하는 로그가 발견될 때마다 지표에 게시하는 숫자 값</li>\n<li>Default Value → 일치하는 로그가 발견되지 않은 기간 동안 지표 필터에 보고되는 값</li>\n</ul>\n<h4 id=\"5-두-가지-케이스의-필터를-생성했습니다\"><a href=\"#5-두-가지-케이스의-필터를-생성했습니다\" class=\"headerlink\" title=\"5) 두 가지 케이스의 필터를 생성했습니다.\"></a>5) 두 가지 케이스의 필터를 생성했습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136857-a89e4600-8f97-11ea-9084-35ce4d7b7fc8.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136857-a89e4600-8f97-11ea-9084-35ce4d7b7fc8.png\" alt=\"cloudwatch_14\"></a></p>\n<h3 id=\"4-Alarm-생성\"><a href=\"#4-Alarm-생성\" class=\"headerlink\" title=\"4. Alarm 생성\"></a>4. Alarm 생성</h3><ul>\n<li>단일 CloudWatch 지표를 감시하거나 CloudWatch 측정치를 기반으로 하는 수학 표현식의 결과를 감시하는 CloudWatch 경보를 생성할 수 있습니다. 지표가 지정된 임계값에 도달하면 자동으로 이메일을 보내는 Alarm을 만들어보겠습니다.</li>\n</ul>\n<h4 id=\"1-추가된-지표-필터에-‘Create-Alarm’-버튼을-클릭해-경보를-추가합니다\"><a href=\"#1-추가된-지표-필터에-‘Create-Alarm’-버튼을-클릭해-경보를-추가합니다\" class=\"headerlink\" title=\"1) 추가된 지표 필터에 ‘Create Alarm’ 버튼을 클릭해 경보를 추가합니다.\"></a>1) 추가된 지표 필터에 ‘Create Alarm’ 버튼을 클릭해 경보를 추가합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136856-a805af80-8f97-11ea-94ee-0f7a54314ac6.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136856-a805af80-8f97-11ea-94ee-0f7a54314ac6.png\" alt=\"cloudwatch_15\"></a></p>\n<h4 id=\"2-경보-세부-정보-및-수행할-작업을-정의합니다\"><a href=\"#2-경보-세부-정보-및-수행할-작업을-정의합니다\" class=\"headerlink\" title=\"2) 경보 세부 정보 및 수행할 작업을 정의합니다.\"></a>2) 경보 세부 정보 및 수행할 작업을 정의합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136853-a805af80-8f97-11ea-88ae-7f0f0004a3f9.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136853-a805af80-8f97-11ea-88ae-7f0f0004a3f9.png\" alt=\"cloudwatch_16\"></a></p>\n<p>[경보 평가]</p>\n<ul>\n<li>경보를 생성할 때, CloudWatch가 경보 상태를 변경하는 조건 세 가지에 대한 설정을 지정할 수 있습니다.</li>\n<li>기간은 경보에 대해 개별 데이터 포인트를 생성하기 위해 지표 또는 표현식을 평가하는 기간입니다. 초로 표시됩니다. 1분을 기간으로 선택하면 1분마다 하나의 데이터 포인트가 생성됩니다.</li>\n<li>Evaluation Period(평가 기간)는 경보 상태를 결정할 때 평가할 가장 최근의 기간 또는 데이터 포인트의 수입니다.</li>\n<li>Datapoints to Alarm(경보에 대한 데이터포인트)는 평가 기간에 경보가 ALARM상태에 도달하게 만드는 위반 데이터 포인트의 수입니다. 위반 데이터 포인트가 연속적일 필요는 없습니다. Evaluation Period(평가 기간)와 동일한 마지막 데이터 포인트의 수 이내면 됩니다.</li>\n</ul>\n<h4 id=\"3-경보가-발생할-Alarm-상태와-알림-받을-이메일을-등록합니다\"><a href=\"#3-경보가-발생할-Alarm-상태와-알림-받을-이메일을-등록합니다\" class=\"headerlink\" title=\"3) 경보가 발생할 Alarm 상태와 알림 받을 이메일을 등록합니다.\"></a>3) 경보가 발생할 Alarm 상태와 알림 받을 이메일을 등록합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136851-a76d1900-8f97-11ea-935c-e3f135265dad.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136851-a76d1900-8f97-11ea-935c-e3f135265dad.png\" alt=\"cloudwatch_17\"></a></p>\n<p>[경보 상태]</p>\n<ul>\n<li>/OK/ 지표 또는 표현식이 정의된 임계값 내에 있습니다.</li>\n<li>/ALARM/ 지표 또는 표현식이 정의된 임계값을 벗어났습니다.</li>\n<li>/INSUFFICIENT_DATA/ 경보가 방금 시작되었거나, 측정치를 사용할 수 없거나, 또는 측정치를 통해 경보 상태를 결정하는데 사용할 충분한 데이터가 없습니다.</li>\n</ul>\n<h4 id=\"4-이메일-수신함에서-‘AWS-알림-구독-확인’이라는-제목의-메일을-클릭합니다-내용에-포함된-링크를-클릭해-알림을-수신할-것을-확인합니다-AWS는-확인된-주소로만-알림을-전송할-수-있습니다\"><a href=\"#4-이메일-수신함에서-‘AWS-알림-구독-확인’이라는-제목의-메일을-클릭합니다-내용에-포함된-링크를-클릭해-알림을-수신할-것을-확인합니다-AWS는-확인된-주소로만-알림을-전송할-수-있습니다\" class=\"headerlink\" title=\"4) 이메일 수신함에서 ‘AWS 알림 - 구독 확인’이라는 제목의 메일을 클릭합니다. 내용에 포함된 링크를 클릭해 알림을 수신할 것을 확인합니다. (AWS는 확인된 주소로만 알림을 전송할 수 있습니다.)\"></a>4) 이메일 수신함에서 ‘AWS 알림 - 구독 확인’이라는 제목의 메일을 클릭합니다. 내용에 포함된 링크를 클릭해 알림을 수신할 것을 확인합니다. (AWS는 확인된 주소로만 알림을 전송할 수 있습니다.)</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136849-a76d1900-8f97-11ea-82db-d3e87858e425.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136849-a76d1900-8f97-11ea-82db-d3e87858e425.png\" alt=\"cloudwatch_18\"></a></p>\n<h4 id=\"5-이메일-수신함을-확인해-‘Confirm-subscription’을-클릭합니다\"><a href=\"#5-이메일-수신함을-확인해-‘Confirm-subscription’을-클릭합니다\" class=\"headerlink\" title=\"5) 이메일 수신함을 확인해 ‘Confirm subscription’을 클릭합니다.\"></a>5) 이메일 수신함을 확인해 ‘Confirm subscription’을 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136848-a6d48280-8f97-11ea-8f5d-8002c1d79f6e.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136848-a6d48280-8f97-11ea-8f5d-8002c1d79f6e.png\" alt=\"cloudwatch_19\"></a></p>\n<h4 id=\"6-등록한-이메일이-확인되었습니다\"><a href=\"#6-등록한-이메일이-확인되었습니다\" class=\"headerlink\" title=\"6) 등록한 이메일이 확인되었습니다.\"></a>6) 등록한 이메일이 확인되었습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136846-a6d48280-8f97-11ea-9330-9c8e104c4c71.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136846-a6d48280-8f97-11ea-9330-9c8e104c4c71.png\" alt=\"cloudwatch_20\"></a></p>\n<h4 id=\"7-AWS에-이메일이-정상적으로-등록되었는지-SNS-Subscriptions-메뉴에서-확인합니다\"><a href=\"#7-AWS에-이메일이-정상적으로-등록되었는지-SNS-Subscriptions-메뉴에서-확인합니다\" class=\"headerlink\" title=\"7) AWS에 이메일이 정상적으로 등록되었는지 SNS Subscriptions 메뉴에서 확인합니다.\"></a>7) AWS에 이메일이 정상적으로 등록되었는지 SNS Subscriptions 메뉴에서 확인합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136843-a63bec00-8f97-11ea-8d8c-62337063d511.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136843-a63bec00-8f97-11ea-8d8c-62337063d511.png\" alt=\"cloudwatch_21\"></a></p>\n<h4 id=\"8-Lambda를-실행해-Alarm-상태를-변경해보겠습니다\"><a href=\"#8-Lambda를-실행해-Alarm-상태를-변경해보겠습니다\" class=\"headerlink\" title=\"8) Lambda를 실행해 Alarm 상태를 변경해보겠습니다.\"></a>8) Lambda를 실행해 Alarm 상태를 변경해보겠습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136842-a5a35580-8f97-11ea-855d-fd985915dced.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136842-a5a35580-8f97-11ea-855d-fd985915dced.png\" alt=\"cloudwatch_22\"></a></p>\n<h4 id=\"9-등록한-이메일-주소로-Alarm-메일이-도착했습니다\"><a href=\"#9-등록한-이메일-주소로-Alarm-메일이-도착했습니다\" class=\"headerlink\" title=\"9) 등록한 이메일 주소로 Alarm 메일이 도착했습니다.\"></a>9) 등록한 이메일 주소로 Alarm 메일이 도착했습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136841-a5a35580-8f97-11ea-959b-6309f5e07572.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136841-a5a35580-8f97-11ea-959b-6309f5e07572.png\" alt=\"cloudwatch_23\"></a></p>\n<h3 id=\"5-Dashboards\"><a href=\"#5-Dashboards\" class=\"headerlink\" title=\"5. Dashboards\"></a>5. Dashboards</h3><ul>\n<li>CloudWatch를 통해 리소스를 손쉽게 모니터링할 수 있는 맞춤형 통계 기능입니다.</li>\n</ul>\n<h4 id=\"1-Metric-Filter에서-추가된-Custom-Namespaces를-클릭합니다\"><a href=\"#1-Metric-Filter에서-추가된-Custom-Namespaces를-클릭합니다\" class=\"headerlink\" title=\"1) Metric Filter에서 추가된 Custom Namespaces를 클릭합니다.\"></a>1) Metric Filter에서 추가된 Custom Namespaces를 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136840-a50abf00-8f97-11ea-8cbe-0e2430cf7490.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136840-a50abf00-8f97-11ea-8cbe-0e2430cf7490.png\" alt=\"cloudwatch_24\"></a></p>\n<h4 id=\"2-생성된-Metrics를-선택한-후-Graphed-metrics-Tab을-클릭합니다\"><a href=\"#2-생성된-Metrics를-선택한-후-Graphed-metrics-Tab을-클릭합니다\" class=\"headerlink\" title=\"2) 생성된 Metrics를 선택한 후, Graphed metrics Tab을 클릭합니다.\"></a>2) 생성된 Metrics를 선택한 후, Graphed metrics Tab을 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136839-a50abf00-8f97-11ea-8ee6-8cb8911478b0.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136839-a50abf00-8f97-11ea-8ee6-8cb8911478b0.png\" alt=\"cloudwatch_25\"></a></p>\n<h4 id=\"3-Metrics에-표시될-그래프를-설정합니다\"><a href=\"#3-Metrics에-표시될-그래프를-설정합니다\" class=\"headerlink\" title=\"3) Metrics에 표시될 그래프를 설정합니다.\"></a>3) Metrics에 표시될 그래프를 설정합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136838-a4722880-8f97-11ea-97c4-43f2206da42b.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136838-a4722880-8f97-11ea-97c4-43f2206da42b.png\" alt=\"cloudwatch_26\"></a><br>1)그래프 제목 : testLambda1<br>2)그래프 표시 : 숫자<br>3)그래프 라벨 : testMetrics-400, testMetrics-200<br>4)통계 : 합계<br>5)기간 : 1 Day</p>\n<h4 id=\"4-수식을-응용하여-여러-형식의-Metrics-표현식을-추가하겠습니다\"><a href=\"#4-수식을-응용하여-여러-형식의-Metrics-표현식을-추가하겠습니다\" class=\"headerlink\" title=\"4) 수식을 응용하여 여러 형식의 Metrics 표현식을 추가하겠습니다.\"></a>4) 수식을 응용하여 여러 형식의 Metrics 표현식을 추가하겠습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136836-a4722880-8f97-11ea-907d-beb1c41de5d7.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136836-a4722880-8f97-11ea-907d-beb1c41de5d7.png\" alt=\"cloudwatch_27\"></a><br>지표 수식 함수</p>\n<ul>\n<li>METRICS() : 요청에 모든 지표를 반환</li>\n<li>SUM(METRICS()) : 모든 지표의 합계</li>\n<li>AVG(METRICS()) : 모든 지표의 평균</li>\n<li>MIN(METRICS()) : 모든 지표의 최소값</li>\n<li>MAX(METRICS()) : 모든 지표의 최대값</li>\n<li>ABS(METRICS()) : 각 요소의 절대값</li>\n<li>RATE(METRICS()) : 각 요소의 초당 변경 비율</li>\n</ul>\n<h4 id=\"5-완성된-지표-Source를-복사합니다\"><a href=\"#5-완성된-지표-Source를-복사합니다\" class=\"headerlink\" title=\"5) 완성된 지표 Source를 복사합니다.\"></a>5) 완성된 지표 Source를 복사합니다.</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"string\">\"metrics\"</span>: [</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"SUM(METRICS())\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"합계\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e1\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"AVG(METRICS())\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"평균\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e2\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"MIN(METRICS())\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"최소값\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e3\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"MAX(METRICS())\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"최대값\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e4\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"SUM(METRICS())/SUM(m1)\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"SUM(METRICS())/SUM(m1)\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e5\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ &#123; <span class=\"string\">\"expression\"</span>: <span class=\"string\">\"SUM(100/[m1, m2])\"</span>, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"SUM(100/[m1, m2])\"</span>, <span class=\"string\">\"id\"</span>: <span class=\"string\">\"e6\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400 &#125; ],</span><br><span class=\"line\">            [ <span class=\"string\">\"testMetrics\"</span>, <span class=\"string\">\"testMetrics1\"</span>, &#123; <span class=\"string\">\"id\"</span>: <span class=\"string\">\"m1\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"testMetrics-400\"</span> &#125; ],</span><br><span class=\"line\">            [ <span class=\"string\">\".\"</span>, <span class=\"string\">\"testMetrics2\"</span>, &#123; <span class=\"string\">\"id\"</span>: <span class=\"string\">\"m2\"</span>, <span class=\"string\">\"stat\"</span>: <span class=\"string\">\"Sum\"</span>, <span class=\"string\">\"period\"</span>: 86400, <span class=\"string\">\"label\"</span>: <span class=\"string\">\"testMetrics-200\"</span> &#125; ]</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">\"view\"</span>: <span class=\"string\">\"singleValue\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"stacked\"</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">\"region\"</span>: <span class=\"string\">\"ap-northeast-1\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"title\"</span>: <span class=\"string\">\"testLambda1\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"period\"</span>: 300</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"6-Dashboard-name을-입력한-후-‘Create-dashboard’를-클릭합니다\"><a href=\"#6-Dashboard-name을-입력한-후-‘Create-dashboard’를-클릭합니다\" class=\"headerlink\" title=\"6) Dashboard name을 입력한 후 ‘Create dashboard’를 클릭합니다.\"></a>6) Dashboard name을 입력한 후 ‘Create dashboard’를 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136835-a3d99200-8f97-11ea-8191-b4e2c9f02c03.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136835-a3d99200-8f97-11ea-8191-b4e2c9f02c03.png\" alt=\"cloudwatch_28\"></a></p>\n<h4 id=\"7-‘Add-widget’을-클릭해-Number-유형을-선택합니다\"><a href=\"#7-‘Add-widget’을-클릭해-Number-유형을-선택합니다\" class=\"headerlink\" title=\"7) ‘Add widget’을 클릭해 Number 유형을 선택합니다.\"></a>7) ‘Add widget’을 클릭해 Number 유형을 선택합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136834-a3d99200-8f97-11ea-8da8-927ad96585d7.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136834-a3d99200-8f97-11ea-8da8-927ad96585d7.png\" alt=\"cloudwatch_29\"></a></p>\n<h4 id=\"8-Source-Tab에서-복사해-둔-지표-Source를-붙여-넣고-‘Create-widget’을-클릭합니다\"><a href=\"#8-Source-Tab에서-복사해-둔-지표-Source를-붙여-넣고-‘Create-widget’을-클릭합니다\" class=\"headerlink\" title=\"8) Source Tab에서 복사해 둔 지표 Source를 붙여 넣고, ‘Create widget’을 클릭합니다.\"></a>8) Source Tab에서 복사해 둔 지표 Source를 붙여 넣고, ‘Create widget’을 클릭합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136832-a340fb80-8f97-11ea-8f4d-77fe2cfd7a4c.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136832-a340fb80-8f97-11ea-8f4d-77fe2cfd7a4c.png\" alt=\"cloudwatch_30\"></a></p>\n<h4 id=\"9-위젯이-추가되었습니다-추가된-위젯은-‘Save-dashboard’-버튼을-클릭해야-최종-저장됩니다\"><a href=\"#9-위젯이-추가되었습니다-추가된-위젯은-‘Save-dashboard’-버튼을-클릭해야-최종-저장됩니다\" class=\"headerlink\" title=\"9) 위젯이 추가되었습니다. 추가된 위젯은 ‘Save dashboard’ 버튼을 클릭해야 최종 저장됩니다.\"></a>9) 위젯이 추가되었습니다. 추가된 위젯은 ‘Save dashboard’ 버튼을 클릭해야 최종 저장됩니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136831-a340fb80-8f97-11ea-9b4f-5ab95ce56018.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136831-a340fb80-8f97-11ea-9b4f-5ab95ce56018.png\" alt=\"cloudwatch_31\"></a></p>\n<h4 id=\"10-이번에는-로그-메시지-결과를-확인할-수-있는-Query-result-유형을-추가해보겠습니다-먼저-Query-result-유형을-선택합니다\"><a href=\"#10-이번에는-로그-메시지-결과를-확인할-수-있는-Query-result-유형을-추가해보겠습니다-먼저-Query-result-유형을-선택합니다\" class=\"headerlink\" title=\"10) 이번에는 로그 메시지 결과를 확인할 수 있는 Query result 유형을 추가해보겠습니다. 먼저 Query result 유형을 선택합니다.\"></a>10) 이번에는 로그 메시지 결과를 확인할 수 있는 Query result 유형을 추가해보겠습니다. 먼저 Query result 유형을 선택합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136829-a2a86500-8f97-11ea-91d0-d110cf5c29f5.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136829-a2a86500-8f97-11ea-91d0-d110cf5c29f5.png\" alt=\"cloudwatch_32\"></a></p>\n<h4 id=\"11-로그-메시지에-조건을-추가해-필터링합니다\"><a href=\"#11-로그-메시지에-조건을-추가해-필터링합니다\" class=\"headerlink\" title=\"11) 로그 메시지에 조건을 추가해 필터링합니다.\"></a>11) 로그 메시지에 조건을 추가해 필터링합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136827-a20fce80-8f97-11ea-9f19-6cfd6beb18eb.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136827-a20fce80-8f97-11ea-9f19-6cfd6beb18eb.png\" alt=\"cloudwatch_33\"></a></p>\n<h3 id=\"잠시-쉬어가기-Query-언어가-지원하는-여섯-가지-명령-유형\"><a href=\"#잠시-쉬어가기-Query-언어가-지원하는-여섯-가지-명령-유형\" class=\"headerlink\" title=\"잠시 쉬어가기!: Query 언어가 지원하는 여섯 가지 명령 유형\"></a>잠시 쉬어가기!: Query 언어가 지원하는 여섯 가지 명령 유형</h3><ul>\n<li>fields : 지정한 필드를 검색합니다. 필드 명령 내에서 함수 및 연산을 사용할 수 있습니다. 만약 @ 기호, 마침표(.) 및 영숫자 문자 이외의 문자가 포함된 로그 필드가 쿼리에 명명되어 있으면 해당 필드 이름은 억음 기호로 둘러싸야 합니다.</li>\n<li>filter : 하나 이상의 조건으로 필터링합니다. filter statusCode like /2\\d\\d/ → 필드 statusCode의 값이 200~299인 로그 이벤트를 반환합니다.</li>\n<li>stats : 로그 필드에 대한 지정된 시간 간격의 집계 통계를 계산합니다.</li>\n<li>sort : 검색된 로그 이벤트를 정렬합니다.</li>\n<li>limit : 쿼리에서 반환되는 로그 이벤트 수를 제한합니다.</li>\n<li>parse : 로그 필드에서 데이터를 추출하고 쿼리로 추가 처리할 수 있는 임시 필드가 하나 이상 생성됩니다.</li>\n</ul>\n<h4 id=\"12-추가된-위젯은-이름과-사이즈를-조절한-후-‘Save-dashboard’-버튼을-클릭해-최종-저장합니다\"><a href=\"#12-추가된-위젯은-이름과-사이즈를-조절한-후-‘Save-dashboard’-버튼을-클릭해-최종-저장합니다\" class=\"headerlink\" title=\"12) 추가된 위젯은 이름과 사이즈를 조절한 후, ‘Save dashboard’ 버튼을 클릭해 최종 저장합니다.\"></a>12) 추가된 위젯은 이름과 사이즈를 조절한 후, ‘Save dashboard’ 버튼을 클릭해 최종 저장합니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136826-a20fce80-8f97-11ea-9d48-15aaf95ed8f1.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136826-a20fce80-8f97-11ea-9d48-15aaf95ed8f1.png\" alt=\"cloudwatch_34\"></a></p>\n<h4 id=\"13-생성한-Alarm을-Dashboard에-추가하겠습니다\"><a href=\"#13-생성한-Alarm을-Dashboard에-추가하겠습니다\" class=\"headerlink\" title=\"13) 생성한 Alarm을 Dashboard에 추가하겠습니다.\"></a>13) 생성한 Alarm을 Dashboard에 추가하겠습니다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81136825-a1773800-8f97-11ea-8fdd-f1feabed06f6.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81136825-a1773800-8f97-11ea-8fdd-f1feabed06f6.png\" alt=\"cloudwatch_35\"></a></p>\n<h4 id=\"14-Dashboard가-완성되었습니다\"><a href=\"#14-Dashboard가-완성되었습니다\" class=\"headerlink\" title=\"14) Dashboard가 완성되었습니다!\"></a>14) Dashboard가 완성되었습니다!</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81138255-6b888280-8f9c-11ea-9951-642b9679774b.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81138255-6b888280-8f9c-11ea-9951-642b9679774b.png\" alt=\"cloudwatch_36\"></a></p>\n<h2 id=\"결론\"><a href=\"#결론\" class=\"headerlink\" title=\"결론\"></a>결론</h2><p>지금까지 CloudWatch 서비스를 소개했습니다. 이 서비스를 이용하면 로그와 지표를 쉽게 시각화할 수 있고, 작업을 자동화할 수도 있는 것을 확인했습니다. CloudWatch를 이용해 애플리케이션을 최적화하고, 원활하게 실행해보는 건 어떨까요. 분명 리소스를 효과적으로 다룰 수 있을 겁니다.</p>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS ConsoleCloudWatch 설명관련정보1 : AWS 한국블로그 CloudWatch Logs Insights – 빠른 대화형 로그 분석 기능 출시 (서울 리전 포함)<br>관련","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"cloudwatch","slug":"cloudwatch","count":1,"path":"api/tags/cloudwatch.json"},{"name":"event","slug":"event","count":1,"path":"api/tags/event.json"}]},{"title":"DynamoDB","slug":"DynamoDB","date":"2020-05-06T02:26:44.000Z","updated":"2020-05-11T01:12:35.496Z","comments":true,"pin":null,"path":"api/articles/DynamoDB.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81145311-fd01ef80-8fb0-11ea-9fe7-e2455a219030.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"DynamoDB-설명\"><a href=\"#DynamoDB-설명\" class=\"headerlink\" title=\"DynamoDB 설명\"></a>DynamoDB 설명</h2><ol>\n<li>다 필요없다. 서버쪽 공부한 사람이라면 No SQL이라는 단어 하나만으로도 설명이 된다.</li>\n<li>RDB보다 아주 상당히 비싸다. 요금 기준이 읽기, 쓰기니까 그냥 한번 Access에도 요금이 발생한다.</li>\n<li>현재는 DynamoDB를 사용하기보다는 RDB를 사용하거나 Kinesis, SQS등 대체자원들을 검토중이다.</li>\n<li>솔직히 NoSQL의 특징을 여기에 쓰기에는 구글에 너무 많고 좋은 내용이 많으니 검색해보기 바란다.(검색의 생활화)</li>\n</ol>\n<h3 id=\"1-테이블-만들기\"><a href=\"#1-테이블-만들기\" class=\"headerlink\" title=\"1) 테이블 만들기\"></a>1) 테이블 만들기</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81145311-fd01ef80-8fb0-11ea-9fe7-e2455a219030.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81145311-fd01ef80-8fb0-11ea-9fe7-e2455a219030.png\" alt=\"dynamodb_01\"></a></p>\n<ul>\n<li>별내용 없다. Table Name과 PK(PrimaryKey), SK(SortKey)를 지정해주면 된다.</li>\n<li>주의할 점은, Sort키를 잘 지정해야 한다는 것이다. 테이블이 로그성 테이블이 될지, 최신정보를 가질지 여부는 SK에 달려있으며, 조회에도 사용이 된다.(조회를 원활하게 하기 위해서는 SortKey를 지정 안해도된다.)</li>\n</ul>\n<h3 id=\"2-테이블-리스트-화면\"><a href=\"#2-테이블-리스트-화면\" class=\"headerlink\" title=\"2. 테이블 리스트 화면\"></a>2. 테이블 리스트 화면</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/81145375-1f940880-8fb1-11ea-927c-1181dffbf9a1.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81145375-1f940880-8fb1-11ea-927c-1181dffbf9a1.png\" alt=\"dynamodb_02\"></a></p>\n<ul>\n<li>테이블 생성은 완료되었으며, 기본 설정 외에 Ondemand 설정, 백업설정, 글로벌테이블, 인덱싱 등 자질구레한 설정들이 있다.</li>\n<li>테이블 성격에 맞게 해당 기능을 설정하면 되고, 기본적으로 Matrix는 제공을 해주니 CloudWatch정도만 추가설정 해주면 Table에 문제가 생겼을 경우 알람을 받을 수 있다.</li>\n</ul>\n<h3 id=\"2-소스\"><a href=\"#2-소스\" class=\"headerlink\" title=\"2) 소스\"></a>2) 소스</h3><h4 id=\"Gradle\"><a href=\"#Gradle\" class=\"headerlink\" title=\"Gradle\"></a>Gradle</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Dependency</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    implementation <span class=\"string\">'com.amazonaws:aws-lambda-java-core:1.2.0'</span></span><br><span class=\"line\">    implementation <span class=\"string\">'com.amazonaws:aws-lambda-java-events:2.2.6'</span></span><br><span class=\"line\">    compile group: <span class=\"string\">'com.amazonaws'</span>, name: <span class=\"string\">'aws-java-sdk-dynamodb'</span>, version: <span class=\"string\">'1.11.584'</span></span><br><span class=\"line\">    compile group: <span class=\"string\">'org.projectlombok'</span>, name: <span class=\"string\">'lombok'</span>, version: <span class=\"string\">'1.16.20'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Define\"><a href=\"#Define\" class=\"headerlink\" title=\"Define\"></a>Define</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>기본 Static 설정(사실 Static으로 두지 않아도 된다... 그냥 난 편의상..)</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static AmazonDynamoDB client = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.US_EAST_1).build();</span><br><span class=\"line\">static DynamoDB dynamoDB = new DynamoDB(client);</span><br><span class=\"line\"> </span><br><span class=\"line\">static String tableName = <span class=\"string\">\"(TABLENAME)\"</span>;</span><br><span class=\"line\">static Map&lt;String, String&gt; mapAttribute = new HashMap&lt;String, String&gt;();</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"GET-Table-Information\"><a href=\"#GET-Table-Information\" class=\"headerlink\" title=\"GET Table Information\"></a>GET Table Information</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Table 정보 획득</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AmazonDynamoDB client = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.US_EAST_1).build();</span><br><span class=\"line\">DescribeTableRequest request = new DescribeTableRequest().withTableName(tableName);</span><br><span class=\"line\">DescribeTableResult response = client.describeTable(request);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">for</span>(int i= 0; i&lt; response.getTable().getAttributeDefinitions().size();i++)&#123;</span><br><span class=\"line\">    mapAttribute.put(response.getTable().getAttributeDefinitions().get(i).getAttributeName(), response.getTable().getAttributeDefinitions().get(i).getAttributeType());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Items-Insert\"><a href=\"#Items-Insert\" class=\"headerlink\" title=\"Items Insert\"></a>Items Insert</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Insert [Table] into (KEY) VALUES (VALUE)</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    private static String createItems(DynamoDB dynamoDB, String tableName, String primaryKey, String primaryValue, String rangeKey, String rangeValue, String createKeyValue) &#123;</span><br><span class=\"line\">        Table table = dynamoDB.getTable(tableName);</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            String[] createArr;</span><br><span class=\"line\">            UpdateItemOutcome outcome=null;</span><br><span class=\"line\">            createArr = createKeyValue.split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">            Map&lt;String, AttributeValue&gt; values = new HashMap&lt;String, AttributeValue&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"keyword\">if</span>((createArr.length &amp; 1) == 0) &#123;</span><br><span class=\"line\">                //Even(정상)</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(int i=0; i&lt;createArr.length;i++)&#123;</span><br><span class=\"line\">                    values.put(createArr[i], new AttributeValue().withS(createArr[i+1]));</span><br><span class=\"line\"> </span><br><span class=\"line\">                    i++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                values.put(primaryKey,new AttributeValue().withN(primaryValue));</span><br><span class=\"line\">                values.put(rangeKey, new AttributeValue().withS(rangeValue));</span><br><span class=\"line\"> </span><br><span class=\"line\">                PutItemResult result = client.putItem(new PutItemRequest(tableName, values));</span><br><span class=\"line\">                String str = result.getSdkResponseMetadata().toString();</span><br><span class=\"line\">//                Item item = new Item()</span><br><span class=\"line\">//                        .withPrimaryKey(primaryKey, primaryValue)</span><br><span class=\"line\">//                        .withString(rangeKey, rangeValue);</span><br><span class=\"line\">//</span><br><span class=\"line\">//                table.putItem(item);</span><br><span class=\"line\">                // Confirm</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"Displaying updated item...\"</span>);</span><br><span class=\"line\">                System.out.println(str);</span><br><span class=\"line\">                <span class=\"built_in\">return</span> str;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                //Odd(비정상)</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"UpdateArr Odd...\"</span>);</span><br><span class=\"line\">                <span class=\"built_in\">return</span> <span class=\"string\">\"UpdateArr Odd...\"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">\"Cannot create items.\"</span>);</span><br><span class=\"line\">            System.err.println(e.getMessage());</span><br><span class=\"line\">            <span class=\"built_in\">return</span> e.getMessage();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Items-Update\"><a href=\"#Items-Update\" class=\"headerlink\" title=\"Items Update\"></a>Items Update</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>UPDATE [TABLE] SET (KEY_VALUE)</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//업데이트</span><br><span class=\"line\">private static String updateItem(DynamoDB dynamoDB, String tableName, String primaryKey, String primaryValue, String rangeKey, String rangeValue, String updateKeyValue) &#123;</span><br><span class=\"line\">    Table table = dynamoDB.getTable(tableName);</span><br><span class=\"line\"> </span><br><span class=\"line\">    long time3 = (new Date()).getTime();</span><br><span class=\"line\">    Date date3 = new Date();</span><br><span class=\"line\">    date3.setTime(time3);</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        //2개 이상 업데이트를 진행할 때</span><br><span class=\"line\">        UpdateItemSpec updateItemSpec = new UpdateItemSpec()</span><br><span class=\"line\">                .withPrimaryKey(primaryKey, Integer.parseInt(primaryValue), rangeKey, rangeValue)</span><br><span class=\"line\">                .withReturnValues(ReturnValue.ALL_NEW);</span><br><span class=\"line\">        //split</span><br><span class=\"line\">        String[] updateArr;</span><br><span class=\"line\">        UpdateItemOutcome outcome=null;</span><br><span class=\"line\">        updateArr = updateKeyValue.split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">        HashMap&lt;String, String&gt; nameMap = new HashMap&lt;String, String&gt;();</span><br><span class=\"line\">        HashMap&lt;String, Object&gt; valueMap = new HashMap&lt;String, Object&gt;();</span><br><span class=\"line\">        String expressionMessage = <span class=\"string\">\"set \"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((updateArr.length &amp; 1) == 0) &#123;</span><br><span class=\"line\">            //Even(정상)</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(int i=0; i&lt;updateArr.length;i++)&#123;</span><br><span class=\"line\">                nameMap.put(<span class=\"string\">\"#\"</span>+updateArr[i], updateArr[i]);</span><br><span class=\"line\">                valueMap.put(<span class=\"string\">\":val\"</span>+updateArr[i],updateArr[i+1]);</span><br><span class=\"line\"> </span><br><span class=\"line\">                expressionMessage += <span class=\"string\">\"#\"</span>+updateArr[i] + <span class=\"string\">\"=\"</span>+<span class=\"string\">\":val\"</span>+updateArr[i];</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(i/2&lt;updateArr.length/2 -1)&#123;</span><br><span class=\"line\">                    expressionMessage += <span class=\"string\">\" , \"</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            updateItemSpec.withUpdateExpression(expressionMessage)</span><br><span class=\"line\">                        .withNameMap(nameMap)</span><br><span class=\"line\">                        .withValueMap(valueMap);</span><br><span class=\"line\"> </span><br><span class=\"line\">            outcome =  table.updateItem(updateItemSpec);</span><br><span class=\"line\">            // Confirm</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Displaying updated item...\"</span>);</span><br><span class=\"line\">            System.out.println(outcome.getItem().toJSONPretty());</span><br><span class=\"line\">            <span class=\"built_in\">return</span> outcome.getItem().toJSONPretty();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            //Odd(비정상)</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"UpdateArr Odd...\"</span>);</span><br><span class=\"line\">            <span class=\"built_in\">return</span> <span class=\"string\">\"UpdateArr Odd...\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; catch (Exception e) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">\"Cannot add an attribute in \"</span> + tableName);</span><br><span class=\"line\">        System.err.println(e.getMessage());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> e.getMessage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Items-Select-WHERE\"><a href=\"#Items-Select-WHERE\" class=\"headerlink\" title=\"Items Select(WHERE)\"></a>Items Select(WHERE)</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>SELECT * FROM [TABLE] WHERE <String></span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Select(조건)</span><br><span class=\"line\">private static String selectWhereItem(DynamoDB dynamoDB, String tableName, String primaryKey, String primaryValue, String rangeKey, String rangeValue, String <span class=\"built_in\">where</span>) &#123;</span><br><span class=\"line\">    Table table = dynamoDB.getTable(tableName);</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        Item item = table.getItem(primaryKey,Integer.parseInt(primaryValue),rangeKey,rangeValue,<span class=\"built_in\">where</span>,null);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Displaying retrieved items...\"</span>);</span><br><span class=\"line\">        System.out.println(item.toJSONPretty());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> item.toString();</span><br><span class=\"line\">    &#125; catch (Exception e) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">\"Cannot retrieve items.\"</span>);</span><br><span class=\"line\">        System.err.println(e.getMessage());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> e.getMessage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Items-Select\"><a href=\"#Items-Select\" class=\"headerlink\" title=\"Items Select\"></a>Items Select</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>SELECT * FROM [TABLE] </span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Select(전체)</span><br><span class=\"line\">private static String selectItem(DynamoDB dynamoDB, String tableName, String primaryKey, String primaryValue, String rangeKey, String rangeValue) &#123;</span><br><span class=\"line\">    Table table = dynamoDB.getTable(tableName);</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        Item item = table.getItem(primaryKey,Integer.parseInt(primaryValue),rangeKey,rangeValue);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Displaying retrieved items...\"</span>);</span><br><span class=\"line\">        System.out.println(item.toJSONPretty());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> item.toString();</span><br><span class=\"line\">    &#125; catch (Exception e) &#123;</span><br><span class=\"line\">        System.err.println(<span class=\"string\">\"Cannot retrieve items.\"</span>);</span><br><span class=\"line\">        System.err.println(e.getMessage());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> e.getMessage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Items-Delete-당연히-조건-전체삭제는-테이블-Drop-Create-하는게-훨씬낫다\"><a href=\"#Items-Delete-당연히-조건-전체삭제는-테이블-Drop-Create-하는게-훨씬낫다\" class=\"headerlink\" title=\"Items Delete(당연히 조건- 전체삭제는 테이블 Drop/Create 하는게 훨씬낫다)\"></a>Items Delete(당연히 조건- 전체삭제는 테이블 Drop/Create 하는게 훨씬낫다)</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>DELETE FROM [TABLE] WHERE <String></span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//삭제</span><br><span class=\"line\">    public static String deleteItem(DynamoDB dynamoDB, String tableName, String primaryKey, String primaryValue, String rangeKey, String rangeValue) &#123;</span><br><span class=\"line\">        Table table = dynamoDB.getTable(tableName);</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            DeleteItemSpec deleteItemSpec = new DeleteItemSpec()</span><br><span class=\"line\">                    .withPrimaryKey(primaryKey, Integer.parseInt(primaryValue), rangeKey, rangeValue)</span><br><span class=\"line\">//                    .withConditionExpression(<span class=\"string\">\"#ip = :val\"</span>)</span><br><span class=\"line\">//                    .withNameMap(new NameMap().with(<span class=\"string\">\"#ip\"</span>, <span class=\"string\">\"InProduction\"</span>))</span><br><span class=\"line\">//                    .withValueMap(new ValueMap().withBoolean(<span class=\"string\">\":val\"</span>, <span class=\"literal\">false</span>))</span><br><span class=\"line\">                    .withReturnValues(ReturnValue.ALL_OLD);</span><br><span class=\"line\">            DeleteItemOutcome outcome = table.deleteItem(deleteItemSpec);</span><br><span class=\"line\"> </span><br><span class=\"line\">            // Confirm</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Displaying deleted item...\"</span>);</span><br><span class=\"line\">            System.out.println(outcome.getItem().toJSONPretty());</span><br><span class=\"line\">            <span class=\"built_in\">return</span> outcome.getItem().toJSONPretty();</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            System.err.println(<span class=\"string\">\"Cannot delete item in \"</span> + tableName);</span><br><span class=\"line\">            System.err.println(e.getMessage());</span><br><span class=\"line\">            <span class=\"built_in\">return</span> e.getMessage();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"3-결론\"><a href=\"#3-결론\" class=\"headerlink\" title=\"3) 결론\"></a>3) 결론</h3><ul>\n<li>솔직히, 비용만 아니면 이보다 더 좋을수 없다고 느낄정도로 퍼포먼스가 최상이다.</li>\n<li>원가절감을 최우선 과제중 하나로 생각하는 경동에서는 원가절감하자 그냥 ㅡㅡ… 개발자가 고생해서 퍼포먼스를 비슷한 수준까지 끌어올려야지 어떻게하겠나.</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS ConsoleDynamoDB 설명다 필요없다. 서버쪽 공부한 사람이라면 No SQL이라는 단어 하나만으로도 설명이 된다.RDB보다 아주 상당히 비싸다. 요금 기준이 읽기, 쓰기니까","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"dynamo","slug":"dynamo","count":1,"path":"api/tags/dynamo.json"},{"name":"noSQL","slug":"noSQL","count":1,"path":"api/tags/noSQL.json"}]},{"title":"iotCore","slug":"iotCore","date":"2020-05-05T23:47:30.000Z","updated":"2020-05-11T01:14:12.653Z","comments":true,"pin":null,"path":"api/articles/iotCore.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/81146079-8d8cff80-8fb2-11ea-9c70-659a95ce13a1.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"IoT-Core-설명\"><a href=\"#IoT-Core-설명\" class=\"headerlink\" title=\"IoT Core 설명\"></a>IoT Core 설명</h2><ol>\n<li>AWS IoT Core는 커넥티드 디바이스가 쉽고 안전하게 클라우드 애플리케이션 및 다른 디바이스와 상호 작용할 수 있게 해주는 관리형 클라우드 서비스입니다. AWS IoT Core는 수십억 개의 디바이스와 수조 건의 메시지를 지원하며, 안전하고 안정적으로 이러한 메시지를 처리하여 AWS 엔드포인트 및 다른 디바이스로 라우팅할 수 있습니다. AWS IoT Core의 경우, 디바이스가 연결되어 있지 않더라도 언제나 애플리케이션에서 모든 디바이스를 추적하고 디바이스와 통신할 수 있습니다.</li>\n<li>또한 AWS IoT Core를 사용하면 인프라를 관리할 필요 없이, AWS Lambda, Amazon Kinesis, Amazon S3, Amazon SageMaker, Amazon DynamoDB, Amazon CloudWatch, AWS CloudTrail, Amazon QuickSight 및 Alexa Voice Service와 같은 AWS 및 Amazon 서비스를 사용하여, 커넥티드 디바이스에서 생성한 데이터를 수집, 처리 및 분석하고 이를 기반으로 운영하는 IoT 애플리케이션을 손쉽게 구축할 수 있습니다.</li>\n<li>현재 경동에서는 AWS IoT Core 플랫폼을 Converter쪽에서 주로 컨트롤 하고 있다.(자세한 설명은 생략한다..) </li>\n</ol>\n<p><a href=\"https://user-images.githubusercontent.com/62123161/81146079-8d8cff80-8fb2-11ea-9c70-659a95ce13a1.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146079-8d8cff80-8fb2-11ea-9c70-659a95ce13a1.png\" alt=\"iotcore_01\"></a><br><em>초기화면 - 전체 디바이스에 대한 현황을 보여준다.</em></p>\n<ul>\n<li>기존 다른 서비스와 다른 점으로는 하나의 플랫폼이 모든 서비스의 디바이스를 관리한다는 점. (서비스별로 그룹화 불가능 / 물론, Additional Value로 값을 지정할 수는 있음.)</li>\n<li>경동은 Manage, Secure, Act, Test 네가지 속성만을 사용한다. (Setting은 무시 ㅡㅡ;)</li>\n</ul>\n<h3 id=\"1-Manage\"><a href=\"#1-Manage\" class=\"headerlink\" title=\"1) Manage\"></a>1) Manage</h3><h4 id=\"Things\"><a href=\"#Things\" class=\"headerlink\" title=\"Things\"></a>Things</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81146081-8e259600-8fb2-11ea-91dc-6815331e657f.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146081-8e259600-8fb2-11ea-91dc-6815331e657f.png\" alt=\"iotcore_02\"></a></p>\n<ul>\n<li>Things는 디바이스 전체가 나오는 화면 / 검색을 통하여 특정 디바이스를 찾을 수 있으며, 연결이 됬는지 안됬는지 확인할 수 있다.(명령어 예-  connectivity.connected:true)</li>\n</ul>\n<h4 id=\"Type\"><a href=\"#Type\" class=\"headerlink\" title=\"Type\"></a>Type</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81146082-8e259600-8fb2-11ea-9f1f-1b7b523a9f28.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146082-8e259600-8fb2-11ea-9f1f-1b7b523a9f28.png\" alt=\"iotcore_03\"></a></p>\n<ul>\n<li>디바이스 별로 Section을 구분할 수 없기에 Type으로 지정할 수 있다.</li>\n</ul>\n<h4 id=\"Thing-groups\"><a href=\"#Thing-groups\" class=\"headerlink\" title=\"Thing groups\"></a>Thing groups</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81146071-8b2aa580-8fb2-11ea-9dee-0fff15dabd08.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146071-8b2aa580-8fb2-11ea-9dee-0fff15dabd08.png\" alt=\"iotcore_04\"></a></p>\n<ul>\n<li>현재는 스마트톡 밖에 없지만, 향후 서비스별로 추가가 될 예정이다.</li>\n</ul>\n<h4 id=\"Secure\"><a href=\"#Secure\" class=\"headerlink\" title=\"Secure\"></a>Secure</h4><h5 id=\"Certificates\"><a href=\"#Certificates\" class=\"headerlink\" title=\"Certificates\"></a>Certificates</h5><p><a href=\"https://user-images.githubusercontent.com/62123161/81146073-8c5bd280-8fb2-11ea-992d-b30143ac216c.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146073-8c5bd280-8fb2-11ea-992d-b30143ac216c.png\" alt=\"iotcore_05\"></a></p>\n<ul>\n<li>IoT Core의 꽃이다. 인증서는 각 디바이스별로 갖고있으며, 인증서가 있어야만 Things에 등록될 수 있다.</li>\n<li>반대로 얘기하면 인증서가 없이는 어떤 디바이스라도(실제 우리제품이라고 하더라도) 등록이 안된다는 소리이며</li>\n<li>이 얘기를 조금 더 풀어 해석한다면, 관리가 철저해야 한다는 것이다. 인증서 잃어버리는 순간 모든 디바이스가 접속불가 상태가 발생할 수 있다.</li>\n</ul>\n<h5 id=\"Policies\"><a href=\"#Policies\" class=\"headerlink\" title=\"Policies\"></a>Policies</h5><p><a href=\"https://user-images.githubusercontent.com/62123161/81146074-8c5bd280-8fb2-11ea-8f0c-f8c31f10cd69.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146074-8c5bd280-8fb2-11ea-8f0c-f8c31f10cd69.png\" alt=\"iotcore_06\"></a></p>\n<ul>\n<li>정책이다. 화면 하단의 Json처럼 접근에 대한 권한을 지정할 수 있다. 아직 IAM 권한에 대해 완벽하게 공부하지 않아서, 연습때문에 모든 권한을 풀어둔 상태다. 나중에는 수정해야한다.</li>\n<li>정책에서 연결된 인증서 관리도 가능하다. </li>\n<li>(인증서-정책)은 하나의 쌍이다. 둘 중 하나라도 없으면 서비스가 돌아가지 않는다.</li>\n</ul>\n<h4 id=\"Act\"><a href=\"#Act\" class=\"headerlink\" title=\"Act\"></a>Act</h4><h5 id=\"Rules\"><a href=\"#Rules\" class=\"headerlink\" title=\"Rules\"></a>Rules</h5><p><a href=\"https://user-images.githubusercontent.com/62123161/81146075-8cf46900-8fb2-11ea-89a0-1b77f260ecba.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146075-8cf46900-8fb2-11ea-89a0-1b77f260ecba.png\" alt=\"iotcore_07\"></a></p>\n<ul>\n<li>위에서 디바이스쪽의 꽃이 인증서였다면, 서버쪽의 꽃은 바로 이 Rule Engine이다.</li>\n<li>기본 Rule은 쿼리 시스템으로 움직인다. MQTT 기준 Topic주제를 통해서 들어오는 데이터는 모두 Rule Engine을 거친다고 보면된다.</li>\n<li>따라서, 디바이스에서 보내는 신호를 어떻게 처리할지 마음대로 정해줄 수 있다. (INPUT / OUTPUT 데이터 모두 컨트롤이 가능하다.)</li>\n</ul>\n<h4 id=\"Test\"><a href=\"#Test\" class=\"headerlink\" title=\"Test\"></a>Test</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81146077-8cf46900-8fb2-11ea-87f0-60331ea24adb.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81146077-8cf46900-8fb2-11ea-87f0-60331ea24adb.png\" alt=\"iotcore_08\"></a></p>\n<ul>\n<li>직접 써보기 바란다. 더 이상의 설명은 생략함.</li>\n<li>힌트 : MQTT라고 써져있듯이 Topic을 통한 Pub/Sub 구조임. Topic을 Sub한 상태로 아래 Pub에 데이터를 싣어서 보내면 수신함.(뭔가 다 알려준거같은데…. 그래도모르면 질문….)</li>\n</ul>\n<h3 id=\"2-소스\"><a href=\"#2-소스\" class=\"headerlink\" title=\"2) 소스\"></a>2) 소스</h3><ul>\n<li>100줄도 안된다. (기타 자체 참조가 좀 들어가있지만, 그냥 보고 쓰기엔 나쁘지 않을 것이다.)</li>\n<li>그리고, 당연한 얘기지만 IoT Core는 Full Managing System이다. 따라서, Create Things만 있다.<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LambdaLogger logger = context.getLogger();</span><br><span class=\"line\">ResponseCreateThings responseCreateThings = new ResponseCreateThings();</span><br><span class=\"line\">try&#123;</span><br><span class=\"line\">    logger.log(<span class=\"string\">\"Start CreateThings\"</span>);</span><br><span class=\"line\">    SecretManagerHelper.getInstance();</span><br><span class=\"line\"> </span><br><span class=\"line\">    String queryString = String.format(<span class=\"string\">\"thingName:roomcon-%s\"</span>, request.macAddress);</span><br><span class=\"line\">    GetStatisticsRequest getStatisticsRequest = new GetStatisticsRequest().withQueryString(queryString);</span><br><span class=\"line\">    GetStatisticsResult result = AWSIoTHelper.getInstance().getAWSIot().getStatistics(getStatisticsRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">    Map&lt;String, String&gt; attributes = new HashMap&lt;String, String&gt;();</span><br><span class=\"line\">    attributes.put(<span class=\"string\">\"ADDITIONAL_VALUE\"</span>, request.additionalValue);</span><br><span class=\"line\">    attributes.put(<span class=\"string\">\"THINGS_TYPE\"</span>, request.thingsType);</span><br><span class=\"line\">    AttributePayload attributePayload = new AttributePayload().withAttributes(attributes);//.addAttributesEntry(<span class=\"string\">\"ADDITIONAL_VALUE\"</span>, request.additionalValue);</span><br><span class=\"line\"> </span><br><span class=\"line\">    String thingName = String.format(<span class=\"string\">\"roomcon-%s\"</span>, request.macAddress);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(result.getStatistics().getCount() == 0)&#123;</span><br><span class=\"line\">        String groupName = <span class=\"string\">\"etc\"</span>;</span><br><span class=\"line\">        String secureArn = Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_SECURE_1ST_ARN\"</span>).asText();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(request.thingsType.equals(<span class=\"string\">\"001\"</span>))&#123;</span><br><span class=\"line\">            groupName = <span class=\"string\">\"nr-30d\"</span>;</span><br><span class=\"line\">            secureArn = Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_SECURE_1ST_ARN\"</span>).asText();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(request.thingsType.equals(<span class=\"string\">\"002\"</span>))&#123;</span><br><span class=\"line\">            groupName = <span class=\"string\">\"nr-35d\"</span>;</span><br><span class=\"line\">            secureArn = Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_SECURE_2ND_ARN\"</span>).asText();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(request.thingsType.equals(<span class=\"string\">\"003\"</span>))&#123;</span><br><span class=\"line\">            groupName = <span class=\"string\">\"nr-40d\"</span>;</span><br><span class=\"line\">            secureArn = Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_SECURE_2ND_ARN\"</span>).asText();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(request.thingsType.equals(<span class=\"string\">\"011\"</span>))&#123;</span><br><span class=\"line\">            groupName = <span class=\"string\">\"nrm-35d\"</span>;</span><br><span class=\"line\">            secureArn = Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_SECURE_2ND_ARN\"</span>).asText();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        CreateThingRequest createThingRequest = new CreateThingRequest()</span><br><span class=\"line\">                .withThingName(thingName)</span><br><span class=\"line\">                .withAttributePayload(attributePayload)</span><br><span class=\"line\">                .withThingTypeName(<span class=\"string\">\"RoomController\"</span>);</span><br><span class=\"line\">        CreateThingResult createThingResult = AWSIoTHelper.getInstance().getAWSIot().createThing(createThingRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">        AddThingToThingGroupRequest addThingToThingGroupRequest = new AddThingToThingGroupRequest()</span><br><span class=\"line\">                .withThingArn(Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_THINGS_ARN\"</span>).asText() + thingName)</span><br><span class=\"line\">                .withThingGroupArn(Config.IOT_CORE_NODE.path(<span class=\"string\">\"IOT_CORE_GROUP_ARN\"</span>).asText() + groupName)</span><br><span class=\"line\">                .withThingGroupName(groupName)</span><br><span class=\"line\">                .withThingName(thingName);</span><br><span class=\"line\">        AddThingToThingGroupResult addThingToThingGroupResult = AWSIoTHelper.getInstance().getAWSIot().addThingToThingGroup(addThingToThingGroupRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">        AttachThingPrincipalRequest attachThingPrincipalRequest = new AttachThingPrincipalRequest()</span><br><span class=\"line\">                .withThingName(thingName)</span><br><span class=\"line\">                .withPrincipal(secureArn);</span><br><span class=\"line\">        AttachThingPrincipalResult attachThingPrincipalResult = AWSIoTHelper.getInstance().getAWSIot().attachThingPrincipal(attachThingPrincipalRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">        responseCreateThings.isSuccess = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        responseCreateThings.successCode = 201;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        UpdateThingRequest updateThingRequest = new UpdateThingRequest()</span><br><span class=\"line\">                .withThingName(thingName)</span><br><span class=\"line\">                .withAttributePayload(attributePayload);</span><br><span class=\"line\">        UpdateThingResult updateThingResult = AWSIoTHelper.getInstance().getAWSIot().updateThing(updateThingRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">        responseCreateThings.isSuccess = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        responseCreateThings.successCode = 200;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; catch(Throwable e) &#123;</span><br><span class=\"line\">    logger.log(<span class=\"string\">\"Error CreateThings\"</span>);</span><br><span class=\"line\">    responseCreateThings.isSuccess = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    responseCreateThings.successCode = 500;</span><br><span class=\"line\">&#125; finally &#123;</span><br><span class=\"line\">    logger.log(<span class=\"string\">\"End CreateThings\"</span>);</span><br><span class=\"line\">    <span class=\"built_in\">return</span> responseCreateThings;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS ConsoleIoT Core 설명AWS IoT Core는 커넥티드 디바이스가 쉽고 안전하게 클라우드 애플리케이션 및 다른 디바이스와 상호 작용할 수 있게 해주는 관리형 클라우드 서","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"iot","slug":"iot","count":1,"path":"api/tags/iot.json"},{"name":"IoT Core","slug":"IoT-Core","count":1,"path":"api/tags/IoT-Core.json"}]},{"title":"SQS(Simple Queue Service)","slug":"SQS","date":"2020-05-02T04:54:16.000Z","updated":"2020-05-11T04:01:04.585Z","comments":true,"pin":null,"path":"api/articles/SQS.json","excerpt":"","keywords":null,"cover":"https://user-images.githubusercontent.com/62123161/80855560-14716d80-8c7d-11ea-9a58-fa748f417da0.png","content":"<ol>\n<li><p>Kinesis가 있으니 SQS를 쓸 일이 없겠다. 이걸 뭐하러 쓰나?</p>\n</li>\n<li><p>라고 생각했다면, 한참 더 공부해야한다. </p>\n</li>\n<li><p>우선 Kinesis와 SQS의 큰 차이점을 비교한다.</p>\n</li>\n</ol>\n<h3 id=\"Kinesis-vs-SQS\"><a href=\"#Kinesis-vs-SQS\" class=\"headerlink\" title=\"Kinesis vs SQS\"></a>Kinesis vs SQS</h3><ul>\n<li>Kinesis는 스트리밍 데이터 수집 서비스이고 SQS는 메시지 대기열이다.</li>\n<li>Kinesis는 대량의 스트리밍 데이터를 수집하도록 설계되었으며 SQS는 메시지 브로커, 디커플링 메커니즘으로 설계되었으며 이벤트 중심 아키텍처다.</li>\n<li>SQS를 사용하면 큐에서 메시지를 가져 와서 처리 중에 보이지 않는 것으로 표시 할 수 있습니다. 해당 소비자가 메시지를 큐에서 삭제하지 않으면 가시성 시간 초과가 만료 된 후에 메시지가 큐로 돌아가서 다른 소비자가 메시지를 처리 ​​할 수 ​​있습니다. SQS에는 데드 레터 큐가 내장되어 있습니다. 이러한 기능을 통해 다른 소비자가 대기열로 돌아갈 때 실패한 메시지 처리를 자동으로 재 시도 할 수 있습니다. SQS는 또한 많은 소비자가 대기열에서 메시지를 가져 와서 병렬로 처리 할 수 ​​있도록함으로써 병렬 또는 팬 아웃 처리 아키텍처를 지원합니다.</li>\n<li>Kinesis 및 Kinesis Firehose는 Elasticsearch, DynamoDB, S3 등과 같은 서비스 (데이터의 지속성 저장소)와 통합되는 반면 SQS는 Lambda, S3, SNS 등과 같은 서비스 (메시징 및 이벤트 중심 구성 요소)와 통합됩니다.</li>\n<li>이외에도 엄청나게 많은 차이점이 있지만, 링크 참고하면 더 큰 차이를 느낄 수 있음.</li>\n</ul>\n<h2 id=\"SQS는-최초의-AWS-서비스\"><a href=\"#SQS는-최초의-AWS-서비스\" class=\"headerlink\" title=\"SQS는 최초의 AWS 서비스!!!\"></a>SQS는 최초의 AWS 서비스!!!</h2><h3 id=\"1-SQS-서비스-만들기\"><a href=\"#1-SQS-서비스-만들기\" class=\"headerlink\" title=\"1) SQS 서비스 만들기.\"></a>1) SQS 서비스 만들기.</h3><p><a href=\"https://user-images.githubusercontent.com/62123161/80855560-14716d80-8c7d-11ea-9a58-fa748f417da0.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/80855560-14716d80-8c7d-11ea-9a58-fa748f417da0.png\" alt=\"sqs_01\"></a><br>끝.</p>\n<ul>\n<li>허무하지만 이게 끝 맞다. 소스로는 아래와 같이 추가해주면 된다.</li>\n</ul>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Standard Queue vs FIFO Queue</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //2-1. Standard Create Queue</span><br><span class=\"line\">    CreateQueueRequest create_request = new CreateQueueRequest(<span class=\"string\">\"minseoktestQueue\"</span>)</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"DelaySeconds\"</span>, <span class=\"string\">\"0\"</span>) //An <span class=\"built_in\">integer</span> from 0 to 900 seconds (15 minutes). Default: 0.</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"30\"</span>) // An <span class=\"built_in\">integer</span> from 0 to 43,200 (12 hours). Default: 30.</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"MessageRetentionPeriod\"</span>, <span class=\"string\">\"345600\"</span>) // An <span class=\"built_in\">integer</span> from 60 seconds (1 minute) to 1,209,600 seconds (14 days). Default: 345,600 (4 days).</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"MaximumMessageSize\"</span>, <span class=\"string\">\"262144\"</span>); //An <span class=\"built_in\">integer</span> from 1,024 bytes (1 KiB) to 262,144 bytes (256 KiB). Default: 262,144 (256 KiB).</span><br><span class=\"line\">    String standardQueueUrl = sqs.createQueue(create_request).getQueueUrl();</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-1. FIFO Create Queue</span><br><span class=\"line\">    Map&lt;String, String&gt; queueAttributes = new HashMap&lt;&gt;();</span><br><span class=\"line\">    queueAttributes.put(<span class=\"string\">\"FifoQueue\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">    queueAttributes.put(<span class=\"string\">\"ContentBasedDeduplication\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">    queueAttributes.put(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">    CreateQueueRequest createFifoQueueRequest = new CreateQueueRequest(</span><br><span class=\"line\">            <span class=\"string\">\"minseok1.fifo\"</span>).withAttributes(queueAttributes);</span><br><span class=\"line\">    String fifoQueueUrl = sqs.createQueue(createFifoQueueRequest)</span><br><span class=\"line\">            .getQueueUrl();</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>하지만, 이렇게 끝나면 정말 별거 없는 서비스가 될 우려가 있기에 많은 소스코드와 함께 지원되는 API를 검토하고 활용해보자.</li>\n<li>SQS도 Kinesis와 마찬가지로 큐에 데이터를 쌓는것이지만, SQS는 Console화면에서 데이터가 어떤것이 들어있는지 아주 매우 많이 쉽게 볼 수 있다.</li>\n<li>예제는 현재 Alive데이터를 담아두도록 설계해둔 SQS(2020-01-30 기준으로 폐쇄) alive-sqs-event 큐이다.<br><a href=\"https://user-images.githubusercontent.com/62123161/80855561-15a29a80-8c7d-11ea-99fe-dd9d95635b7e.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/80855561-15a29a80-8c7d-11ea-99fe-dd9d95635b7e.png\" alt=\"sqs_02\"></a> </li>\n<li>화면보면 알겠지만, 페이지별로 몇개의 Row를 볼 수 있는지와 Polling 주기를 선택할 수 있다.</li>\n</ul>\n<h3 id=\"2-기능\"><a href=\"#2-기능\" class=\"headerlink\" title=\"2) 기능\"></a>2) 기능</h3><h4 id=\"전체-큐-리스트\"><a href=\"#전체-큐-리스트\" class=\"headerlink\" title=\"전체 큐 리스트\"></a>전체 큐 리스트</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Queue List</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //1-2. Standard Queue List(All)</span><br><span class=\"line\">    ListQueuesResult lq_result = sqs.listQueues();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"Your SQS Queue URLs:\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">        System.out.println(url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-2. FIFO Queue List(All)</span><br><span class=\"line\">    ListQueuesResult lq_result = sqs.listQueues();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"Your SQS Queue URLs:\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">        System.out.println(url);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"특정키워드로-큐-찾기-여러개-검색해도-가능-→-Queue-이름이다-Queue의-데이터가-아니고\"><a href=\"#특정키워드로-큐-찾기-여러개-검색해도-가능-→-Queue-이름이다-Queue의-데이터가-아니고\" class=\"headerlink\" title=\"특정키워드로 큐 찾기(여러개 검색해도 가능) → Queue 이름이다. Queue의 데이터가 아니고!!\"></a>특정키워드로 큐 찾기(여러개 검색해도 가능) → Queue 이름이다. Queue의 데이터가 아니고!!</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Find Queue</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //1-3. Standard Queue Search(KEY_WORD)</span><br><span class=\"line\">    String name_prefix = <span class=\"string\">\"KEY_WORD_ENTER\"</span>;</span><br><span class=\"line\">    lq_result = sqs.listQueues(new ListQueuesRequest(name_prefix));</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"Queue URLs with prefix: \"</span> + name_prefix);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">        System.out.println(url);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-3. FIFO Queue Search(KEY_WORD)</span><br><span class=\"line\">    String name_prefix = <span class=\"string\">\"KEY_WORD_ENTER\"</span>;</span><br><span class=\"line\">    lq_result = sqs.listQueues(new ListQueuesRequest(name_prefix));</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"Queue URLs with prefix: \"</span> + name_prefix);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">        System.out.println(url);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"큐-삭제\"><a href=\"#큐-삭제\" class=\"headerlink\" title=\"큐 삭제\"></a>큐 삭제</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Delete Queue</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //1-4. Standard Queue Delete(URL)</span><br><span class=\"line\">    sqs.deleteQueue(fifoQueueUrl);</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-4. FIFO Queue Delete(URL)</span><br><span class=\"line\">    sqs.deleteQueue(fifoQueueUrl);</span><br></pre></td></tr></table></figure></div>\n<h4 id=\"단일-데이터-삽입\"><a href=\"#단일-데이터-삽입\" class=\"headerlink\" title=\"단일 데이터 삽입\"></a>단일 데이터 삽입</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Insert Single Message</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //1-5. Standard Posting a Message to a Queue</span><br><span class=\"line\">    SendMessageRequest send_msg_request = new SendMessageRequest()</span><br><span class=\"line\">            .withQueueUrl(fifoQueueUrl)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">            .withDelaySeconds(0);</span><br><span class=\"line\">    sqs.sendMessage(send_msg_request);</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-5. FIFO Posting a Message to a FIFO Queue</span><br><span class=\"line\">    SendMessageRequest send_msg_request = new SendMessageRequest()</span><br><span class=\"line\">            .withQueueUrl(fifoQueueUrl)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">            .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>)</span><br><span class=\"line\">            .withDelaySeconds(0);</span><br><span class=\"line\">    sqs.sendMessage(send_msg_request);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"여러-데이터-삽입\"><a href=\"#여러-데이터-삽입\" class=\"headerlink\" title=\"여러 데이터 삽입\"></a>여러 데이터 삽입</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Insert Multiple Data </span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE의 경우</span><br><span class=\"line\">    //1-6. Standard Posting Multiple Messages to a Queue</span><br><span class=\"line\">    List&lt;SendMessageBatchRequestEntry&gt; messageEntries = new ArrayList&lt;&gt;();</span><br><span class=\"line\">    messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">            .withId(<span class=\"string\">\"id-1\"</span>)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"batch-1\"</span>));</span><br><span class=\"line\">    messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">            .withId(<span class=\"string\">\"id-2\"</span>)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"batch-2\"</span>));</span><br><span class=\"line\"> </span><br><span class=\"line\">    SendMessageBatchRequest sendMessageBatchRequest</span><br><span class=\"line\">            = new SendMessageBatchRequest(fifoQueueUrl, messageEntries);</span><br><span class=\"line\">    sqs.sendMessageBatch(sendMessageBatchRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">//FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-6. FIFO Posting Multiple Messages to a Queue</span><br><span class=\"line\">    List&lt;SendMessageBatchRequestEntry&gt; messageEntries = new ArrayList&lt;&gt;();</span><br><span class=\"line\">    messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">            .withId(<span class=\"string\">\"id-1\"</span>)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"batch-1\"</span>)</span><br><span class=\"line\">            .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>));</span><br><span class=\"line\">    messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">            .withId(<span class=\"string\">\"id-2\"</span>)</span><br><span class=\"line\">            .withMessageBody(<span class=\"string\">\"batch-2\"</span>)</span><br><span class=\"line\">            .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>));</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"큐-내의-데이터-읽기\"><a href=\"#큐-내의-데이터-읽기\" class=\"headerlink\" title=\"큐 내의 데이터 읽기\"></a>큐 내의 데이터 읽기</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Read Data In Queue</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE / FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-7. Reading Messages from Queues</span><br><span class=\"line\">    ReceiveMessageRequest receiveMessageRequest = new ReceiveMessageRequest(fifoQueueUrl)</span><br><span class=\"line\">            .withWaitTimeSeconds(10)</span><br><span class=\"line\">            .withMaxNumberOfMessages(10);</span><br><span class=\"line\"> </span><br><span class=\"line\">    List&lt;Message&gt; sqsMessages = sqs.receiveMessage(receiveMessageRequest).getMessages();</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"큐-내의-데이터-삭제\"><a href=\"#큐-내의-데이터-삭제\" class=\"headerlink\" title=\"큐 내의 데이터 삭제\"></a>큐 내의 데이터 삭제</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Delete Data In Queue</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE / FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-8. Deleting a Message from a Queue</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Message m : sqsMessages) &#123;</span><br><span class=\"line\">        sqs.deleteMessage(fifoQueueUrl, m.getReceiptHandle());</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"전달못한-Queue\"><a href=\"#전달못한-Queue\" class=\"headerlink\" title=\"전달못한 Queue\"></a>전달못한 Queue</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Dead Letter Queues</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE / FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-9. FIFO Dead Letter Queues1(TODO:배달못한 편지 대기열을 생성하고,</span><br><span class=\"line\">    /*String deadLetterQueueUrl = sqs.createQueue(<span class=\"string\">\"aws-sqs://notification_queue?amazonSQSClient=#sqsClient\"</span>).getQueueUrl();*/</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        // Create dead-letter queue</span><br><span class=\"line\">        Map&lt;String, String&gt; queueAttributes = new HashMap&lt;&gt;();</span><br><span class=\"line\">        queueAttributes.put(<span class=\"string\">\"FifoQueue\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">        queueAttributes.put(<span class=\"string\">\"ContentBasedDeduplication\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">        queueAttributes.put(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">        CreateQueueRequest createFifoQueueRequest = new CreateQueueRequest(</span><br><span class=\"line\">                <span class=\"string\">\"deadletterminseok.fifo\"</span>).withAttributes(queueAttributes);</span><br><span class=\"line\">        String fifoQueueUrls = sqs.createQueue(createFifoQueueRequest)</span><br><span class=\"line\">                .getQueueUrl();</span><br><span class=\"line\">    &#125; catch (AmazonSQSException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!e.getErrorCode().equals(<span class=\"string\">\"QueueAlreadyExists\"</span>)) &#123;</span><br><span class=\"line\">            throw e;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //TODO:minseok.fifo 로 통신하다가 부하가 걸리면 deadletterminseok.fifo로 보내도록 설정하는 아래 코드</span><br><span class=\"line\">    String dl_queue_url = sqs.getQueueUrl(<span class=\"string\">\"deadletterminseok.fifo\"</span>)</span><br><span class=\"line\">            .getQueueUrl();</span><br><span class=\"line\">    GetQueueAttributesResult queue_attrs = sqs.getQueueAttributes(</span><br><span class=\"line\">            new GetQueueAttributesRequest(dl_queue_url)</span><br><span class=\"line\">                    .withAttributeNames(<span class=\"string\">\"QueueArn\"</span>));</span><br><span class=\"line\">    String dl_queue_arn = queue_attrs.getAttributes().get(<span class=\"string\">\"QueueArn\"</span>);</span><br><span class=\"line\">    // Set dead letter queue with redrive policy on <span class=\"built_in\">source</span> queue.</span><br><span class=\"line\">    String src_queue_url = sqs.getQueueUrl(<span class=\"string\">\"minseok.fifo\"</span>)</span><br><span class=\"line\">            .getQueueUrl();</span><br><span class=\"line\">    SetQueueAttributesRequest request = new SetQueueAttributesRequest()</span><br><span class=\"line\">            .withQueueUrl(src_queue_url)</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"RedrivePolicy\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"&#123;\\\"maxReceiveCount\\\":\\\"5\\\", \\\"deadLetterTargetArn\\\":\\\"\"</span></span><br><span class=\"line\">                            + dl_queue_arn + <span class=\"string\">\"\\\"&#125;\"</span>);</span><br><span class=\"line\">    sqs.setQueueAttributes(request);</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">//또다른 방법(샘플)</span><br><span class=\"line\">    //1-10. FIFO Dead Letter Queues</span><br><span class=\"line\">    GetQueueAttributesResult deadLetterQueueAttributes = sqs.getQueueAttributes(</span><br><span class=\"line\">            new GetQueueAttributesRequest(dl_queue_url)</span><br><span class=\"line\">                    .withAttributeNames(<span class=\"string\">\"QueueArn\"</span>));</span><br><span class=\"line\"> </span><br><span class=\"line\">    String deadLetterQueueARN = deadLetterQueueAttributes.getAttributes()</span><br><span class=\"line\">            .get(<span class=\"string\">\"QueueArn\"</span>);</span><br><span class=\"line\">    SetQueueAttributesRequest queueAttributesRequest = new SetQueueAttributesRequest()</span><br><span class=\"line\">            //.withQueueUrl(standardQueueUrl)</span><br><span class=\"line\">            .withQueueUrl(<span class=\"string\">\"https://sqs.ap-northeast-2.amazonaws.com/[ALLIAS]/[FIFO_NAME]\"</span>)</span><br><span class=\"line\">            .addAttributesEntry(<span class=\"string\">\"RedrivePolicy\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"&#123;\\\"maxReceiveCount\\\":\\\"2\\\", \"</span></span><br><span class=\"line\">                            + <span class=\"string\">\"\\\"deadLetterTargetArn\\\":\\\"\"</span> + deadLetterQueueARN + <span class=\"string\">\"\\\"&#125;\"</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    sqs.setQueueAttributes(queueAttributesRequest);</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"Monitoring\"><a href=\"#Monitoring\" class=\"headerlink\" title=\"Monitoring\"></a>Monitoring</h4><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Standard QUEUE / FIFO QUEUE의 경우</span><br><span class=\"line\">    //1-11. FIFO Monitoring</span><br><span class=\"line\">    GetQueueAttributesRequest getQueueAttributesRequest</span><br><span class=\"line\">            //= new GetQueueAttributesRequest(standardQueueUrl) </span><br><span class=\"line\">            = new GetQueueAttributesRequest(<span class=\"string\">\"https://sqs.ap-northeast-2.amazonaws.com/[ALLIAS]/[FIFO_NAME]\"</span>)</span><br><span class=\"line\">            .withAttributeNames(<span class=\"string\">\"All\"</span>);</span><br><span class=\"line\">    GetQueueAttributesResult getQueueAttributesResult</span><br><span class=\"line\">            = sqs.getQueueAttributes(getQueueAttributesRequest);</span><br><span class=\"line\">    System.out.println(String.format(<span class=\"string\">\"The number of messages on the queue: %s\"</span>,</span><br><span class=\"line\">            getQueueAttributesResult.getAttributes()</span><br><span class=\"line\">                    .get(<span class=\"string\">\"ApproximateNumberOfMessages\"</span>)));</span><br><span class=\"line\">    System.out.println(String.format(<span class=\"string\">\"The number of messages in flight: %s\"</span>,</span><br><span class=\"line\">            getQueueAttributesResult.getAttributes()</span><br><span class=\"line\">                    .get(<span class=\"string\">\"ApproximateNumberOfMessagesNotVisible\"</span>)));</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"전체-Full-소스\"><a href=\"#전체-Full-소스\" class=\"headerlink\" title=\"[전체 Full 소스]\"></a>[전체 Full 소스]</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>full source</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package helloworld;</span><br><span class=\"line\"> </span><br><span class=\"line\">import java.io.BufferedReader;</span><br><span class=\"line\">import java.io.InputStreamReader;</span><br><span class=\"line\">import java.io.IOException;</span><br><span class=\"line\">import java.net.URL;</span><br><span class=\"line\">import java.util.ArrayList;</span><br><span class=\"line\">import java.util.HashMap;</span><br><span class=\"line\">import java.util.List;</span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\">import java.util.stream.Collectors;</span><br><span class=\"line\"> </span><br><span class=\"line\">import com.amazonaws.auth.AWSStaticCredentialsProvider;</span><br><span class=\"line\">import com.amazonaws.auth.BasicAWSCredentials;</span><br><span class=\"line\">import com.amazonaws.regions.Regions;</span><br><span class=\"line\">import com.amazonaws.services.lambda.runtime.Context;</span><br><span class=\"line\">import com.amazonaws.services.lambda.runtime.RequestHandler;</span><br><span class=\"line\">import com.amazonaws.services.sqs.AmazonSQS;</span><br><span class=\"line\">import com.amazonaws.services.sqs.AmazonSQSClientBuilder;</span><br><span class=\"line\">import com.amazonaws.services.sqs.model.*;</span><br><span class=\"line\">import com.amazonaws.services.sqs.model.ListQueuesResult;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">/**</span><br><span class=\"line\"> * Handler <span class=\"keyword\">for</span> requests to Lambda <span class=\"keyword\">function</span>.</span><br><span class=\"line\"> */</span><br><span class=\"line\">public class App implements RequestHandler&lt;Object, Object&gt; &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    public Object handleRequest(final Object input, final Context context) &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        BasicAWSCredentials credentials = new BasicAWSCredentials(<span class=\"string\">\"ACCESS_KEY\"</span>, <span class=\"string\">\"SECRET_KEY\"</span>);</span><br><span class=\"line\">        AmazonSQS sqs = AmazonSQSClientBuilder.standard()</span><br><span class=\"line\">                .withCredentials(new AWSStaticCredentialsProvider(credentials))</span><br><span class=\"line\">                .withRegion(Regions.AP_NORTHEAST_2)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        ///////Create, Delete 는 있거나 삭제할게 없으면 바로 에러 떨어짐..</span><br><span class=\"line\">//        //1-1. FIFO Create Queue</span><br><span class=\"line\">//        Map&lt;String, String&gt; queueAttributes = new HashMap&lt;&gt;();</span><br><span class=\"line\">//        queueAttributes.put(<span class=\"string\">\"FifoQueue\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">//        queueAttributes.put(<span class=\"string\">\"ContentBasedDeduplication\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">//        queueAttributes.put(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">//        CreateQueueRequest createFifoQueueRequest = new CreateQueueRequest(</span><br><span class=\"line\">//                <span class=\"string\">\"[FIFO_NAME]\"</span>).withAttributes(queueAttributes);</span><br><span class=\"line\">//        String fifoQueueUrl = sqs.createQueue(createFifoQueueRequest)</span><br><span class=\"line\">//                .getQueueUrl();</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-2. FIFO Queue List(All)</span><br><span class=\"line\">//        ListQueuesResult lq_result = sqs.listQueues();</span><br><span class=\"line\">//        System.out.println(<span class=\"string\">\"Your SQS Queue URLs:\"</span>);</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">//            System.out.println(url);</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        //1-3. FIFO Queue Search(KEY_WORD)</span><br><span class=\"line\">//        String name_prefix = <span class=\"string\">\"KEY_WORD_ENTER\"</span>;</span><br><span class=\"line\">//        lq_result = sqs.listQueues(new ListQueuesRequest(name_prefix));</span><br><span class=\"line\">//        System.out.println(<span class=\"string\">\"Queue URLs with prefix: \"</span> + name_prefix);</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">//            System.out.println(url);</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        //1-4. FIFO Queue Delete(URL)</span><br><span class=\"line\">//        sqs.deleteQueue(fifoQueueUrl);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-5. FIFO Posting a Message to a FIFO Queue</span><br><span class=\"line\">//        SendMessageRequest send_msg_request = new SendMessageRequest()</span><br><span class=\"line\">//                .withQueueUrl(fifoQueueUrl)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">//                .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>)</span><br><span class=\"line\">//                .withDelaySeconds(0);</span><br><span class=\"line\">//        sqs.sendMessage(send_msg_request);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-6. FIFO Posting Multiple Messages to a Queue</span><br><span class=\"line\">//        List&lt;SendMessageBatchRequestEntry&gt; messageEntries = new ArrayList&lt;&gt;();</span><br><span class=\"line\">//        messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">//                .withId(<span class=\"string\">\"id-1\"</span>)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"batch-1\"</span>)</span><br><span class=\"line\">//                .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>));</span><br><span class=\"line\">//        messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">//                .withId(<span class=\"string\">\"id-2\"</span>)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"batch-2\"</span>)</span><br><span class=\"line\">//                .withMessageGroupId(<span class=\"string\">\"minseok-group-1\"</span>));</span><br><span class=\"line\">//</span><br><span class=\"line\">//        SendMessageBatchRequest sendMessageBatchRequest</span><br><span class=\"line\">//                = new SendMessageBatchRequest(fifoQueueUrl, messageEntries);</span><br><span class=\"line\">//        sqs.sendMessageBatch(sendMessageBatchRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-7. FIFO Reading Messages from Queues</span><br><span class=\"line\">//        ReceiveMessageRequest receiveMessageRequest = new ReceiveMessageRequest(fifoQueueUrl)</span><br><span class=\"line\">//                .withWaitTimeSeconds(10)</span><br><span class=\"line\">//                .withMaxNumberOfMessages(10);</span><br><span class=\"line\">//</span><br><span class=\"line\">//        List&lt;Message&gt; sqsMessages = sqs.receiveMessage(receiveMessageRequest).getMessages();</span><br><span class=\"line\">//</span><br><span class=\"line\">//        //1-8. FIFO Deleting a Message from a Queue</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (Message m : sqsMessages) &#123;</span><br><span class=\"line\">//            sqs.deleteMessage(fifoQueueUrl, m.getReceiptHandle());</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-9. FIFO Dead Letter Queues1(배달못한 편지 대기열을 생성하고,</span><br><span class=\"line\">//        /*String deadLetterQueueUrl = sqs.createQueue(<span class=\"string\">\"aws-sqs://notification_queue?amazonSQSClient=#sqsClient\"</span>).getQueueUrl();*/</span><br><span class=\"line\">//        try &#123;</span><br><span class=\"line\">//            // Create dead-letter queue</span><br><span class=\"line\">//            Map&lt;String, String&gt; queueAttributes = new HashMap&lt;&gt;();</span><br><span class=\"line\">//            queueAttributes.put(<span class=\"string\">\"FifoQueue\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">//            queueAttributes.put(<span class=\"string\">\"ContentBasedDeduplication\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">//            queueAttributes.put(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">//            CreateQueueRequest createFifoQueueRequest = new CreateQueueRequest(</span><br><span class=\"line\">//                    <span class=\"string\">\"[DEADLETTER_FIFO_NAME]\"</span>).withAttributes(queueAttributes);</span><br><span class=\"line\">//            String fifoQueueUrls = sqs.createQueue(createFifoQueueRequest)</span><br><span class=\"line\">//                    .getQueueUrl();</span><br><span class=\"line\">//        &#125; catch (AmazonSQSException e) &#123;</span><br><span class=\"line\">//            <span class=\"keyword\">if</span> (!e.getErrorCode().equals(<span class=\"string\">\"QueueAlreadyExists\"</span>)) &#123;</span><br><span class=\"line\">//                throw e;</span><br><span class=\"line\">//            &#125;</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        //[FIFO_NAME] 로 통신하다가 부하가 걸리면 [DEADLETTER_FIFO_NAME]로 보내도록 설정하는 아래 코드</span><br><span class=\"line\">//        String dl_queue_url = sqs.getQueueUrl(<span class=\"string\">\"[DEADLETTER_FIFO_NAME]\"</span>)</span><br><span class=\"line\">//                .getQueueUrl();</span><br><span class=\"line\">//        GetQueueAttributesResult queue_attrs = sqs.getQueueAttributes(</span><br><span class=\"line\">//                new GetQueueAttributesRequest(dl_queue_url)</span><br><span class=\"line\">//                        .withAttributeNames(<span class=\"string\">\"QueueArn\"</span>));</span><br><span class=\"line\">//        String dl_queue_arn = queue_attrs.getAttributes().get(<span class=\"string\">\"QueueArn\"</span>);</span><br><span class=\"line\">//        // Set dead letter queue with redrive policy on <span class=\"built_in\">source</span> queue.</span><br><span class=\"line\">//        String src_queue_url = sqs.getQueueUrl(<span class=\"string\">\"[FIFO_NAME]\"</span>)</span><br><span class=\"line\">//                .getQueueUrl();</span><br><span class=\"line\">//        SetQueueAttributesRequest request = new SetQueueAttributesRequest()</span><br><span class=\"line\">//                .withQueueUrl(src_queue_url)</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"RedrivePolicy\"</span>,</span><br><span class=\"line\">//                        <span class=\"string\">\"&#123;\\\"maxReceiveCount\\\":\\\"5\\\", \\\"deadLetterTargetArn\\\":\\\"\"</span></span><br><span class=\"line\">//                                + dl_queue_arn + <span class=\"string\">\"\\\"&#125;\"</span>);</span><br><span class=\"line\">//        sqs.setQueueAttributes(request);</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-10. FIFO Dead Letter Queues</span><br><span class=\"line\">//        GetQueueAttributesResult deadLetterQueueAttributes = sqs.getQueueAttributes(</span><br><span class=\"line\">//                new GetQueueAttributesRequest(dl_queue_url)</span><br><span class=\"line\">//                        .withAttributeNames(<span class=\"string\">\"QueueArn\"</span>));</span><br><span class=\"line\">//</span><br><span class=\"line\">//        String deadLetterQueueARN = deadLetterQueueAttributes.getAttributes()</span><br><span class=\"line\">//                .get(<span class=\"string\">\"QueueArn\"</span>);</span><br><span class=\"line\">//        SetQueueAttributesRequest queueAttributesRequest = new SetQueueAttributesRequest()</span><br><span class=\"line\">//                //.withQueueUrl(standardQueueUrl)</span><br><span class=\"line\">//                .withQueueUrl(<span class=\"string\">\"https://sqs.ap-northeast-2.amazonaws.com/[ALLIAS]/[FIFO_NAME]\"</span>)</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"RedrivePolicy\"</span>,</span><br><span class=\"line\">//                        <span class=\"string\">\"&#123;\\\"maxReceiveCount\\\":\\\"2\\\", \"</span></span><br><span class=\"line\">//                                + <span class=\"string\">\"\\\"deadLetterTargetArn\\\":\\\"\"</span> + deadLetterQueueARN + <span class=\"string\">\"\\\"&#125;\"</span>);</span><br><span class=\"line\">//</span><br><span class=\"line\">//        sqs.setQueueAttributes(queueAttributesRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-11. FIFO Monitoring</span><br><span class=\"line\">//        GetQueueAttributesRequest getQueueAttributesRequest</span><br><span class=\"line\">//                //= new GetQueueAttributesRequest(standardQueueUrl) //https://sqs.ap-northeast-2.amazonaws.com/491870877159/minseok.fifo</span><br><span class=\"line\">//                = new GetQueueAttributesRequest(<span class=\"string\">\"https://sqs.ap-northeast-2.amazonaws.com/[ALLIAS]/[FIFO_NAME]\"</span>)</span><br><span class=\"line\">//                .withAttributeNames(<span class=\"string\">\"All\"</span>);</span><br><span class=\"line\">//        GetQueueAttributesResult getQueueAttributesResult</span><br><span class=\"line\">//                = sqs.getQueueAttributes(getQueueAttributesRequest);</span><br><span class=\"line\">//        System.out.println(String.format(<span class=\"string\">\"The number of messages on the queue: %s\"</span>,</span><br><span class=\"line\">//                getQueueAttributesResult.getAttributes()</span><br><span class=\"line\">//                        .get(<span class=\"string\">\"ApproximateNumberOfMessages\"</span>)));</span><br><span class=\"line\">//        System.out.println(String.format(<span class=\"string\">\"The number of messages in flight: %s\"</span>,</span><br><span class=\"line\">//                getQueueAttributesResult.getAttributes()</span><br><span class=\"line\">//                        .get(<span class=\"string\">\"ApproximateNumberOfMessagesNotVisible\"</span>)));</span><br><span class=\"line\">//</span><br><span class=\"line\">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class=\"line\">//</span><br><span class=\"line\">//        //2-1. Standard Create Queue</span><br><span class=\"line\">//        CreateQueueRequest create_request = new CreateQueueRequest(<span class=\"string\">\"[STANDARD_QUEUE_NAME]\"</span>)</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"DelaySeconds\"</span>, <span class=\"string\">\"0\"</span>) //An <span class=\"built_in\">integer</span> from 0 to 900 seconds (15 minutes). Default: 0.</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"VisibilityTimeout\"</span>, <span class=\"string\">\"30\"</span>) // An <span class=\"built_in\">integer</span> from 0 to 43,200 (12 hours). Default: 30.</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"MessageRetentionPeriod\"</span>, <span class=\"string\">\"345600\"</span>) // An <span class=\"built_in\">integer</span> from 60 seconds (1 minute) to 1,209,600 seconds (14 days). Default: 345,600 (4 days).</span><br><span class=\"line\">//                .addAttributesEntry(<span class=\"string\">\"MaximumMessageSize\"</span>, <span class=\"string\">\"262144\"</span>); //An <span class=\"built_in\">integer</span> from 1,024 bytes (1 KiB) to 262,144 bytes (256 KiB). Default: 262,144 (256 KiB).</span><br><span class=\"line\">//        String standardQueueUrl = sqs.createQueue(create_request).getQueueUrl();</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-2. Standard Queue List(All)</span><br><span class=\"line\">//        ListQueuesResult lq_result = sqs.listQueues();</span><br><span class=\"line\">//        System.out.println(<span class=\"string\">\"Your SQS Queue URLs:\"</span>);</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">//            System.out.println(url);</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        //1-3. Standard Queue Search(KEY_WORD)</span><br><span class=\"line\">//        String name_prefix = <span class=\"string\">\"KEY_WORD_ENTER\"</span>;</span><br><span class=\"line\">//        lq_result = sqs.listQueues(new ListQueuesRequest(name_prefix));</span><br><span class=\"line\">//        System.out.println(<span class=\"string\">\"Queue URLs with prefix: \"</span> + name_prefix);</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (String url : lq_result.getQueueUrls()) &#123;</span><br><span class=\"line\">//            System.out.println(url);</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//        //1-4. Standard Queue Delete(URL)</span><br><span class=\"line\">//        sqs.deleteQueue(fifoQueueUrl);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-5. Standard Posting a Message to a Queue</span><br><span class=\"line\">//        SendMessageRequest send_msg_request = new SendMessageRequest()</span><br><span class=\"line\">//                .withQueueUrl(fifoQueueUrl)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"hello world\"</span>)</span><br><span class=\"line\">//                .withDelaySeconds(0);</span><br><span class=\"line\">//        sqs.sendMessage(send_msg_request);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-6. Standard Posting Multiple Messages to a Queue</span><br><span class=\"line\">//        List&lt;SendMessageBatchRequestEntry&gt; messageEntries = new ArrayList&lt;&gt;();</span><br><span class=\"line\">//        messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">//                .withId(<span class=\"string\">\"id-1\"</span>)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"batch-1\"</span>));</span><br><span class=\"line\">//        messageEntries.add(new SendMessageBatchRequestEntry()</span><br><span class=\"line\">//                .withId(<span class=\"string\">\"id-2\"</span>)</span><br><span class=\"line\">//                .withMessageBody(<span class=\"string\">\"batch-2\"</span>));</span><br><span class=\"line\">//</span><br><span class=\"line\">//        SendMessageBatchRequest sendMessageBatchRequest</span><br><span class=\"line\">//                = new SendMessageBatchRequest(fifoQueueUrl, messageEntries);</span><br><span class=\"line\">//        sqs.sendMessageBatch(sendMessageBatchRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">//        //1-7. Standard Reading Messages from Queues</span><br><span class=\"line\">//        ReceiveMessageRequest receiveMessageRequest = new ReceiveMessageRequest(fifoQueueUrl)</span><br><span class=\"line\">//                .withWaitTimeSeconds(10)</span><br><span class=\"line\">//                .withMaxNumberOfMessages(10);</span><br><span class=\"line\">//</span><br><span class=\"line\">//        List&lt;Message&gt; sqsMessages = sqs.receiveMessage(receiveMessageRequest).getMessages();</span><br><span class=\"line\">//</span><br><span class=\"line\">//        //1-8. FIFO Deleting a Message from a Queue</span><br><span class=\"line\">//        <span class=\"keyword\">for</span> (Message m : sqsMessages) &#123;</span><br><span class=\"line\">//            sqs.deleteMessage(fifoQueueUrl, m.getReceiptHandle());</span><br><span class=\"line\">//        &#125;</span><br><span class=\"line\">//</span><br><span class=\"line\">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class=\"line\"> </span><br><span class=\"line\">        Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span><br><span class=\"line\">        headers.put(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">        headers.put(<span class=\"string\">\"X-Custom-Header\"</span>, <span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            final String pageContents = this.getPageContents(<span class=\"string\">\"https://checkip.amazonaws.com\"</span>);</span><br><span class=\"line\">            String output = String.format(<span class=\"string\">\"&#123; \\\"message\\\": \\\"hello world\\\", \\\"location\\\": \\\"%s\\\" &#125;\"</span>, pageContents);</span><br><span class=\"line\">            <span class=\"built_in\">return</span> new GatewayResponse(output, headers, 200);</span><br><span class=\"line\">        &#125; catch (IOException e) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> new GatewayResponse(<span class=\"string\">\"&#123;&#125;\"</span>, headers, 500);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    private String getPageContents(String address) throws IOException&#123;</span><br><span class=\"line\">        URL url = new URL(address);</span><br><span class=\"line\">        try(BufferedReader br = new BufferedReader(new InputStreamReader(url.openStream()))) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> br.lines().collect(Collectors.joining(System.lineSeparator()));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"3-결론\"><a href=\"#3-결론\" class=\"headerlink\" title=\"3) 결론\"></a>3) 결론</h3><ol>\n<li>한개의 큐 관리만 잘 해주면 열 Dynamo 안부럽다.</li>\n<li>람다에서 돌아가는 소스로 작성되었지만, 얼마든지 다른 서비스에 쓰일 수 있다.</li>\n<li>이유 : 아까 위에서 말한대로 AWS 최초의 서비스였기 때문(거의 화석급….)</li>\n</ol>\n","text":"Kinesis가 있으니 SQS를 쓸 일이 없겠다. 이걸 뭐하러 쓰나?라고 생각했다면, 한참 더 공부해야한다. 우선 Kinesis와 SQS의 큰 차이점을 비교한다.Kinesis vs SQSKinesis는 스트리밍 데이터 수집 서비스이고 SQS는 메시지 ","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":14,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":13,"path":"api/tags/AWS.json"},{"name":"sqs","slug":"sqs","count":1,"path":"api/tags/sqs.json"},{"name":"fifo","slug":"fifo","count":1,"path":"api/tags/fifo.json"},{"name":"standard","slug":"standard","count":1,"path":"api/tags/standard.json"}]}]}