{"name":"AWS","slug":"AWS","count":1,"posts":[{"title":"Kinesis Data Stream","slug":"kinesisDataStream","date":"2020-04-30T09:00:58.000Z","updated":"2020-04-30T11:22:26.686Z","comments":true,"pin":null,"path":"api/articles/kinesisDataStream.json","excerpt":"","keywords":null,"cover":"/img/01.SmartTok_System_01.png","content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Java, Spring</li>\n<li>AWS Console</li>\n</ul>\n<p>※ 참고자료 : <a href=\"https://docs.aws.amazon.com/ko_kr/kinesis/index.html\" target=\"_blank\" rel=\"noopener\">https://docs.aws.amazon.com/ko_kr/kinesis/index.html</a></p>\n<h2 id=\"Kinesis-기초설명\"><a href=\"#Kinesis-기초설명\" class=\"headerlink\" title=\"Kinesis 기초설명\"></a>Kinesis 기초설명</h2><ol>\n<li>Kinesis는 SQS를 기반으로 한 큐 시스템이다.</li>\n<li>종류로는 Video Streams, Data Streams, Data Firehose, Data Analytics 총 4가지가 있다.</li>\n<li>경동에서는 이 4가지 시스템 모두 사용하겠지만, Video Streams의 경우에는 홈오토, 홈넷쪽에서 사용할 것으로 추정되므로 현 블로그에서는 나머지 기능만을 설명하기로 한다.</li>\n</ol>\n<h2 id=\"Data-Stream\"><a href=\"#Data-Stream\" class=\"headerlink\" title=\"Data Stream\"></a>Data Stream</h2><ol>\n<li>Shard라는 개념을 사용하고 있으며, 큐 내의 메모리 개념으로 받아들이면 된다.</li>\n<li>ap-northeast-2(서울) 리전의 경우 기본적으로 200개의 샤드만 지원이 된다.</li>\n</ol>\n<p><img src=\"https://user-images.githubusercontent.com/62123161/80692614-c5a4c600-8b0c-11ea-98ba-1efbe0264585.png\" alt=\"kinesis_01\"></p>\n<ol start=\"3\">\n<li>한개의 Shard당 1초에 1MB씩 처리가 가능하며, 1000개의 Record를 처리한다. 읽는데는 초당 2MB한도로 읽을 수 있다. 만약, 처리할 데이터의 용량이 크다면, 그만큼의 샤드를 추가하면 된다. 이번 연습에서는 기본샤드인 1만 추가하기로 한다.</li>\n<li>편의를 위해 언어는 Java로 통일한다.</li>\n</ol>\n<h3 id=\"1-Data-Stream-만들기\"><a href=\"#1-Data-Stream-만들기\" class=\"headerlink\" title=\"1) Data Stream 만들기\"></a>1) Data Stream 만들기</h3><ol>\n<li>사용하고자 하는 Stream의 이름과 샤드의 수만 입력하면 자동으로 생성이 된다.(feat. 별거없음)</li>\n</ol>\n<h3 id=\"2-Data-Stream-Page\"><a href=\"#2-Data-Stream-Page\" class=\"headerlink\" title=\"2) Data Stream Page\"></a>2) Data Stream Page</h3><ol>\n<li>데이터 Stream이 생성이 되었다고 하면 아래와 같이 Detail 페이지를 볼 수 있다.</li>\n</ol>\n<p><img src=\"https://user-images.githubusercontent.com/62123161/80692615-c6d5f300-8b0c-11ea-8dab-ab4473eea2a2.png\" alt=\"kinesis_02\"></p>\n<ol start=\"2\">\n<li><p>Data Stream은 Firehose와 Analytics에 사용될 수 있으며, 데이터는 모두 Json으로 하는게 좋다. 물론, CVS파일도 지원을 하기는 한다.(사용할 때 어려울뿐…)</p>\n</li>\n<li><p>데이터 저장방식에서 암호화를 추가할 수 있다. KMS를 설정해서 사용하는데, 현 연습에서는 사용하지 않도록 한다.</p>\n</li>\n<li><p>Data Stream의 보관 기간은 1일~7일까지 선택할 수 있다. 24시간에서 더 늘리게 되면 추가요금이 발생하므로 주의하자.</p>\n</li>\n</ol>\n<h3 id=\"3-Data-Stream을-Java로-개발\"><a href=\"#3-Data-Stream을-Java로-개발\" class=\"headerlink\" title=\"3) Data Stream을 Java로 개발\"></a>3) Data Stream을 Java로 개발</h3><ol>\n<li><p>Gradle(최소 수준의 Dependence 이므로 개발하면서 필요하면 추가해준다.)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-sqs</span><br><span class=\"line\">compile group: <span class=\"string\">'com.amazonaws'</span>, name: <span class=\"string\">'aws-java-sdk-sqs'</span>, version: <span class=\"string\">'1.11.705'</span></span><br><span class=\"line\">// https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-core</span><br><span class=\"line\">compile group: <span class=\"string\">'com.amazonaws'</span>, name: <span class=\"string\">'aws-java-sdk-core'</span>, version: <span class=\"string\">'1.9.17'</span></span><br><span class=\"line\">// https://mvnrepository.com/artifact/com.amazonaws/amazon-kinesis-client</span><br><span class=\"line\">compile group: <span class=\"string\">'com.amazonaws'</span>, name: <span class=\"string\">'amazon-kinesis-client'</span>, version: <span class=\"string\">'1.13.2'</span></span><br></pre></td></tr></table></figure></div>\n</li>\n<li><p>스트림에 Data PUT(Multi)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static List&lt;PutRecordsRequestEntry&gt; <span class=\"function\"><span class=\"title\">putItemStream</span></span>()&#123;</span><br><span class=\"line\">        BasicAWSCredentials awsCreds = new BasicAWSCredentials(<span class=\"string\">\"ACCESSKEY\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"SECRETKEY\"</span>);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder = AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(<span class=\"string\">\"ap-northeast-2\"</span>); // 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient = clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        //PutRecords</span><br><span class=\"line\">        PutRecordsRequest putRecordsRequest  = new PutRecordsRequest();</span><br><span class=\"line\">        putRecordsRequest.setStreamName(STREAM_NAME);</span><br><span class=\"line\">        List &lt;PutRecordsRequestEntry&gt; putRecordsRequestEntryList  = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (int i = 0; i &lt; 10; i++) &#123;</span><br><span class=\"line\">                PutRecordsRequestEntry putRecordsRequestEntry  = new PutRecordsRequestEntry();</span><br><span class=\"line\">                String myData = <span class=\"string\">\"&#123;\\\"testAWS\\\":\"</span> + i + <span class=\"string\">\"&#125;\\n\"</span>; // 보내려는 데이터</span><br><span class=\"line\">                putRecordsRequestEntry.setData(ByteBuffer.wrap(myData.getBytes()));</span><br><span class=\"line\">//            putRecordsRequestEntry.setData(ByteBuffer.wrap(String.valueOf(i).getBytes()));</span><br><span class=\"line\">                putRecordsRequestEntry.setPartitionKey(String.format(<span class=\"string\">\"partitionKey-%d\"</span>, i));</span><br><span class=\"line\">                putRecordsRequestEntryList.add(putRecordsRequestEntry);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            putRecordsRequest.setRecords(putRecordsRequestEntryList);</span><br><span class=\"line\">            PutRecordsResult putRecordsResult  = kinesisClient.putRecords(putRecordsRequest);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        catch (Exception e)&#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"built_in\">return</span> putRecordsRequestEntryList;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n</li>\n<li><p>스트림에 Data PUT(Single)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">static void sendData(AmazonKinesis kinesisClient, int count) &#123;</span><br><span class=\"line\">        HashMap&lt;Integer,String&gt; list &#x3D; new HashMap&lt;Integer,String&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">        list.put(0,&quot;&#123;\\&quot;NAME\\&quot;:\\&quot;dhaval0\\&quot;,\\&quot;TOTAL\\&quot;:100&#125;&quot;);</span><br><span class=\"line\">        list.put(1,&quot;&#123;\\&quot;NAME\\&quot;:\\&quot;dhaval1\\&quot;,\\&quot;TOTAL\\&quot;:200&#125;&quot;);</span><br><span class=\"line\">        list.put(2,&quot;&#123;\\&quot;NAME\\&quot;:\\&quot;dhaval2\\&quot;,\\&quot;TOTAL\\&quot;:300&#125;&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        PutRecordsRequest putRecordsRequest  &#x3D; new PutRecordsRequest();</span><br><span class=\"line\">        putRecordsRequest.setStreamName(STREAM_NAME);</span><br><span class=\"line\">        List&lt;PutRecordsRequestEntry&gt; putRecordsRequestEntryList  &#x3D; new ArrayList&lt;&gt;();</span><br><span class=\"line\">        for (int i &#x3D; 0; i &lt; count; i++) &#123;</span><br><span class=\"line\">            String myData &#x3D; list.get(i); &#x2F;&#x2F; 보내려는 데이터</span><br><span class=\"line\">            PutRecordsRequestEntry putRecordsRequestEntry  &#x3D; new PutRecordsRequestEntry();</span><br><span class=\"line\">            putRecordsRequestEntry.setData(ByteBuffer.wrap(myData.getBytes()));</span><br><span class=\"line\">            putRecordsRequestEntry.setPartitionKey(&quot;MainStream&quot;);</span><br><span class=\"line\">&#x2F;&#x2F;            putRecordsRequestEntry.setPartitionKey(String.format(&quot;partitionKey-%d&quot;, i));</span><br><span class=\"line\">            putRecordsRequestEntryList.add(putRecordsRequestEntry);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        putRecordsRequest.setRecords(putRecordsRequestEntryList);</span><br><span class=\"line\">        PutRecordsResult putRecordsResult  &#x3D; kinesisClient.putRecords(putRecordsRequest);</span><br><span class=\"line\">        System.out.println(&quot;Put Result&quot; + putRecordsResult);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></li>\n<li><p>샤드 내 총 데이터 갯수조회</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static int getDataCount(String shardId, String streamName) &#123;</span><br><span class=\"line\">        int dataCount &#x3D; 0;</span><br><span class=\"line\"> </span><br><span class=\"line\">        BasicAWSCredentials awsCreds &#x3D; new BasicAWSCredentials(&quot;AKIAUEPDKBXF3QNKDUXM&quot;,</span><br><span class=\"line\">                &quot;JJnd0b81vuTxpyrPNGEWV1QQJYhSwalS5UjCSno3&quot;);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder &#x3D; AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(&quot;ap-northeast-2&quot;); &#x2F;&#x2F; 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient &#x3D; clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        String shardIterator;</span><br><span class=\"line\">        GetShardIteratorRequest getShardIteratorRequest &#x3D; new GetShardIteratorRequest();</span><br><span class=\"line\">        getShardIteratorRequest.setStreamName(streamName);</span><br><span class=\"line\">        getShardIteratorRequest.setShardId(shardId);</span><br><span class=\"line\">        getShardIteratorRequest.setShardIteratorType(ShardIteratorType.TRIM_HORIZON);</span><br><span class=\"line\"> </span><br><span class=\"line\">        GetShardIteratorResult getShardIteratorResult &#x3D; kinesisClient.getShardIterator(getShardIteratorRequest);</span><br><span class=\"line\">        shardIterator &#x3D; getShardIteratorResult.getShardIterator();</span><br><span class=\"line\">        GetRecordsRequest getRecordsRequest &#x3D; new GetRecordsRequest();</span><br><span class=\"line\">        getRecordsRequest.setShardIterator(shardIterator);</span><br><span class=\"line\">        getRecordsRequest.setLimit(1000);</span><br><span class=\"line\"> </span><br><span class=\"line\">        GetRecordsResult getRecordsResult &#x3D; kinesisClient.getRecords(getRecordsRequest);</span><br><span class=\"line\">        List&lt;Record&gt; records &#x3D; getRecordsResult.getRecords();</span><br><span class=\"line\">        if(!records.isEmpty() &amp;&amp; records.size() &gt; 0)&#123;</span><br><span class=\"line\">            dataCount &#x3D; records.size();</span><br><span class=\"line\">            Iterator&lt;Record&gt; iterator &#x3D; records.iterator();</span><br><span class=\"line\">            while(iterator.hasNext()) &#123;</span><br><span class=\"line\">                Record record &#x3D; iterator.next();</span><br><span class=\"line\">                byte[] bytes &#x3D; record.getData().array();</span><br><span class=\"line\">                String recordData &#x3D; new String(bytes);</span><br><span class=\"line\">                System.out.println(&quot;Shard Id. :&quot;+shardId+&quot;Seq. No. is : &quot;+&quot;  Record data :&quot;+recordData);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">        return dataCount;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></li>\n<li><p>샤드 내 데이터 조회</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static HashSet&lt;Record&gt; getItemStream()&#123;</span><br><span class=\"line\">        BasicAWSCredentials awsCreds &#x3D; new BasicAWSCredentials(&quot;ACCESSKEY&quot;,</span><br><span class=\"line\">                &quot;SECRETKEY&quot;);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder &#x3D; AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(&quot;ap-northeast-2&quot;); &#x2F;&#x2F; 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient &#x3D; clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        List&lt;Shard&gt; shardList &#x3D; getShardList();</span><br><span class=\"line\"> </span><br><span class=\"line\">        &#x2F;&#x2F;GetRecords</span><br><span class=\"line\">        String shardIterator;</span><br><span class=\"line\">        GetShardIteratorRequest getShardIteratorRequest &#x3D; new GetShardIteratorRequest();</span><br><span class=\"line\">        getShardIteratorRequest.setStreamName(STREAM_NAME);</span><br><span class=\"line\">        getShardIteratorRequest.setShardId(shardList.get(0).getShardId());</span><br><span class=\"line\">        getShardIteratorRequest.setShardIteratorType(&quot;TRIM_HORIZON&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        GetShardIteratorResult getShardIteratorResult &#x3D; kinesisClient.getShardIterator(getShardIteratorRequest);</span><br><span class=\"line\">        shardIterator &#x3D; getShardIteratorResult.getShardIterator();</span><br><span class=\"line\"> </span><br><span class=\"line\">        HashSet&lt;Record&gt; records &#x3D; new HashSet&lt;Record&gt;();</span><br><span class=\"line\">        HashMap&lt;String, String&gt; view &#x3D; new HashMap&lt;String, String&gt;();</span><br><span class=\"line\"> </span><br><span class=\"line\">        while (true) &#123;</span><br><span class=\"line\">            GetRecordsRequest getRecordsRequest &#x3D; new GetRecordsRequest();</span><br><span class=\"line\">            getRecordsRequest.setShardIterator(shardIterator);</span><br><span class=\"line\">            getRecordsRequest.setLimit(25);</span><br><span class=\"line\"> </span><br><span class=\"line\">            GetRecordsResult result &#x3D; kinesisClient.getRecords(getRecordsRequest);</span><br><span class=\"line\">            if(result.getRecords().size() &#x3D;&#x3D; 0)&#123;</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#x2F;&#x2F;for(Record record : result.getRecords())&#123;</span><br><span class=\"line\">            for(int i &#x3D; 0;i&lt;result.getRecords().size();i++)&#123;</span><br><span class=\"line\">                Record record &#x3D; result.getRecords().get(i);</span><br><span class=\"line\">                records.add(record);</span><br><span class=\"line\"> </span><br><span class=\"line\">                view.put(record.getSequenceNumber(), new String(record.getData().array()));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                Thread.sleep(1000);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            catch (InterruptedException exception) &#123;</span><br><span class=\"line\">                throw new RuntimeException(exception);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            shardIterator &#x3D; result.getNextShardIterator();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return records;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></li>\n<li><p>(번외) Stream 내 Shard 리스트 출력</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static List&lt;Shard&gt; getShardList()&#123;</span><br><span class=\"line\">        BasicAWSCredentials awsCreds &#x3D; new BasicAWSCredentials(&quot;ACCESSKEY&quot;,</span><br><span class=\"line\">                &quot;SECRETKEY&quot;);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder &#x3D; AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(&quot;ap-northeast-2&quot;); &#x2F;&#x2F; 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient &#x3D; clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        DescribeStreamRequest describeStreamRequest &#x3D; new DescribeStreamRequest();</span><br><span class=\"line\">        describeStreamRequest.setStreamName( STREAM_NAME );</span><br><span class=\"line\">        List&lt;Shard&gt; shards &#x3D; new ArrayList&lt;&gt;();</span><br><span class=\"line\">        String exclusiveStartShardId &#x3D; null;</span><br><span class=\"line\">        do &#123;</span><br><span class=\"line\">            describeStreamRequest.setExclusiveStartShardId( exclusiveStartShardId );</span><br><span class=\"line\">            DescribeStreamResult describeStreamResult &#x3D; kinesisClient.describeStream( describeStreamRequest );</span><br><span class=\"line\">            shards.addAll( describeStreamResult.getStreamDescription().getShards() );</span><br><span class=\"line\">            if (describeStreamResult.getStreamDescription().getHasMoreShards() &amp;&amp; shards.size() &gt; 0) &#123;</span><br><span class=\"line\">                exclusiveStartShardId &#x3D; shards.get(shards.size() - 1).getShardId();</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                exclusiveStartShardId &#x3D; null;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; while ( exclusiveStartShardId !&#x3D; null );</span><br><span class=\"line\">        return shards;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></li>\n<li><p>(번외) 계정 내 Stream 리스트 조회(전체)</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static List&lt;String&gt; getStreamList()&#123;</span><br><span class=\"line\">        BasicAWSCredentials awsCreds &#x3D; new BasicAWSCredentials(&quot;ACCESSKEY&quot;,</span><br><span class=\"line\">                &quot;SECRETKEY&quot;);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder &#x3D; AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(&quot;ap-northeast-2&quot;); &#x2F;&#x2F; 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient &#x3D; clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        ListStreamsRequest listStreamsRequest &#x3D; new ListStreamsRequest();</span><br><span class=\"line\">        listStreamsRequest.setLimit(20);</span><br><span class=\"line\">        ListStreamsResult listStreamsResult &#x3D; kinesisClient.listStreams(listStreamsRequest);</span><br><span class=\"line\">        List&lt;String&gt; streamNames &#x3D; listStreamsResult.getStreamNames();</span><br><span class=\"line\"> </span><br><span class=\"line\">        while (listStreamsResult.getHasMoreStreams())</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            if (streamNames.size() &gt; 0) &#123;</span><br><span class=\"line\">                listStreamsRequest.setExclusiveStartStreamName(streamNames.get(streamNames.size() - 1));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            listStreamsResult &#x3D; kinesisClient.listStreams(listStreamsRequest);</span><br><span class=\"line\">            streamNames.addAll(listStreamsResult.getStreamNames());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">        return streamNames;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></li>\n<li><p>(번외) Stream 삭제</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"PLAIN\"><figure class=\"iseeu highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private static Boolean deleteStream(String streamName)&#123;</span><br><span class=\"line\">        BasicAWSCredentials awsCreds &#x3D; new BasicAWSCredentials(&quot;ACCESSKEY&quot;,</span><br><span class=\"line\">                &quot;SECRETKEY&quot;);</span><br><span class=\"line\">        AmazonKinesisClientBuilder clientBuilder &#x3D; AmazonKinesisClientBuilder.standard();</span><br><span class=\"line\">        clientBuilder.setRegion(&quot;ap-northeast-2&quot;); &#x2F;&#x2F; 서울 region</span><br><span class=\"line\">        clientBuilder.setCredentials(new AWSStaticCredentialsProvider(awsCreds));</span><br><span class=\"line\">        AmazonKinesis kinesisClient &#x3D; clientBuilder.build();</span><br><span class=\"line\"> </span><br><span class=\"line\">        Boolean result &#x3D; false;</span><br><span class=\"line\">        try&#123;</span><br><span class=\"line\">            DeleteStreamRequest deleteStreamRequest &#x3D; new DeleteStreamRequest();</span><br><span class=\"line\">            deleteStreamRequest.setStreamName(streamName);</span><br><span class=\"line\">            kinesisClient.deleteStream(deleteStreamRequest);</span><br><span class=\"line\"> </span><br><span class=\"line\">            result &#x3D; true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        catch (Exception e)&#123;</span><br><span class=\"line\">            System.out.println(e.getMessage());</span><br><span class=\"line\">            result &#x3D; false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n</li>\n</ol>\n<h2 id=\"결론\"><a href=\"#결론\" class=\"headerlink\" title=\"결론\"></a>결론</h2><ul>\n<li>Kinesis는 기존의 SQS와 동일하게 사용해도 좋을 것 같다. 단지 SQS와 다른점은 가격이 싸고 속도가 빠르다는 점.<br>   싸고 빠르다는점 이외에도 Firehose, Analytics 등과 함께 사용하므로 더욱더 편리하게 AWS 생태계에 접근할 수 있다는 메리트가 있다.</li>\n<li>위 실습내용을 모두 돌려보고 나면, 크게 할 것이 없다는 점을 느낄 수 있을 것이다.</li>\n</ul>\n","text":"개발환경 구축※ 기본 개발환경IntelliJJava, SpringAWS Console※ 참고자료 : https://docs.aws.amazon.com/ko_kr/kinesis/index.htmlKinesis 기초설명Kinesis는 SQS를 기반으로 한","link":"","raw":null,"photos":[],"categories":[{"name":"tip","slug":"tip","count":2,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":1,"path":"api/tags/AWS.json"},{"name":"Cloud","slug":"Cloud","count":1,"path":"api/tags/Cloud.json"},{"name":"Kinesis","slug":"Kinesis","count":1,"path":"api/tags/Kinesis.json"}]}]}