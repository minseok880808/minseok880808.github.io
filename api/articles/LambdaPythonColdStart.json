{"title":"Lambda Python ColdStart Test","slug":"LambdaPythonColdStart","date":"2020-05-06T23:38:19.000Z","updated":"2020-05-11T05:40:02.120Z","comments":true,"path":"api/articles/LambdaPythonColdStart.json","photos":[],"link":"","excerpt":"","covers":["https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png","https://user-images.githubusercontent.com/62123161/81248121-a949e180-9056-11ea-8148-4a19eb45aa0e.png","https://user-images.githubusercontent.com/62123161/81248120-a7801e00-9056-11ea-8709-a15ce1cbda8b.png","https://user-images.githubusercontent.com/62123161/81248125-ab13a500-9056-11ea-8c95-ae25e76cf132.png","https://user-images.githubusercontent.com/62123161/81248124-aa7b0e80-9056-11ea-9d30-8a7fef821dea.png"],"content":"<h2 id=\"개발환경-구축\"><a href=\"#개발환경-구축\" class=\"headerlink\" title=\"개발환경 구축\"></a>개발환경 구축</h2><p>※ 기본 개발환경</p>\n<ul>\n<li>IntelliJ</li>\n<li>Python</li>\n<li>AWS Console</li>\n</ul>\n<h2 id=\"Lambda-Python-설명\"><a href=\"#Lambda-Python-설명\" class=\"headerlink\" title=\"Lambda Python 설명\"></a>Lambda Python 설명</h2><ul>\n<li>팀장님께서 조사하신 내용을 토대로 Java가 콜드스타트에서 많은 시간을 소모한다는 점에 착안하여 Python으로 시도해보기로 함.</li>\n<li>Node로도 Python과 큰 차이없는 성능을 보여주었던 만큼 기대하고 테스트를 진행함.</li>\n</ul>\n<h2 id=\"설정\"><a href=\"#설정\" class=\"headerlink\" title=\"설정\"></a>설정</h2><ol>\n<li>pymysql 라이브러리를 Python 코드에 넣어야 함.</li>\n<li>가능하면 Layer에 넎어주는 편이 좋다.</li>\n</ol>\n<h3 id=\"개발\"><a href=\"#개발\" class=\"headerlink\" title=\"개발\"></a>개발</h3><h4 id=\"1-Lambda-접속\"><a href=\"#1-Lambda-접속\" class=\"headerlink\" title=\"1) Lambda 접속\"></a>1) Lambda 접속</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248123-a9e27800-9056-11ea-9be2-3d469e5aca52.png\" alt=\"lambdapython_01\"></a></p>\n<h4 id=\"2-Create-Function-클릭-및-IAM권한까지-해서-함수생성\"><a href=\"#2-Create-Function-클릭-및-IAM권한까지-해서-함수생성\" class=\"headerlink\" title=\"2) Create Function 클릭 및 IAM권한까지 해서 함수생성\"></a>2) Create Function 클릭 및 IAM권한까지 해서 함수생성</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248121-a949e180-9056-11ea-8148-4a19eb45aa0e.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248121-a949e180-9056-11ea-8148-4a19eb45aa0e.png\" alt=\"lambdapython_02\"></a></p>\n<h4 id=\"3-Layer이라는-곳이-있음\"><a href=\"#3-Layer이라는-곳이-있음\" class=\"headerlink\" title=\"3) Layer이라는 곳이 있음.\"></a>3) Layer이라는 곳이 있음.</h4><ul>\n<li>자주쓰는 라이브러리들을 여기에 등록해서 땡겨쓰는건데, 필요하면 이 부분은 따로 설명하는 부분을 만들어야 할 듯.</li>\n<li>기본개념은 람다 밑에 계층을 만들어서 계층 내의 라이브러리를 저장해서 필요할때마다 import 해서 쓰는 개념.</li>\n<li>(참고로 아직 제대로 써보는 방법도 못찾아봤음)<br><a href=\"https://user-images.githubusercontent.com/62123161/81248120-a7801e00-9056-11ea-8709-a15ce1cbda8b.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248120-a7801e00-9056-11ea-8709-a15ce1cbda8b.png\" alt=\"lambdapython_03\"></a></li>\n</ul>\n<h4 id=\"4-Code-entry-type을-Upload-zip-file로-변경하고-밑의-Upload를-선택하여-위에-다운받은-파일을-넣는다\"><a href=\"#4-Code-entry-type을-Upload-zip-file로-변경하고-밑의-Upload를-선택하여-위에-다운받은-파일을-넣는다\" class=\"headerlink\" title=\"4) Code entry type을 Upload zip file로 변경하고 밑의 Upload를 선택하여 위에 다운받은 파일을 넣는다.\"></a>4) Code entry type을 Upload zip file로 변경하고 밑의 Upload를 선택하여 위에 다운받은 파일을 넣는다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248125-ab13a500-9056-11ea-8c95-ae25e76cf132.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248125-ab13a500-9056-11ea-8c95-ae25e76cf132.png\" alt=\"lambdapython_04\"></a></p>\n<ul>\n<li>(중요!!) 넣고 반드시 우측상단 Save노란색 버튼을 눌러줘야 한다. 안누르면 그냥 아무것도 안한상태가 됨.</li>\n</ul>\n<h4 id=\"5-저장-후-Code-entry-type을-Edit-code-inline으로-만들면-아래와-같은-화면이-나오고-코드를-직접-수정할-수-있다\"><a href=\"#5-저장-후-Code-entry-type을-Edit-code-inline으로-만들면-아래와-같은-화면이-나오고-코드를-직접-수정할-수-있다\" class=\"headerlink\" title=\"5) 저장 후 Code entry type을 Edit code inline으로 만들면 아래와 같은 화면이 나오고, 코드를 직접 수정할 수 있다.\"></a>5) 저장 후 Code entry type을 Edit code inline으로 만들면 아래와 같은 화면이 나오고, 코드를 직접 수정할 수 있다.</h4><p><a href=\"https://user-images.githubusercontent.com/62123161/81248124-aa7b0e80-9056-11ea-9d30-8a7fef821dea.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://user-images.githubusercontent.com/62123161/81248124-aa7b0e80-9056-11ea-9d30-8a7fef821dea.png\" alt=\"lambdapython_05\"></a></p>\n<ul>\n<li>(중요!!) Handler에 main.main 으로 넣고 세이브한다.</li>\n</ul>\n<h4 id=\"6-우측상단의-테스트케이스를-만들어서-테스트를-돌리면된다\"><a href=\"#6-우측상단의-테스트케이스를-만들어서-테스트를-돌리면된다\" class=\"headerlink\" title=\"6) 우측상단의 테스트케이스를 만들어서 테스트를 돌리면된다.\"></a>6) 우측상단의 테스트케이스를 만들어서 테스트를 돌리면된다.</h4><h3 id=\"끝\"><a href=\"#끝\" class=\"headerlink\" title=\"-끝-\"></a>-끝-</h3><h3 id=\"소스\"><a href=\"#소스\" class=\"headerlink\" title=\"소스\"></a>소스</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><figcaption><span>Full Source</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># A lambda function to interact with AWS RDS MySQL</span></span><br><span class=\"line\">import json</span><br><span class=\"line\">import pymysql</span><br><span class=\"line\">import sys</span><br><span class=\"line\"> </span><br><span class=\"line\">REGION = <span class=\"string\">'ap-northeast-2'</span></span><br><span class=\"line\"> </span><br><span class=\"line\">rds_host  = <span class=\"string\">\"RDS_ENDPOINT\"</span></span><br><span class=\"line\">name = <span class=\"string\">\"ID\"</span></span><br><span class=\"line\">password = <span class=\"string\">\"PW\"</span></span><br><span class=\"line\">db_name = <span class=\"string\">\"DATABASE_NAME\"</span></span><br><span class=\"line\"> </span><br><span class=\"line\">def save_events(event):</span><br><span class=\"line\">    <span class=\"string\">\"\"</span><span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">    This function fetches content from mysql RDS instance</span></span><br><span class=\"line\"><span class=\"string\">    \"</span><span class=\"string\">\"\"</span></span><br><span class=\"line\">    result = []</span><br><span class=\"line\">    conn = pymysql.connect(rds_host, user=name, passwd=password, db=db_name, connect_timeout=5)</span><br><span class=\"line\">    with conn.cursor() as cur:</span><br><span class=\"line\">        <span class=\"comment\"># cur.execute(\"\"\"insert into test (id, name) values( %s, '%s')\"\"\" % (event['id'], event['name']))</span></span><br><span class=\"line\">        cur.execute(<span class=\"string\">\"\"</span><span class=\"string\">\"select * from [TABLE_NAME]\"</span><span class=\"string\">\"\"</span>)</span><br><span class=\"line\">        conn.commit()</span><br><span class=\"line\">        cur.close()</span><br><span class=\"line\">        <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> cur:</span><br><span class=\"line\">            result.append(list(row))</span><br><span class=\"line\">        <span class=\"comment\"># print \"Data from RDS...\"</span></span><br><span class=\"line\">        <span class=\"built_in\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"string\">'statusCode'</span>: 200,</span><br><span class=\"line\">        <span class=\"string\">'body'</span>: json.dumps(result)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">        <span class=\"comment\"># print result</span></span><br><span class=\"line\"> </span><br><span class=\"line\">def main(event, context):</span><br><span class=\"line\">    save_events(event)</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"테스트-결과\"><a href=\"#테스트-결과\" class=\"headerlink\" title=\"테스트 결과\"></a>테스트 결과</h3><h4 id=\"1-자바의-Cold-Start-이후-지속호출\"><a href=\"#1-자바의-Cold-Start-이후-지속호출\" class=\"headerlink\" title=\"1) 자바의 Cold Start 이후 지속호출\"></a>1) 자바의 Cold Start 이후 지속호출</h4><p>REPORT RequestId: e48ab981-212a-41c9-96e2-ed07b3f50d8d Duration: 2624.96 ms Billed Duration: 2700 ms Memory Size: 2048 MB Max Memory Used: 157 MB Init Duration: 314.42 ms<br>REPORT RequestId: 25754b1d-1eb5-4e47-b281-8f7f25f86b0e Duration: 2.34 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: 8e4b7664-f8bd-43bb-a93a-1ce762ff9e08 Duration: 8.53 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: c75c69c3-c25d-4ca1-a89f-b47568db2b32 Duration: 2.35 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB<br>REPORT RequestId: a8579b00-6799-4805-b20e-2bda8233f3bf Duration: 2.51 ms Billed Duration: 100 ms Memory Size: 2048 MB Max Memory Used: 157 MB</p>\n<h4 id=\"2-Python의-Cold-Start-이후-지속호출\"><a href=\"#2-Python의-Cold-Start-이후-지속호출\" class=\"headerlink\" title=\"2) Python의 Cold Start 이후 지속호출\"></a>2) Python의 Cold Start 이후 지속호출</h4><p>REPORT RequestId: d9e08910-f520-46f1-998d-dc464ab906d4 Duration: 89.94 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 178.14 ms<br>REPORT RequestId: 3b38dbe2-50ef-4fa0-914f-fbe8f537fdda Duration: 56.36 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 53 MB<br>REPORT RequestId: f9943532-58b0-422e-b040-0e71a7f38837 Duration: 57.04 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB<br>REPORT RequestId: b53b4659-db4a-44c6-aca4-aacca7897648 Duration: 90.57 ms Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 163.13 ms<br>REPORT RequestId: ef27297d-b738-44eb-b75f-a180ff58abc1 Duration: 187.70 ms Billed Duration: 200 ms Memory Size: 128 MB Max Memory Used: 52 MB Init Duration: 164.85 ms</p>\n<h3 id=\"리포팅\"><a href=\"#리포팅\" class=\"headerlink\" title=\"리포팅\"></a>리포팅</h3><ol>\n<li>파이선 특징</li>\n</ol>\n<ul>\n<li>라이브러리를 모두 직접 등록해줘야 하는 단점…&lt;Maven, Gradle이 그립다.&gt;</li>\n<li>파일을 직접 넣어줘야하고, 지원되는 라이브러리가 생각보다 별로없다.</li>\n<li>디버깅이 어렵다.(이건 툴 문제)</li>\n</ul>\n<ol start=\"2\">\n<li>람다의 특성</li>\n</ol>\n<ul>\n<li>참고로 람다는 복사&lt;똑같은 람다 이름만바꿔서 생성&gt;가 안된다. 할거라면 새로 만들어야 한다. AWS정책임.</li>\n<li>Layer이라는 개념을 스크립트언어에서는 반드시 써줘야 하는데, 내생각보다 좀 좋은 기능으로 보인다.</li>\n</ul>\n","categories":[{"name":"tip","slug":"tip","count":21,"path":"api/categories/tip.json"}],"tags":[{"name":"AWS","slug":"AWS","count":14,"path":"api/tags/AWS.json"},{"name":"cold start","slug":"cold-start","count":1,"path":"api/tags/cold-start.json"},{"name":"hot start","slug":"hot-start","count":1,"path":"api/tags/hot-start.json"},{"name":"python","slug":"python","count":2,"path":"api/tags/python.json"}]}